<h1 id="case-study-pointers-without-overflows">Case Study: Pointers Without Overflows</h1>

<p>A large part of the allure of Haskell is its elegant, high-level ADTs that ensure that programs won't be plagued by problems like the infamous <a href="heartbleed">SSL heartbleed bug</a>.  However, another part of Haskell's charm is that when you really really need to, you can drop down to low-level pointer twiddling to squeeze the most performance out of your machine. But of course, that opens the door to the heartbleeds.</p>
<p>Wouldn't it be nice to have have our cake and eat it too? That is wouldn't it be great if we could twiddle pointers at a low-level and still get the nice safety assurances of high-level types? In this case study, lets see how LiquidHaskell lets us do exactly that.</p>
<h2 id="heartbleeds-in-haskell">HeartBleeds in Haskell</h2>
<p> like Haskell are ultimately built upon the foundation of <code>C</code>. Thus, implementation errors could open up unpleasant vulnerabilities that could easily slither past the type system and even code inspection.</p>
<p> As a concrete example, lets look at a a function that uses the <code>ByteString</code> library to truncate strings:</p>
<pre><span class=hs-linenum>55: </span><span class='hs-definition'>chop</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span>
<span class=hs-linenum>56: </span><span class='hs-definition'>chop</span> <span class='hs-varid'>s</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s'</span>
<span class=hs-linenum>57: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>58: </span>    <span class='hs-varid'>b</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>B</span><span class='hs-varop'>.</span><span class='hs-varid'>pack</span> <span class='hs-varid'>s</span>          <span class='hs-comment'>-- down to low-level</span>
<span class=hs-linenum>59: </span>    <span class='hs-varid'>b'</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>B</span><span class='hs-varop'>.</span><span class='hs-varid'>unsafeTake</span> <span class='hs-varid'>n</span> <span class='hs-varid'>b</span>  <span class='hs-comment'>-- grab n chars</span>
<span class=hs-linenum>60: </span>    <span class='hs-varid'>s'</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>B</span><span class='hs-varop'>.</span><span class='hs-varid'>unpack</span> <span class='hs-varid'>b'</span>       <span class='hs-comment'>-- up to high-level</span>
</pre>
<p>First, the function <code>pack</code>s the string into a low-level bytestring <code>b</code>, then it grabs the first <code>n</code> <code>Char</code>acters from <code>b</code> and translates them back into a high-level <code>String</code>. Lets see how the function works on a small test:</p>
<pre><span class=hs-linenum>69: </span><span class='hs-definition'>ghci</span><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>let</span> <span class='hs-varid'>ex</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Ranjit Loves Burritos"</span>
</pre>
<p>We get the right result when we <code>chop</code> a <em>valid</em> prefix:</p>
<pre><span class=hs-linenum>75: </span><span class='hs-definition'>ghci</span><span class='hs-varop'>&gt;</span> <span class='hs-varid'>chop</span> <span class='hs-varid'>ex</span> <span class='hs-num'>10</span>
<span class=hs-linenum>76: </span><span class='hs-str'>"Ranjit Lov"</span>
</pre>
<p>But, as illustrated in Figure~, the machine silently reveals (or more colorfully, <em>bleeds</em>) the contents of adjacent memory or if we use an <em>invalid</em> prefix:</p>
<pre><span class=hs-linenum>84: </span><span class='hs-definition'>ghci</span><span class='hs-varop'>&gt;</span> <span class='hs-varid'>heartBleed</span> <span class='hs-varid'>ex</span> <span class='hs-num'>30</span>
<span class=hs-linenum>85: </span><span class='hs-str'>"Ranjit Loves Burritos\NUL\201\&amp;1j\DC3\SOH\NUL"</span>
</pre>

<p> Now that we have stared the problem straight in the eye, look at how we can use LiquidHaskell to <em>prevent</em> the above at compile time. To this end, we decompose the overall system into a hierarchy of <em>levels</em> (i.e. <em>modules</em>). In this case, we have three levels:</p>
<ol style="list-style-type: decimal">
<li><strong>Machine</strong> level <code>Pointers</code></li>
<li><strong>Library</strong> level <code>ByteString</code></li>
<li><strong>User</strong> level <code>Application</code></li>
</ol>
<p>Now, our strategy, as before, is to develop an <em>refined API</em> for each level such that errors at <em>each</em> level are prevented by adhering to the types at <em>lower</em> levels.</p>
<p><strong>HEREHEREHERE</strong></p>
<h2 id="low-level-pointer-api">1. Low-level Pointer API</h2>
<p>Strategy: Specify and Verify Types for</p>
<p><br></p>
<ol style="list-style-type: decimal">
<li><strong>Low-level <code>Pointer</code> API</strong></li>
<li>Lib-level <code>ByteString</code> API</li>
<li>User-level <code>Application</code> API</li>
</ol>
<p><br></p>
<p>Errors at <em>each</em> level are prevented by types at <em>lower</em> levels</p>
<p></p>
<p><strong>Low-level Pointers</strong></p>
<pre><span class=hs-linenum>132: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span>         
</pre>
<p><br></p>
<div class="fragment">
<p><strong>Foreign Pointers</strong></p>
<pre><span class=hs-linenum>141: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span> 
</pre>
<p><br></p>
<code>ForeignPtr</code> wraps around <code>Ptr</code>; can be exported to/from C.
</div>
<p></p>
<div class="fragment">
<p><strong>Read</strong></p>
<pre><span class=hs-linenum>156: </span><span class='hs-definition'>peek</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>  
</pre>
</div>
<br>
<div class="fragment">
<p><strong>Write</strong></p>
<pre><span class=hs-linenum>165: </span><span class='hs-definition'>poke</span>     <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
</pre>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Arithmetic</strong></p>
<pre><span class=hs-linenum>174: </span><span class='hs-definition'>plusPtr</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>b</span> 
</pre>
</div>
<p></p>
<div class="fragment">
<p><strong>Create</strong></p>
<pre><span class=hs-linenum>184: </span><span class='hs-definition'>malloc</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span>
</pre>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Unwrap and Use</strong></p>
<pre><span class=hs-linenum>194: </span><span class='hs-definition'>withForeignPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span>     <span class='hs-comment'>-- pointer </span>
<span class=hs-linenum>195: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>  <span class='hs-comment'>-- action </span>
<span class=hs-linenum>196: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>b</span>             <span class='hs-comment'>-- result</span>
</pre>
</div>
<p></p>
<p><strong>Allocate a block and write 4 zeros into it</strong></p>
<div class="fragment">
<pre><span class=hs-linenum>207: </span><a class=annot href="#"><span class=annottext>forall a.
(IO (ForeignPtr a^"lq_tmp_x282")^"lq_tmp_x283")^"lq_tmp_x284"</span><span class='hs-definition'>zero4</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#1724 : (ForeignPtr {VV#1721 : a^"lq_tmp_x1723" | k_1722})^"lq_tmp_x1726" | k_1725}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x1715:{lq_tmp_x1711 : Int | lq_tmp_x1711 &gt;= 0}
-&gt; (IO {lq_tmp_x1712 : (ForeignPtr {VV#1716 : a^"lq_tmp_x1718" | k_1717}) | 0 &lt;= fplen lq_tmp_x1712 &amp;&amp; fplen lq_tmp_x1712 == lq_tmp_x1715})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1719 : Int | lq_tmp_x1719 == (4  :  int) &amp;&amp; lq_tmp_x1719 == lq_anf__d3Z7}</span><span class='hs-num'>4</span></a>
<span class=hs-linenum>208: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x1745:(ForeignPtr {VV#1747 : a^"lq_tmp_x1749" | k_1748})
-&gt; lq_tmp_x1746:(lq_tmp_x1744:{lq_tmp_x1738 : (Ptr {VV#1747 : a^"lq_tmp_x1749" | k_1748}) | 0 &lt;= plen lq_tmp_x1738 &amp;&amp; plen lq_tmp_x1738 == fplen lq_tmp_x1745}
                 -&gt; (IO {lq_tmp_x1753 : ()^"lq_tmp_x1752" | k_1751[VV#1750:=lq_tmp_x1753]}))
-&gt; (IO {lq_tmp_x1753 : ()^"lq_tmp_x1752" | k_1751[VV#1750:=lq_tmp_x1753]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1754 : (ForeignPtr {VV#1721 : a^"lq_tmp_x1723" | k_1722[VV#1724:=lq_tmp_x1754]})^"lq_tmp_x1726" | k_1725[VV#1724:=lq_tmp_x1754] &amp;&amp; lq_tmp_x1754 == fp#a3L6}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2012:(lq_tmp_x2011:(lq_tmp_x2014:{lq_tmp_x2027 : (Ptr {VV#2015 : a^"lq_tmp_x2017" | k_2016[VV#2018:=lq_tmp_x2027]})^"lq_tmp_x2020" | k_2019[VV#2018:=lq_tmp_x2027]}
                            -&gt; {lq_tmp_x2029 : (IO {lq_tmp_x2028 : ()^"lq_tmp_x2023" | k_2022[VV#2021:=lq_tmp_x2028][VV#2024:=lq_tmp_x2029]})^"lq_tmp_x2026" | k_2025[VV#2024:=lq_tmp_x2029]})
              -&gt; {lq_tmp_x2038 : (IO {lq_tmp_x2037 : ()^"lq_tmp_x2033" | k_2032[VV#2031:=lq_tmp_x2037][VV#2034:=lq_tmp_x2038]})^"lq_tmp_x2036" | k_2035[VV#2034:=lq_tmp_x2038]})
-&gt; lq_tmp_x2013:(lq_tmp_x2014:{lq_tmp_x2027 : (Ptr {VV#2015 : a^"lq_tmp_x2017" | k_2016[VV#2018:=lq_tmp_x2027]})^"lq_tmp_x2020" | k_2019[VV#2018:=lq_tmp_x2027]}
                 -&gt; {lq_tmp_x2029 : (IO {lq_tmp_x2028 : ()^"lq_tmp_x2023" | k_2022[VV#2021:=lq_tmp_x2028][VV#2024:=lq_tmp_x2029]})^"lq_tmp_x2026" | k_2025[VV#2024:=lq_tmp_x2029]})
-&gt; {lq_tmp_x2038 : (IO {lq_tmp_x2037 : ()^"lq_tmp_x2033" | k_2032[VV#2031:=lq_tmp_x2037][VV#2034:=lq_tmp_x2038]})^"lq_tmp_x2036" | k_2035[VV#2034:=lq_tmp_x2038]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#1759 : (Ptr {VV#1756 : a^"lq_tmp_x1758" | k_1757})^"lq_tmp_x1761" | k_1760}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>209: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1800:{lq_tmp_x1793 : (Ptr Word8^"lq_tmp_x1802") | 0 &lt; plen lq_tmp_x1793}
-&gt; lq_tmp_x1801:Word8^"lq_tmp_x1802" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1789 : (Ptr {VV#1756 : a^"lq_tmp_x1758" | k_1757[VV#1759:=lq_tmp_x1789]})^"lq_tmp_x1761" | k_1760[VV#1759:=lq_tmp_x1789] &amp;&amp; lq_tmp_x1789 == p#a3L7}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1780:{lq_tmp_x1775 : (Ptr {VV#1782 : a^"lq_tmp_x1784" | k_1783}) | 0 &lt;= plen lq_tmp_x1775}
-&gt; lq_tmp_x1781:{lq_tmp_x1776 : Int | lq_tmp_x1776 &lt;= plen lq_tmp_x1780}
-&gt; {lq_tmp_x1777 : (Ptr {lq_tmp_x1788 : Word8^"lq_tmp_x1787" | k_1786[VV#1785:=lq_tmp_x1788]}) | 0 &lt;= plen lq_tmp_x1777 &amp;&amp; pbase lq_tmp_x1777 == pbase lq_tmp_x1780 &amp;&amp; plen lq_tmp_x1777 == plen lq_tmp_x1780 - lq_tmp_x1781}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1790 : Int | lq_tmp_x1790 == (0  :  int) &amp;&amp; lq_tmp_x1790 == lq_anf__d3Za}</span><span class='hs-num'>0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1808 : Word8^"lq_tmp_x1699" | lq_tmp_x1808 == lq_anf__d3Z6 &amp;&amp; lq_tmp_x1808 == zero#a3L5}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>210: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1841:{lq_tmp_x1834 : (Ptr Word8^"lq_tmp_x1843") | 0 &lt; plen lq_tmp_x1834}
-&gt; lq_tmp_x1842:Word8^"lq_tmp_x1843" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1830 : (Ptr {VV#1756 : a^"lq_tmp_x1758" | k_1757[VV#1759:=lq_tmp_x1830]})^"lq_tmp_x1761" | k_1760[VV#1759:=lq_tmp_x1830] &amp;&amp; lq_tmp_x1830 == p#a3L7}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1821:{lq_tmp_x1816 : (Ptr {VV#1823 : a^"lq_tmp_x1825" | k_1824}) | 0 &lt;= plen lq_tmp_x1816}
-&gt; lq_tmp_x1822:{lq_tmp_x1817 : Int | lq_tmp_x1817 &lt;= plen lq_tmp_x1821}
-&gt; {lq_tmp_x1818 : (Ptr {lq_tmp_x1829 : Word8^"lq_tmp_x1828" | k_1827[VV#1826:=lq_tmp_x1829]}) | 0 &lt;= plen lq_tmp_x1818 &amp;&amp; pbase lq_tmp_x1818 == pbase lq_tmp_x1821 &amp;&amp; plen lq_tmp_x1818 == plen lq_tmp_x1821 - lq_tmp_x1822}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1831 : Int | lq_tmp_x1831 == (1  :  int) &amp;&amp; lq_tmp_x1831 == lq_anf__d3Zd}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1849 : Word8^"lq_tmp_x1699" | lq_tmp_x1849 == lq_anf__d3Z6 &amp;&amp; lq_tmp_x1849 == zero#a3L5}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>211: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1882:{lq_tmp_x1875 : (Ptr Word8^"lq_tmp_x1884") | 0 &lt; plen lq_tmp_x1875}
-&gt; lq_tmp_x1883:Word8^"lq_tmp_x1884" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1871 : (Ptr {VV#1756 : a^"lq_tmp_x1758" | k_1757[VV#1759:=lq_tmp_x1871]})^"lq_tmp_x1761" | k_1760[VV#1759:=lq_tmp_x1871] &amp;&amp; lq_tmp_x1871 == p#a3L7}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1862:{lq_tmp_x1857 : (Ptr {VV#1864 : a^"lq_tmp_x1866" | k_1865}) | 0 &lt;= plen lq_tmp_x1857}
-&gt; lq_tmp_x1863:{lq_tmp_x1858 : Int | lq_tmp_x1858 &lt;= plen lq_tmp_x1862}
-&gt; {lq_tmp_x1859 : (Ptr {lq_tmp_x1870 : Word8^"lq_tmp_x1869" | k_1868[VV#1867:=lq_tmp_x1870]}) | 0 &lt;= plen lq_tmp_x1859 &amp;&amp; pbase lq_tmp_x1859 == pbase lq_tmp_x1862 &amp;&amp; plen lq_tmp_x1859 == plen lq_tmp_x1862 - lq_tmp_x1863}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1872 : Int | lq_tmp_x1872 == (2  :  int) &amp;&amp; lq_tmp_x1872 == lq_anf__d3Zg}</span><span class='hs-num'>2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1890 : Word8^"lq_tmp_x1699" | lq_tmp_x1890 == lq_anf__d3Z6 &amp;&amp; lq_tmp_x1890 == zero#a3L5}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>212: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1923:{lq_tmp_x1916 : (Ptr Word8^"lq_tmp_x1925") | 0 &lt; plen lq_tmp_x1916}
-&gt; lq_tmp_x1924:Word8^"lq_tmp_x1925" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1912 : (Ptr {VV#1756 : a^"lq_tmp_x1758" | k_1757[VV#1759:=lq_tmp_x1912]})^"lq_tmp_x1761" | k_1760[VV#1759:=lq_tmp_x1912] &amp;&amp; lq_tmp_x1912 == p#a3L7}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1903:{lq_tmp_x1898 : (Ptr {VV#1905 : a^"lq_tmp_x1907" | k_1906}) | 0 &lt;= plen lq_tmp_x1898}
-&gt; lq_tmp_x1904:{lq_tmp_x1899 : Int | lq_tmp_x1899 &lt;= plen lq_tmp_x1903}
-&gt; {lq_tmp_x1900 : (Ptr {lq_tmp_x1911 : Word8^"lq_tmp_x1910" | k_1909[VV#1908:=lq_tmp_x1911]}) | 0 &lt;= plen lq_tmp_x1900 &amp;&amp; pbase lq_tmp_x1900 == pbase lq_tmp_x1903 &amp;&amp; plen lq_tmp_x1900 == plen lq_tmp_x1903 - lq_tmp_x1904}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1913 : Int | lq_tmp_x1913 == (3  :  int) &amp;&amp; lq_tmp_x1913 == lq_anf__d3Zj}</span><span class='hs-num'>3</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1931 : Word8^"lq_tmp_x1699" | lq_tmp_x1931 == lq_anf__d3Z6 &amp;&amp; lq_tmp_x1931 == zero#a3L5}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>213: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x2069 : (ForeignPtr {VV#2063 : a^"lq_tmp_x2065" | k_2064[VV#2066:=lq_tmp_x2069]})^"lq_tmp_x2068" "lq_tmp_x63" | k_2067[VV#2066:=lq_tmp_x2069]}
-&gt; (IO {lq_tmp_x2069 : (ForeignPtr {VV#2063 : a^"lq_tmp_x2065" | k_2064[VV#2066:=lq_tmp_x2069]})^"lq_tmp_x2068" "lq_tmp_x65" | k_2067[VV#2066:=lq_tmp_x2069]})^"lq_tmp_x2059" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2070 : (ForeignPtr {VV#1721 : a^"lq_tmp_x1723" | k_1722[VV#1724:=lq_tmp_x2070]})^"lq_tmp_x1726" | k_1725[VV#1724:=lq_tmp_x2070] &amp;&amp; lq_tmp_x2070 == fp#a3L6}</span><span class='hs-varid'>fp</span></a>
<span class=hs-linenum>214: </span>        <span class='hs-keyword'>where</span>
<span class=hs-linenum>215: </span>           <a class=annot href="#"><span class=annottext>{lq_tmp_x1700 : Word8^"lq_tmp_x1699" | lq_tmp_x1700 == lq_anf__d3Z6}</span><span class='hs-varid'>zero</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1700 : Word8^"lq_tmp_x1699" | lq_tmp_x1700 == lq_anf__d3Z6}</span><span class='hs-num'>0</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span>
</pre>
</div>
<p></p>
<p><strong>Allocate a block and write 4 zeros into it</strong></p>
<p>How to <em>prevent overflows</em> e.g. writing 5 or 50 zeros?</p>
<p><br></p>
<div class="fragment">
<p><strong>Step 1</strong></p>
<em>Refine pointers</em> with allocated size
</div>
<p><br></p>
<div class="fragment">
<p><strong>Step 2</strong></p>
<em>Track sizes</em> in pointer operations
</div>
<p>Refined API: Types</p>
<p><br></p>
<p><strong>1. Refine pointers with allocated size</strong></p>
<pre><span class=hs-linenum>249: </span><span class='hs-definition'>measure</span> <span class='hs-varid'>plen</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> 
<span class=hs-linenum>250: </span><span class='hs-definition'>measure</span> <span class='hs-varid'>fplen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span> 
</pre>
<p><br></p>
<div class="fragment">
<p>Abbreviations for pointers of size <code>N</code></p>
<pre><span class=hs-linenum>259: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>PtrN</span> <span class='hs-varid'>a</span> <span class='hs-conid'>N</span>        <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span>  <span class='hs-varid'>plen</span> <span class='hs-varid'>v</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> 
<span class=hs-linenum>260: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>ForeignPtrN</span> <span class='hs-varid'>a</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-keyword'>_</span> <span class='hs-keyglyph'>|</span>  <span class='hs-varid'>fplen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> 
</pre>
</div>
<p>Refined API: Ops (1/3)</p>
<div class="fragment">
<p><strong>Create</strong></p>
<pre><span class=hs-linenum>271: </span><span class='hs-definition'>malloc</span>  <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ForeignPtrN</span> <span class='hs-varid'>a</span> <span class='hs-varid'>n</span>
</pre>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Unwrap and Use</strong></p>
<pre><span class=hs-linenum>281: </span><span class='hs-definition'>withForeignPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>fp</span><span class='hs-conop'>:</span><span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span> 
<span class=hs-linenum>282: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrN</span> <span class='hs-varid'>a</span> <span class='hs-layout'>(</span><span class='hs-varid'>fplen</span> <span class='hs-varid'>fp</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>  
<span class=hs-linenum>283: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>b</span>             
</pre>
</div>
<p>Refined API: Ops (2/3)</p>
<p><br></p>
<p><strong>Arithmetic</strong></p>
<p>Refine type to track <em>remaining</em> buffer size</p>
<p><br></p>
<div class="fragment">
<pre><span class=hs-linenum>299: </span><span class='hs-definition'>plusPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span>
<span class=hs-linenum>300: </span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>o</span><span class='hs-conop'>:</span><span class='hs-layout'>{</span><span class='hs-conid'>Nat</span><span class='hs-keyglyph'>|</span><span class='hs-varid'>o</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>plen</span> <span class='hs-varid'>p</span><span class='hs-layout'>}</span>   <span class='hs-comment'>-- in bounds</span>
<span class=hs-linenum>301: </span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>PtrN</span> <span class='hs-varid'>b</span> <span class='hs-layout'>(</span><span class='hs-varid'>plen</span> <span class='hs-varid'>b</span> <span class='hs-comment'>-</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>   <span class='hs-comment'>-- remainder</span>
</pre>
</div>
<p>Refined API: Ops (3/3)</p>
<p><strong>Read &amp; Write require non-empty remaining buffer</strong></p>
<p><br></p>
<div class="fragment">
<p><strong>Read</strong></p>
<pre><span class=hs-linenum>316: </span><span class='hs-definition'>peek</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>0</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>plen</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-varid'>a</span>  
</pre>
</div>
<br>
<div class="fragment">
<p><strong>Write</strong></p>
<pre><span class=hs-linenum>325: </span><span class='hs-definition'>poke</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>|</span> <span class='hs-num'>0</span> <span class='hs-varop'>&lt;</span> <span class='hs-varid'>plen</span> <span class='hs-varid'>v</span><span class='hs-layout'>}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>  
</pre>
</div>
<p></p>
<p>How to <em>prevent overflows</em> e.g. writing 5 or 50 zeros?</p>
<p><br></p>
<div class="fragment">
<pre><span class=hs-linenum>338: </span><a class=annot href="#"><span class=annottext>forall a.
(IO (ForeignPtr a^"lq_tmp_x279")^"lq_tmp_x280")^"lq_tmp_x281"</span><span class='hs-definition'>exBad</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#1280 : (ForeignPtr {VV#1277 : a^"lq_tmp_x1279" | k_1278})^"lq_tmp_x1282" | k_1281}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x1271:{lq_tmp_x1267 : Int | lq_tmp_x1267 &gt;= 0}
-&gt; (IO {lq_tmp_x1268 : (ForeignPtr {VV#1272 : a^"lq_tmp_x1274" | k_1273}) | 0 &lt;= fplen lq_tmp_x1268 &amp;&amp; fplen lq_tmp_x1268 == lq_tmp_x1271})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1275 : Int | lq_tmp_x1275 == (4  :  int) &amp;&amp; lq_tmp_x1275 == lq_anf__d3YL}</span><span class='hs-num'>4</span></a>
<span class=hs-linenum>339: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x1301:(ForeignPtr {VV#1303 : a^"lq_tmp_x1305" | k_1304})
-&gt; lq_tmp_x1302:(lq_tmp_x1300:{lq_tmp_x1294 : (Ptr {VV#1303 : a^"lq_tmp_x1305" | k_1304}) | 0 &lt;= plen lq_tmp_x1294 &amp;&amp; plen lq_tmp_x1294 == fplen lq_tmp_x1301}
                 -&gt; (IO {lq_tmp_x1309 : ()^"lq_tmp_x1308" | k_1307[VV#1306:=lq_tmp_x1309]}))
-&gt; (IO {lq_tmp_x1309 : ()^"lq_tmp_x1308" | k_1307[VV#1306:=lq_tmp_x1309]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1310 : (ForeignPtr {VV#1277 : a^"lq_tmp_x1279" | k_1278[VV#1280:=lq_tmp_x1310]})^"lq_tmp_x1282" | k_1281[VV#1280:=lq_tmp_x1310] &amp;&amp; lq_tmp_x1310 == fp#a3L9}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1568:(lq_tmp_x1567:(lq_tmp_x1570:{lq_tmp_x1583 : (Ptr {VV#1571 : a^"lq_tmp_x1573" | k_1572[VV#1574:=lq_tmp_x1583]})^"lq_tmp_x1576" | k_1575[VV#1574:=lq_tmp_x1583]}
                            -&gt; {lq_tmp_x1585 : (IO {lq_tmp_x1584 : ()^"lq_tmp_x1579" | k_1578[VV#1577:=lq_tmp_x1584][VV#1580:=lq_tmp_x1585]})^"lq_tmp_x1582" | k_1581[VV#1580:=lq_tmp_x1585]})
              -&gt; {lq_tmp_x1594 : (IO {lq_tmp_x1593 : ()^"lq_tmp_x1589" | k_1588[VV#1587:=lq_tmp_x1593][VV#1590:=lq_tmp_x1594]})^"lq_tmp_x1592" | k_1591[VV#1590:=lq_tmp_x1594]})
-&gt; lq_tmp_x1569:(lq_tmp_x1570:{lq_tmp_x1583 : (Ptr {VV#1571 : a^"lq_tmp_x1573" | k_1572[VV#1574:=lq_tmp_x1583]})^"lq_tmp_x1576" | k_1575[VV#1574:=lq_tmp_x1583]}
                 -&gt; {lq_tmp_x1585 : (IO {lq_tmp_x1584 : ()^"lq_tmp_x1579" | k_1578[VV#1577:=lq_tmp_x1584][VV#1580:=lq_tmp_x1585]})^"lq_tmp_x1582" | k_1581[VV#1580:=lq_tmp_x1585]})
-&gt; {lq_tmp_x1594 : (IO {lq_tmp_x1593 : ()^"lq_tmp_x1589" | k_1588[VV#1587:=lq_tmp_x1593][VV#1590:=lq_tmp_x1594]})^"lq_tmp_x1592" | k_1591[VV#1590:=lq_tmp_x1594]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#1315 : (Ptr {VV#1312 : a^"lq_tmp_x1314" | k_1313})^"lq_tmp_x1317" | k_1316}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>340: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1356:{lq_tmp_x1349 : (Ptr Word8^"lq_tmp_x1358") | 0 &lt; plen lq_tmp_x1349}
-&gt; lq_tmp_x1357:Word8^"lq_tmp_x1358" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1345 : (Ptr {VV#1312 : a^"lq_tmp_x1314" | k_1313[VV#1315:=lq_tmp_x1345]})^"lq_tmp_x1317" | k_1316[VV#1315:=lq_tmp_x1345] &amp;&amp; lq_tmp_x1345 == p#a3La}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1336:{lq_tmp_x1331 : (Ptr {VV#1338 : a^"lq_tmp_x1340" | k_1339}) | 0 &lt;= plen lq_tmp_x1331}
-&gt; lq_tmp_x1337:{lq_tmp_x1332 : Int | lq_tmp_x1332 &lt;= plen lq_tmp_x1336}
-&gt; {lq_tmp_x1333 : (Ptr {lq_tmp_x1344 : Word8^"lq_tmp_x1343" | k_1342[VV#1341:=lq_tmp_x1344]}) | 0 &lt;= plen lq_tmp_x1333 &amp;&amp; pbase lq_tmp_x1333 == pbase lq_tmp_x1336 &amp;&amp; plen lq_tmp_x1333 == plen lq_tmp_x1336 - lq_tmp_x1337}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1346 : Int | lq_tmp_x1346 == (0  :  int) &amp;&amp; lq_tmp_x1346 == lq_anf__d3YO}</span><span class='hs-num'>0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1364 : Word8^"lq_tmp_x1255" | lq_tmp_x1364 == lq_anf__d3YK &amp;&amp; lq_tmp_x1364 == zero#a3L8}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>341: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1397:{lq_tmp_x1390 : (Ptr Word8^"lq_tmp_x1399") | 0 &lt; plen lq_tmp_x1390}
-&gt; lq_tmp_x1398:Word8^"lq_tmp_x1399" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1386 : (Ptr {VV#1312 : a^"lq_tmp_x1314" | k_1313[VV#1315:=lq_tmp_x1386]})^"lq_tmp_x1317" | k_1316[VV#1315:=lq_tmp_x1386] &amp;&amp; lq_tmp_x1386 == p#a3La}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1377:{lq_tmp_x1372 : (Ptr {VV#1379 : a^"lq_tmp_x1381" | k_1380}) | 0 &lt;= plen lq_tmp_x1372}
-&gt; lq_tmp_x1378:{lq_tmp_x1373 : Int | lq_tmp_x1373 &lt;= plen lq_tmp_x1377}
-&gt; {lq_tmp_x1374 : (Ptr {lq_tmp_x1385 : Word8^"lq_tmp_x1384" | k_1383[VV#1382:=lq_tmp_x1385]}) | 0 &lt;= plen lq_tmp_x1374 &amp;&amp; pbase lq_tmp_x1374 == pbase lq_tmp_x1377 &amp;&amp; plen lq_tmp_x1374 == plen lq_tmp_x1377 - lq_tmp_x1378}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1387 : Int | lq_tmp_x1387 == (1  :  int) &amp;&amp; lq_tmp_x1387 == lq_anf__d3YR}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1405 : Word8^"lq_tmp_x1255" | lq_tmp_x1405 == lq_anf__d3YK &amp;&amp; lq_tmp_x1405 == zero#a3L8}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>342: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1438:{lq_tmp_x1431 : (Ptr Word8^"lq_tmp_x1440") | 0 &lt; plen lq_tmp_x1431}
-&gt; lq_tmp_x1439:Word8^"lq_tmp_x1440" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1427 : (Ptr {VV#1312 : a^"lq_tmp_x1314" | k_1313[VV#1315:=lq_tmp_x1427]})^"lq_tmp_x1317" | k_1316[VV#1315:=lq_tmp_x1427] &amp;&amp; lq_tmp_x1427 == p#a3La}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1418:{lq_tmp_x1413 : (Ptr {VV#1420 : a^"lq_tmp_x1422" | k_1421}) | 0 &lt;= plen lq_tmp_x1413}
-&gt; lq_tmp_x1419:{lq_tmp_x1414 : Int | lq_tmp_x1414 &lt;= plen lq_tmp_x1418}
-&gt; {lq_tmp_x1415 : (Ptr {lq_tmp_x1426 : Word8^"lq_tmp_x1425" | k_1424[VV#1423:=lq_tmp_x1426]}) | 0 &lt;= plen lq_tmp_x1415 &amp;&amp; pbase lq_tmp_x1415 == pbase lq_tmp_x1418 &amp;&amp; plen lq_tmp_x1415 == plen lq_tmp_x1418 - lq_tmp_x1419}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1428 : Int | lq_tmp_x1428 == (2  :  int) &amp;&amp; lq_tmp_x1428 == lq_anf__d3YU}</span><span class='hs-num'>2</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1446 : Word8^"lq_tmp_x1255" | lq_tmp_x1446 == lq_anf__d3YK &amp;&amp; lq_tmp_x1446 == zero#a3L8}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>343: </span>             <a class=annot href="#"><span class=annottext>lq_tmp_x1479:{lq_tmp_x1472 : (Ptr Word8^"lq_tmp_x1481") | 0 &lt; plen lq_tmp_x1472}
-&gt; lq_tmp_x1480:Word8^"lq_tmp_x1481" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x1468 : (Ptr {VV#1312 : a^"lq_tmp_x1314" | k_1313[VV#1315:=lq_tmp_x1468]})^"lq_tmp_x1317" | k_1316[VV#1315:=lq_tmp_x1468] &amp;&amp; lq_tmp_x1468 == p#a3La}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x1459:{lq_tmp_x1454 : (Ptr {VV#1461 : a^"lq_tmp_x1463" | k_1462}) | 0 &lt;= plen lq_tmp_x1454}
-&gt; lq_tmp_x1460:{lq_tmp_x1455 : Int | lq_tmp_x1455 &lt;= plen lq_tmp_x1459}
-&gt; {lq_tmp_x1456 : (Ptr {lq_tmp_x1467 : Word8^"lq_tmp_x1466" | k_1465[VV#1464:=lq_tmp_x1467]}) | 0 &lt;= plen lq_tmp_x1456 &amp;&amp; pbase lq_tmp_x1456 == pbase lq_tmp_x1459 &amp;&amp; plen lq_tmp_x1456 == plen lq_tmp_x1459 - lq_tmp_x1460}</span><span class='hs-varop'>`plusPtr`</span></a> <span class=hs-error><a class=annot href="#"><span class=annottext>{lq_tmp_x1469 : Int | lq_tmp_x1469 == (5  :  int) &amp;&amp; lq_tmp_x1469 == lq_anf__d3YX}</span><span class='hs-num'>5</span></a></span><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1487 : Word8^"lq_tmp_x1255" | lq_tmp_x1487 == lq_anf__d3YK &amp;&amp; lq_tmp_x1487 == zero#a3L8}</span><span class='hs-varid'>zero</span></a> 
<span class=hs-linenum>344: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x1625 : (ForeignPtr {VV#1619 : a^"lq_tmp_x1621" | k_1620[VV#1622:=lq_tmp_x1625]})^"lq_tmp_x1624" "lq_tmp_x63" | k_1623[VV#1622:=lq_tmp_x1625]}
-&gt; (IO {lq_tmp_x1625 : (ForeignPtr {VV#1619 : a^"lq_tmp_x1621" | k_1620[VV#1622:=lq_tmp_x1625]})^"lq_tmp_x1624" "lq_tmp_x65" | k_1623[VV#1622:=lq_tmp_x1625]})^"lq_tmp_x1615" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1626 : (ForeignPtr {VV#1277 : a^"lq_tmp_x1279" | k_1278[VV#1280:=lq_tmp_x1626]})^"lq_tmp_x1282" | k_1281[VV#1280:=lq_tmp_x1626] &amp;&amp; lq_tmp_x1626 == fp#a3L9}</span><span class='hs-varid'>fp</span></a>
<span class=hs-linenum>345: </span>        <span class='hs-keyword'>where</span>
<span class=hs-linenum>346: </span>           <a class=annot href="#"><span class=annottext>{lq_tmp_x1256 : Word8^"lq_tmp_x1255" | lq_tmp_x1256 == lq_anf__d3YK}</span><span class='hs-varid'>zero</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x1256 : Word8^"lq_tmp_x1255" | lq_tmp_x1256 == lq_anf__d3YK}</span><span class='hs-num'>0</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span>
</pre>
</div>
<h2 id="bytestring-api">2. ByteString API</h2>
<p><br></p>
<p>Strategy: Specify and Verify Types for</p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>Low-level <code>Pointer</code> API</li>
<li><strong>Lib-level <code>ByteString</code> API</strong></li>
<li>User-level <code>Application</code> API</li>
</ol>
<p><br></p>
<p>Errors at <em>each</em> level are prevented by types at <em>lower</em> levels</p>
<p></p>
<p><img src="../img/bytestring.png" height=150px></p>
<pre><span class=hs-linenum>374: </span><span class='hs-keyword'>data</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PS</span> <span class='hs-layout'>{</span>
<span class=hs-linenum>375: </span>    <a class=annot href="#"><span class=annottext>lq_tmp_x2197:ByteString^"lq_tmp_x292"
-&gt; (ForeignPtr Word8^"lq_tmp_x293")^"lq_tmp_x294"</span><span class='hs-varid'>bPtr</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>376: </span>  <span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>lq_tmp_x2166:ByteString^"lq_tmp_x289" -&gt; Int^"lq_tmp_x290"</span><span class='hs-varid'>bOff</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span>
<span class=hs-linenum>377: </span>  <span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>lq_tmp_x2135:ByteString^"lq_tmp_x286" -&gt; Int^"lq_tmp_x287"</span><span class='hs-varid'>bLen</span></a> <span class='hs-keyglyph'>::</span> <span class='hs-varop'>!</span><span class='hs-conid'>Int</span>
<span class=hs-linenum>378: </span>  <span class='hs-layout'>}</span>
</pre>
<p></p>
<p><img src="../img/bytestring.png" height=150px></p>
<pre><span class=hs-linenum>387: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>data</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>PS</span> <span class='hs-layout'>{</span>
<span class=hs-linenum>388: </span>      <span class='hs-varid'>bPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>389: </span>    <span class='hs-layout'>,</span> <span class='hs-varid'>bOff</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span>        <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>fplen</span> <span class='hs-varid'>bPtr</span><span class='hs-layout'>}</span>
<span class=hs-linenum>390: </span>    <span class='hs-layout'>,</span> <span class='hs-varid'>bLen</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>v</span> <span class='hs-varop'>+</span> <span class='hs-varid'>bOff</span> <span class='hs-varop'>&lt;=</span> <span class='hs-varid'>fplen</span> <span class='hs-varid'>bPtr</span><span class='hs-layout'>}</span>
<span class=hs-linenum>391: </span>    <span class='hs-layout'>}</span>                                       <span class='hs-keyword'>@-}</span>
</pre>
<p><img src="../img/bytestring.png" height=150px></p>
<p><br></p>
<p><strong>A Useful Abbreviation</strong></p>
<pre><span class=hs-linenum>402: </span><span class='hs-keyword'>type</span> <span class='hs-conid'>ByteStringN</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>bLen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> 
</pre>
<div class="hidden">
<pre><span class=hs-linenum>408: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ByteStringN</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>bLen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
</pre>
</div>
<p></p>
<p><br></p>
<pre><span class=hs-linenum>418: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>good1</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteStringN</span> <span class='hs-num'>5</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>419: </span><a class=annot href="#"><span class=annottext>(IO {v : ByteString | bLen v == 5})</span><span class='hs-definition'>good1</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#1159 : (ForeignPtr {VV#1156 : Word8^"lq_tmp_x1158" | k_1157})^"lq_tmp_x1161" | k_1160}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x1149:{lq_tmp_x1145 : Int | lq_tmp_x1145 &gt;= 0}
-&gt; (IO {lq_tmp_x1146 : (ForeignPtr {lq_tmp_x1153 : Word8^"lq_tmp_x1152" | k_1151[VV#1150:=lq_tmp_x1153]}) | 0 &lt;= fplen lq_tmp_x1146 &amp;&amp; fplen lq_tmp_x1146 == lq_tmp_x1149})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1154 : Int | lq_tmp_x1154 == (5  :  int) &amp;&amp; lq_tmp_x1154 == lq_anf__d3YE}</span><span class='hs-num'>5</span></a>
<span class=hs-linenum>420: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x1209 : ByteString^"lq_tmp_x1208" "lq_tmp_x63" | k_1207[VV#1206:=lq_tmp_x1209]}
-&gt; (IO {lq_tmp_x1209 : ByteString^"lq_tmp_x1208" "lq_tmp_x65" | k_1207[VV#1206:=lq_tmp_x1209]})^"lq_tmp_x1202" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x1189:(ForeignPtr Word8)
-&gt; lq_tmp_x1190:{lq_tmp_x1183 : Int | lq_tmp_x1183 &gt;= 0 &amp;&amp; lq_tmp_x1183 &lt;= fplen lq_tmp_x1189}
-&gt; lq_tmp_x1191:{lq_tmp_x1184 : Int | lq_tmp_x1184 &gt;= 0 &amp;&amp; lq_tmp_x1184 + lq_tmp_x1190 &lt;= fplen lq_tmp_x1189}
-&gt; {lq_tmp_x1185 : ByteString | bLen lq_tmp_x1185 == lq_tmp_x1191 &amp;&amp; bOff lq_tmp_x1185 == lq_tmp_x1190 &amp;&amp; bPtr lq_tmp_x1185 == lq_tmp_x1189}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1193 : (ForeignPtr {lq_tmp_x1192 : Word8^"lq_tmp_x1158" | k_1157[VV#1156:=lq_tmp_x1192][VV#1159:=lq_tmp_x1193]})^"lq_tmp_x1161" | k_1160[VV#1159:=lq_tmp_x1193] &amp;&amp; lq_tmp_x1193 == fp#a3Lb}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1194 : Int | lq_tmp_x1194 == (0  :  int) &amp;&amp; lq_tmp_x1194 == lq_anf__d3YG}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1195 : Int | lq_tmp_x1195 == (5  :  int) &amp;&amp; lq_tmp_x1195 == lq_anf__d3YH}</span><span class='hs-num'>5</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>421: </span>
<span class=hs-linenum>422: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>good2</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteStringN</span> <span class='hs-num'>3</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>423: </span><a class=annot href="#"><span class=annottext>(IO {v : ByteString | bLen v == 3})</span><span class='hs-definition'>good2</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#1051 : (ForeignPtr {VV#1048 : Word8^"lq_tmp_x1050" | k_1049})^"lq_tmp_x1053" | k_1052}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x1041:{lq_tmp_x1037 : Int | lq_tmp_x1037 &gt;= 0}
-&gt; (IO {lq_tmp_x1038 : (ForeignPtr {lq_tmp_x1045 : Word8^"lq_tmp_x1044" | k_1043[VV#1042:=lq_tmp_x1045]}) | 0 &lt;= fplen lq_tmp_x1038 &amp;&amp; fplen lq_tmp_x1038 == lq_tmp_x1041})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1046 : Int | lq_tmp_x1046 == (5  :  int) &amp;&amp; lq_tmp_x1046 == lq_anf__d3Yy}</span><span class='hs-num'>5</span></a>
<span class=hs-linenum>424: </span>           <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x1101 : ByteString^"lq_tmp_x1100" "lq_tmp_x63" | k_1099[VV#1098:=lq_tmp_x1101]}
-&gt; (IO {lq_tmp_x1101 : ByteString^"lq_tmp_x1100" "lq_tmp_x65" | k_1099[VV#1098:=lq_tmp_x1101]})^"lq_tmp_x1094" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x1081:(ForeignPtr Word8)
-&gt; lq_tmp_x1082:{lq_tmp_x1075 : Int | lq_tmp_x1075 &gt;= 0 &amp;&amp; lq_tmp_x1075 &lt;= fplen lq_tmp_x1081}
-&gt; lq_tmp_x1083:{lq_tmp_x1076 : Int | lq_tmp_x1076 &gt;= 0 &amp;&amp; lq_tmp_x1076 + lq_tmp_x1082 &lt;= fplen lq_tmp_x1081}
-&gt; {lq_tmp_x1077 : ByteString | bLen lq_tmp_x1077 == lq_tmp_x1083 &amp;&amp; bOff lq_tmp_x1077 == lq_tmp_x1082 &amp;&amp; bPtr lq_tmp_x1077 == lq_tmp_x1081}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1085 : (ForeignPtr {lq_tmp_x1084 : Word8^"lq_tmp_x1050" | k_1049[VV#1048:=lq_tmp_x1084][VV#1051:=lq_tmp_x1085]})^"lq_tmp_x1053" | k_1052[VV#1051:=lq_tmp_x1085] &amp;&amp; lq_tmp_x1085 == fp#a3Lc}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1086 : Int | lq_tmp_x1086 == (2  :  int) &amp;&amp; lq_tmp_x1086 == lq_anf__d3YA}</span><span class='hs-num'>2</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x1087 : Int | lq_tmp_x1087 == (3  :  int) &amp;&amp; lq_tmp_x1087 == lq_anf__d3YB}</span><span class='hs-num'>3</span></a><span class='hs-layout'>)</span>
</pre>
<p><br></p>
<div class="fragment">
<strong>Note:</strong> <em>length</em> of <code>good2</code> is <code>3</code> which is <em>less than</em> allocated size <code>5</code>
</div>
<p></p>
<p><br></p>
<pre><span class=hs-linenum>438: </span><a class=annot href="#"><span class=annottext>(IO ByteString^"lq_tmp_x277")^"lq_tmp_x278"</span><span class='hs-definition'>bad1</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#943 : (ForeignPtr {VV#940 : Word8^"lq_tmp_x942" | k_941})^"lq_tmp_x945" | k_944}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x933:{lq_tmp_x929 : Int | lq_tmp_x929 &gt;= 0}
-&gt; (IO {lq_tmp_x930 : (ForeignPtr {lq_tmp_x937 : Word8^"lq_tmp_x936" | k_935[VV#934:=lq_tmp_x937]}) | 0 &lt;= fplen lq_tmp_x930 &amp;&amp; fplen lq_tmp_x930 == lq_tmp_x933})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x938 : Int | lq_tmp_x938 == (3  :  int) &amp;&amp; lq_tmp_x938 == lq_anf__d3Ys}</span><span class='hs-num'>3</span></a> 
<span class=hs-linenum>439: </span>          <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x993 : ByteString^"lq_tmp_x992" "lq_tmp_x63" | k_991[VV#990:=lq_tmp_x993]}
-&gt; (IO {lq_tmp_x993 : ByteString^"lq_tmp_x992" "lq_tmp_x65" | k_991[VV#990:=lq_tmp_x993]})^"lq_tmp_x986" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x973:(ForeignPtr Word8)
-&gt; lq_tmp_x974:{lq_tmp_x967 : Int | lq_tmp_x967 &gt;= 0 &amp;&amp; lq_tmp_x967 &lt;= fplen lq_tmp_x973}
-&gt; lq_tmp_x975:{lq_tmp_x968 : Int | lq_tmp_x968 &gt;= 0 &amp;&amp; lq_tmp_x968 + lq_tmp_x974 &lt;= fplen lq_tmp_x973}
-&gt; {lq_tmp_x969 : ByteString | bLen lq_tmp_x969 == lq_tmp_x975 &amp;&amp; bOff lq_tmp_x969 == lq_tmp_x974 &amp;&amp; bPtr lq_tmp_x969 == lq_tmp_x973}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x977 : (ForeignPtr {lq_tmp_x976 : Word8^"lq_tmp_x942" | k_941[VV#940:=lq_tmp_x976][VV#943:=lq_tmp_x977]})^"lq_tmp_x945" | k_944[VV#943:=lq_tmp_x977] &amp;&amp; lq_tmp_x977 == fp#a3Ld}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x978 : Int | lq_tmp_x978 == (0  :  int) &amp;&amp; lq_tmp_x978 == lq_anf__d3Yu}</span><span class='hs-num'>0</span></a> <span class=hs-error><a class=annot href="#"><span class=annottext>{lq_tmp_x979 : Int | lq_tmp_x979 == (10  :  int) &amp;&amp; lq_tmp_x979 == lq_anf__d3Yv}</span><span class='hs-num'>10</span></a></span><span class='hs-layout'>)</span>
<span class=hs-linenum>440: </span>
<span class=hs-linenum>441: </span><a class=annot href="#"><span class=annottext>(IO ByteString^"lq_tmp_x275")^"lq_tmp_x276"</span><span class='hs-definition'>bad2</span></a> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#835 : (ForeignPtr {VV#832 : Word8^"lq_tmp_x834" | k_833})^"lq_tmp_x837" | k_836}</span><span class='hs-varid'>fp</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x825:{lq_tmp_x821 : Int | lq_tmp_x821 &gt;= 0}
-&gt; (IO {lq_tmp_x822 : (ForeignPtr {lq_tmp_x829 : Word8^"lq_tmp_x828" | k_827[VV#826:=lq_tmp_x829]}) | 0 &lt;= fplen lq_tmp_x822 &amp;&amp; fplen lq_tmp_x822 == lq_tmp_x825})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x830 : Int | lq_tmp_x830 == (3  :  int) &amp;&amp; lq_tmp_x830 == lq_anf__d3Ym}</span><span class='hs-num'>3</span></a>
<span class=hs-linenum>442: </span>          <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x885 : ByteString^"lq_tmp_x884" "lq_tmp_x63" | k_883[VV#882:=lq_tmp_x885]}
-&gt; (IO {lq_tmp_x885 : ByteString^"lq_tmp_x884" "lq_tmp_x65" | k_883[VV#882:=lq_tmp_x885]})^"lq_tmp_x878" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x865:(ForeignPtr Word8)
-&gt; lq_tmp_x866:{lq_tmp_x859 : Int | lq_tmp_x859 &gt;= 0 &amp;&amp; lq_tmp_x859 &lt;= fplen lq_tmp_x865}
-&gt; lq_tmp_x867:{lq_tmp_x860 : Int | lq_tmp_x860 &gt;= 0 &amp;&amp; lq_tmp_x860 + lq_tmp_x866 &lt;= fplen lq_tmp_x865}
-&gt; {lq_tmp_x861 : ByteString | bLen lq_tmp_x861 == lq_tmp_x867 &amp;&amp; bOff lq_tmp_x861 == lq_tmp_x866 &amp;&amp; bPtr lq_tmp_x861 == lq_tmp_x865}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x869 : (ForeignPtr {lq_tmp_x868 : Word8^"lq_tmp_x834" | k_833[VV#832:=lq_tmp_x868][VV#835:=lq_tmp_x869]})^"lq_tmp_x837" | k_836[VV#835:=lq_tmp_x869] &amp;&amp; lq_tmp_x869 == fp#a3Le}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x870 : Int | lq_tmp_x870 == (2  :  int) &amp;&amp; lq_tmp_x870 == lq_anf__d3Yo}</span><span class='hs-num'>2</span></a> <span class=hs-error><a class=annot href="#"><span class=annottext>{lq_tmp_x871 : Int | lq_tmp_x871 == (2  :  int) &amp;&amp; lq_tmp_x871 == lq_anf__d3Yp}</span><span class='hs-num'>2</span></a></span><span class='hs-layout'>)</span>
</pre>
<p><br></p>
<div class="fragment">
Claimed length <em>exceeds</em> allocation ... <strong>rejected</strong> at compile time
</div>
<p></p>
<div class="hidden">
<pre><span class=hs-linenum>455: </span><span class='hs-definition'>create</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
</pre>
</div>
<p><em>Allocate</em> and <em>fill</em> a <code>ByteString</code></p>
<p><br></p>
<div class="fragment">
<p><strong>Specification</strong></p>
<pre><span class=hs-linenum>466: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>create</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>PtrN</span> <span class='hs-conid'>Word8</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<span class=hs-linenum>467: </span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteStringN</span> <span class='hs-varid'>n</span>                <span class='hs-keyword'>@-}</span>
</pre>
</div>
<div class="fragment">
<p><strong>Implementation</strong></p>
<pre><span class=hs-linenum>476: </span><a class=annot href="#"><span class=annottext>lq_tmp_x4535:{v : Int | v &gt;= 0}
-&gt; lq_tmp_x4536:(lq_tmp_x4534:{VV : (Ptr Word8) | 0 &lt;= plen VV &amp;&amp; plen VV == lq_tmp_x4535}
                 -&gt; (IO ()))
-&gt; {v : ByteString | bLen v == lq_tmp_x4535}</span><span class='hs-definition'>create</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4534:{VV : (Ptr Word8) | 0 &lt;= plen VV &amp;&amp; plen VV == n#a3Lf}
-&gt; (IO ())</span><span class='hs-varid'>fill</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4717:(IO {lq_tmp_x4713 : ByteString^"lq_tmp_x4544" "lq_tmp_x246" | k_4543[VV#4542:=lq_tmp_x4713][lq_tmp_x4545:=lq_tmp_x4713][lq_tmp_x4539:=lq_tmp_x4714]})^"lq_tmp_x247"
-&gt; {lq_tmp_x4715 : ByteString^"lq_tmp_x4544" "lq_tmp_x248" | k_4543[VV#4542:=lq_tmp_x4715][lq_tmp_x4545:=lq_tmp_x4715][lq_tmp_x4541:=lq_tmp_x4717]}</span><span class='hs-varid'>unsafePerformIO</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4699:(lq_tmp_x4698:{lq_tmp_x4708 : (IO {lq_tmp_x4707 : ByteString^"lq_tmp_x4703" | k_4702[VV#4701:=lq_tmp_x4707][VV#4704:=lq_tmp_x4708]})^"lq_tmp_x4706" | k_4705[VV#4704:=lq_tmp_x4708]}
              -&gt; {lq_tmp_x4712 : ByteString^"lq_tmp_x4711" | k_4710[VV#4709:=lq_tmp_x4712]})
-&gt; lq_tmp_x4700:{lq_tmp_x4708 : (IO {lq_tmp_x4707 : ByteString^"lq_tmp_x4703" | k_4702[VV#4701:=lq_tmp_x4707][VV#4704:=lq_tmp_x4708]})^"lq_tmp_x4706" | k_4705[VV#4704:=lq_tmp_x4708]}
-&gt; {lq_tmp_x4712 : ByteString^"lq_tmp_x4711" | k_4710[VV#4709:=lq_tmp_x4712]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyword'>do</span>
<span class=hs-linenum>477: </span>  <a class=annot href="#"><span class=annottext>{VV#4561 : (ForeignPtr {VV#4558 : Word8^"lq_tmp_x4560" | k_4559})^"lq_tmp_x4563" | k_4562}</span><span class='hs-varid'>fp</span></a>  <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4551:{lq_tmp_x4547 : Int | lq_tmp_x4547 &gt;= 0}
-&gt; (IO {lq_tmp_x4548 : (ForeignPtr {lq_tmp_x4555 : Word8^"lq_tmp_x4554" | k_4553[VV#4552:=lq_tmp_x4555]}) | 0 &lt;= fplen lq_tmp_x4548 &amp;&amp; fplen lq_tmp_x4548 == lq_tmp_x4551})</span><span class='hs-varid'>malloc</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4556 : Int | lq_tmp_x4556 &gt;= 0 &amp;&amp; lq_tmp_x4556 == n#a3Lf}</span><span class='hs-varid'>n</span></a>
<span class=hs-linenum>478: </span>  <a class=annot href="#"><span class=annottext>lq_tmp_x4579:(ForeignPtr {lq_tmp_x4584 : Word8^"lq_tmp_x4583" | k_4582[VV#4581:=lq_tmp_x4584]})
-&gt; lq_tmp_x4580:(lq_tmp_x4578:{lq_tmp_x4572 : (Ptr {lq_tmp_x4584 : Word8^"lq_tmp_x4583" | k_4582[VV#4581:=lq_tmp_x4584]}) | 0 &lt;= plen lq_tmp_x4572 &amp;&amp; plen lq_tmp_x4572 == fplen lq_tmp_x4579}
                 -&gt; (IO {lq_tmp_x4588 : ()^"lq_tmp_x4587" | k_4586[VV#4585:=lq_tmp_x4588]}))
-&gt; (IO {lq_tmp_x4588 : ()^"lq_tmp_x4587" | k_4586[VV#4585:=lq_tmp_x4588]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4590 : (ForeignPtr {lq_tmp_x4589 : Word8^"lq_tmp_x4560" | k_4559[VV#4558:=lq_tmp_x4589][VV#4561:=lq_tmp_x4590]})^"lq_tmp_x4563" | k_4562[VV#4561:=lq_tmp_x4590] &amp;&amp; lq_tmp_x4590 == fp#a3Lh}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4596:{lq_tmp_x4592 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x4592 &amp;&amp; plen lq_tmp_x4592 == n#a3Lf}
-&gt; (IO ())</span><span class='hs-varid'>fill</span></a> 
<span class=hs-linenum>479: </span>  <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x4632 : ByteString^"lq_tmp_x4631" "lq_tmp_x63" | k_4630[VV#4629:=lq_tmp_x4632]}
-&gt; (IO {lq_tmp_x4632 : ByteString^"lq_tmp_x4631" "lq_tmp_x65" | k_4630[VV#4629:=lq_tmp_x4632]})^"lq_tmp_x4625" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x4612:(ForeignPtr Word8)
-&gt; lq_tmp_x4613:{lq_tmp_x4606 : Int | lq_tmp_x4606 &gt;= 0 &amp;&amp; lq_tmp_x4606 &lt;= fplen lq_tmp_x4612}
-&gt; lq_tmp_x4614:{lq_tmp_x4607 : Int | lq_tmp_x4607 &gt;= 0 &amp;&amp; lq_tmp_x4607 + lq_tmp_x4613 &lt;= fplen lq_tmp_x4612}
-&gt; {lq_tmp_x4608 : ByteString | bLen lq_tmp_x4608 == lq_tmp_x4614 &amp;&amp; bOff lq_tmp_x4608 == lq_tmp_x4613 &amp;&amp; bPtr lq_tmp_x4608 == lq_tmp_x4612}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4616 : (ForeignPtr {lq_tmp_x4615 : Word8^"lq_tmp_x4560" | k_4559[VV#4558:=lq_tmp_x4615][VV#4561:=lq_tmp_x4616]})^"lq_tmp_x4563" | k_4562[VV#4561:=lq_tmp_x4616] &amp;&amp; lq_tmp_x4616 == fp#a3Lh}</span><span class='hs-varid'>fp</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4617 : Int | lq_tmp_x4617 == (0  :  int) &amp;&amp; lq_tmp_x4617 == lq_anf__d40U}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4618 : Int | lq_tmp_x4618 &gt;= 0 &amp;&amp; lq_tmp_x4618 == n#a3Lf}</span><span class='hs-varid'>n</span></a><span class='hs-layout'>)</span>
</pre>
</div>
<!-- CUT
<div class="fragment">
Yikes, there is an error! How to fix?
</div>
-->
<p></p>
<p><strong>Specification</strong></p>
<pre><span class=hs-linenum>494: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>pack</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>s</span><span class='hs-conop'>:</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteStringN</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span> <span class='hs-varid'>s</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
</pre>
<p><br></p>
<div class="fragment">
<p><strong>Implementation</strong></p>
<pre><span class=hs-linenum>504: </span><a class=annot href="#"><span class=annottext>lq_tmp_x4721:[Char]
-&gt; {v : ByteString | bLen v == len lq_tmp_x4721}</span><span class='hs-definition'>pack</span></a> <a class=annot href="#"><span class=annottext>[Char]</span><span class='hs-varid'>str</span></a>      <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4954:{lq_tmp_x4944 : Int | lq_tmp_x4944 &gt;= 0}
-&gt; lq_tmp_x4955:(lq_tmp_x4953:{lq_tmp_x4946 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x4946 &amp;&amp; plen lq_tmp_x4946 == lq_tmp_x4954}
                 -&gt; (IO ()))
-&gt; {lq_tmp_x4950 : ByteString | bLen lq_tmp_x4950 == lq_tmp_x4954}</span><span class='hs-varid'>create</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4956 : Int | lq_tmp_x4956 == len str#a3Li &amp;&amp; lq_tmp_x4956 == n#a3Lj}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4992:(lq_tmp_x4991:(lq_tmp_x4994:{lq_tmp_x5008 : (Ptr {lq_tmp_x5007 : Word8^"lq_tmp_x4997" | k_4996[VV#4995:=lq_tmp_x5007][VV#4998:=lq_tmp_x5008]})^"lq_tmp_x5000" | k_4999[VV#4998:=lq_tmp_x5008]}
                            -&gt; {lq_tmp_x5010 : (IO {lq_tmp_x5009 : ()^"lq_tmp_x5003" | k_5002[VV#5001:=lq_tmp_x5009][VV#5004:=lq_tmp_x5010]})^"lq_tmp_x5006" | k_5005[VV#5004:=lq_tmp_x5010]})
              -&gt; {lq_tmp_x5015 : ByteString^"lq_tmp_x5014" | k_5013[VV#5012:=lq_tmp_x5015]})
-&gt; lq_tmp_x4993:(lq_tmp_x4994:{lq_tmp_x5008 : (Ptr {lq_tmp_x5007 : Word8^"lq_tmp_x4997" | k_4996[VV#4995:=lq_tmp_x5007][VV#4998:=lq_tmp_x5008]})^"lq_tmp_x5000" | k_4999[VV#4998:=lq_tmp_x5008]}
                 -&gt; {lq_tmp_x5010 : (IO {lq_tmp_x5009 : ()^"lq_tmp_x5003" | k_5002[VV#5001:=lq_tmp_x5009][VV#5004:=lq_tmp_x5010]})^"lq_tmp_x5006" | k_5005[VV#5004:=lq_tmp_x5010]})
-&gt; {lq_tmp_x5015 : ByteString^"lq_tmp_x5014" | k_5013[VV#5012:=lq_tmp_x5015]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5030:{lq_tmp_x5026 : (Ptr {lq_tmp_x5025 : Word8^"lq_tmp_x4960" | k_4959[VV#4958:=lq_tmp_x5025][VV#4961:=lq_tmp_x5026]})^"lq_tmp_x4963" | k_4962[VV#4961:=lq_tmp_x5026]}
-&gt; {lq_tmp_x5028 : (IO {lq_tmp_x5027 : ()^"lq_tmp_x4744" | k_4743[VV#4742:=lq_tmp_x5027][VV#4745:=lq_tmp_x5028][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x5030][lq_tmp_x4731:=xs#a3Lk][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4975:=lq_tmp_x5030][lq_tmp_x4976:=xs#a3Lk][lq_tmp_x4969:=lq_tmp_x5027][lq_tmp_x4970:=lq_tmp_x5028][p#a3Lp:=lq_tmp_x5030]})^"lq_tmp_x4747" | k_4746[VV#4745:=lq_tmp_x5028][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x5030][lq_tmp_x4731:=xs#a3Lk][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4975:=lq_tmp_x5030][lq_tmp_x4976:=xs#a3Lk][lq_tmp_x4970:=lq_tmp_x5028][p#a3Lp:=lq_tmp_x5030]}</span><span class='hs-keyglyph'>\</span></a><a class=annot href="#"><span class=annottext>{VV#4961 : (Ptr {VV#4958 : Word8^"lq_tmp_x4960" | k_4959})^"lq_tmp_x4963" | k_4962}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4975:{lq_tmp_x4966 : (Ptr {lq_tmp_x4978 : Word8^"lq_tmp_x4977" "lq_tmp_x4727" | k_4726[VV#4728:=lq_tmp_x4966][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][VV#4725:=lq_tmp_x4978][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]})^"lq_tmp_x4730" | k_4729[VV#4728:=lq_tmp_x4966][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]}
-&gt; lq_tmp_x4976:{lq_tmp_x4968 : [{lq_tmp_x4978 : Word8^"lq_tmp_x4977" "lq_tmp_x4734" | k_4733[VV#4739:=lq_tmp_x4968][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x4975][VV#4732:=lq_tmp_x4978][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]}]&lt;\lq_tmp_x4967 VV -&gt; k_4737[lq_tmp_x4735:=lq_tmp_x4967][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x4975][VV#4736:=lq_tmp_x4978][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]&gt;^"lq_tmp_x4741" | k_4740[VV#4739:=lq_tmp_x4968][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x4975][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]}
-&gt; {lq_tmp_x4970 : (IO {lq_tmp_x4969 : ()^"lq_tmp_x4744" | k_4743[VV#4742:=lq_tmp_x4969][VV#4745:=lq_tmp_x4970][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x4975][lq_tmp_x4731:=lq_tmp_x4976][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]})^"lq_tmp_x4747" | k_4746[VV#4745:=lq_tmp_x4970][fix##36#dStorable_a3QM:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV][lq_tmp_x4724:=lq_tmp_x4975][lq_tmp_x4731:=lq_tmp_x4976][lq_tmp_x4974:=fix#Foreign.Storable.#36#fStorableWord8#35#r2DV]}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4982 : (Ptr {lq_tmp_x4981 : Word8^"lq_tmp_x4960" | k_4959[VV#4958:=lq_tmp_x4981][VV#4961:=lq_tmp_x4982]})^"lq_tmp_x4963" | k_4962[VV#4961:=lq_tmp_x4982] &amp;&amp; lq_tmp_x4982 == p#a3Lp}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4986 : [{lq_tmp_x4983 : Word8^"lq_tmp_x4919" | k_4918[VV#4917:=lq_tmp_x4983][lq_tmp_x4911:=Data.ByteString.Internal.c2w#r2NY][lq_tmp_x4912:=str#a3Li][lq_tmp_x4920:=lq_tmp_x4983][lq_tmp_x4907:=lq_tmp_x4986]}] | len lq_tmp_x4986 == len str#a3Li &amp;&amp; len lq_tmp_x4986 &gt;= 0 &amp;&amp; bLens lq_tmp_x4986 &gt;= 0 &amp;&amp; lq_tmp_x4986 == xs#a3Lk}</span><span class='hs-varid'>xs</span></a>
<span class=hs-linenum>505: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>506: </span>  <a class=annot href="#"><span class=annottext>{lq_tmp_x4932 : Int | lq_tmp_x4932 == len str#a3Li}</span><span class='hs-varid'>n</span></a>           <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4934:[{lq_tmp_x4938 : Char^"lq_tmp_x4937" | k_4936[VV#4935:=lq_tmp_x4938]}]
-&gt; {lq_tmp_x4932 : Int | lq_tmp_x4932 == len lq_tmp_x4934}</span><span class='hs-varid'>length</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4942 : [Char] | len lq_tmp_x4942 &gt;= 0 &amp;&amp; bLens lq_tmp_x4942 &gt;= 0 &amp;&amp; lq_tmp_x4942 == str#a3Li}</span><span class='hs-varid'>str</span></a>
<span class=hs-linenum>507: </span>  <a class=annot href="#"><span class=annottext>{lq_tmp_x4907 : [{lq_tmp_x4920 : Word8^"lq_tmp_x4919" | k_4918[VV#4917:=lq_tmp_x4920][lq_tmp_x4911:=Data.ByteString.Internal.c2w#r2NY][lq_tmp_x4912:=str#a3Li]}] | len lq_tmp_x4907 == len str#a3Li}</span><span class='hs-varid'>xs</span></a>          <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4911:(lq_tmp_x4910:{lq_tmp_x4916 : Char^"lq_tmp_x4915" | k_4914[VV#4913:=lq_tmp_x4916]}
              -&gt; {lq_tmp_x4920 : Word8^"lq_tmp_x4919" | k_4918[VV#4917:=lq_tmp_x4920]})
-&gt; lq_tmp_x4912:[{lq_tmp_x4916 : Char^"lq_tmp_x4915" | k_4914[VV#4913:=lq_tmp_x4916]}]
-&gt; {lq_tmp_x4907 : [{lq_tmp_x4920 : Word8^"lq_tmp_x4919" | k_4918[VV#4917:=lq_tmp_x4920]}] | len lq_tmp_x4907 == len lq_tmp_x4912}</span><span class='hs-varid'>map</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4924:Char^"lq_tmp_x253" -&gt; Word8^"lq_tmp_x254"</span><span class='hs-varid'>c2w</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4928 : [Char] | len lq_tmp_x4928 &gt;= 0 &amp;&amp; bLens lq_tmp_x4928 &gt;= 0 &amp;&amp; lq_tmp_x4928 == str#a3Li}</span><span class='hs-varid'>str</span></a>
<span class=hs-linenum>508: </span>  <a class=annot href="#"><span class=annottext>forall a.
(Storable [Bivariant]
[] a) =&gt;
lq_tmp_x4724:{VV#4728 : (Ptr {VV#4725 : a^"lq_tmp_x4727" | k_4726})^"lq_tmp_x4730" | k_4729}
-&gt; lq_tmp_x4731:{VV#4739 : [{VV#4732 : a^"lq_tmp_x4734" | k_4733}]&lt;\lq_tmp_x4735 VV -&gt; k_4737&gt;^"lq_tmp_x4741" | k_4740}
-&gt; {VV#4745 : (IO {VV#4742 : ()^"lq_tmp_x4744" | k_4743})^"lq_tmp_x4747" | k_4746}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV#4751 : (Ptr {VV#4748 : a^"lq_tmp_x4750" | k_4749})^"lq_tmp_x4753" | k_4752}</span><span class='hs-varid'>p</span></a> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4828:{lq_tmp_x4821 : (Ptr a^"lq_tmp_x4830") | 0 &lt; plen lq_tmp_x4821}
-&gt; lq_tmp_x4829:a^"lq_tmp_x4830" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4832 : (Ptr {VV#4748 : a^"lq_tmp_x4750" | k_4749[VV#4751:=lq_tmp_x4832]})^"lq_tmp_x4753" | k_4752[VV#4751:=lq_tmp_x4832] &amp;&amp; lq_tmp_x4832 == p#a3Lm}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{VV#4754 : a^"lq_tmp_x4756" | k_4755[p#a3Lm:=p#a3Lm][lq_tmp_x4770:=p#a3Lm][VV#4761:=lq_anf__d40Z][lq_tmp_x4776:=lq_anf__d40Z][lq_tmp_x4801:=lq_anf__d40Z] &amp;&amp; VV#4754 == x#a3Ln}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x52:(IO {lq_tmp_x4884 : ()^"lq_tmp_x4883" "lq_tmp_x54" | k_4882[VV#4881:=lq_tmp_x4884]})^"lq_tmp_x4877" "lq_tmp_x53"
-&gt; lq_tmp_x55:(IO {lq_tmp_x4888 : ()^"lq_tmp_x4887" "lq_tmp_x57" | k_4886[VV#4885:=lq_tmp_x4888]})^"lq_tmp_x4877" "lq_tmp_x56"
-&gt; (IO {lq_tmp_x4888 : ()^"lq_tmp_x4887" "lq_tmp_x59" | k_4886[VV#4885:=lq_tmp_x4888]})^"lq_tmp_x4877" "lq_tmp_x58"</span><span class='hs-varop'>&gt;&gt;</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4770:{VV#4751 : (Ptr {VV#4748 : a^"lq_tmp_x4750" | k_4749})^"lq_tmp_x4753" | k_4752}
-&gt; lq_tmp_x4771:{VV#4761 : [{VV#4754 : a^"lq_tmp_x4756" | k_4755[p#a3Lm:=lq_tmp_x4770]}]&lt;\lq_tmp_x4757 VV -&gt; k_4759[p#a3Lm:=lq_tmp_x4770]&gt;^"lq_tmp_x4763" | k_4762[p#a3Lm:=lq_tmp_x4770]}
-&gt; {VV#4767 : (IO {VV#4764 : ()^"lq_tmp_x4766" | k_4765[p#a3Lm:=lq_tmp_x4770][ds_d3XD:=lq_tmp_x4771]})^"lq_tmp_x4769" | k_4768[p#a3Lm:=lq_tmp_x4770][ds_d3XD:=lq_tmp_x4771]}</span><span class='hs-varid'>go</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x4845:{lq_tmp_x4840 : (Ptr {VV#4847 : a^"lq_tmp_x4849" | k_4848}) | 0 &lt;= plen lq_tmp_x4840}
-&gt; lq_tmp_x4846:{lq_tmp_x4841 : Int | lq_tmp_x4841 &lt;= plen lq_tmp_x4845}
-&gt; {lq_tmp_x4842 : (Ptr {VV#4850 : a^"lq_tmp_x4852" | k_4851}) | 0 &lt;= plen lq_tmp_x4842 &amp;&amp; pbase lq_tmp_x4842 == pbase lq_tmp_x4845 &amp;&amp; plen lq_tmp_x4842 == plen lq_tmp_x4845 - lq_tmp_x4846}</span><span class='hs-varid'>plusPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4853 : (Ptr {VV#4748 : a^"lq_tmp_x4750" | k_4749[VV#4751:=lq_tmp_x4853]})^"lq_tmp_x4753" | k_4752[VV#4751:=lq_tmp_x4853] &amp;&amp; lq_tmp_x4853 == p#a3Lm}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4854 : Int | lq_tmp_x4854 == (1  :  int) &amp;&amp; lq_tmp_x4854 == lq_anf__d411}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x4867 : [{VV#4754 : a^"lq_tmp_x4756" "lq_tmp_x4760" | k_4755[p#a3Lm:=p#a3Lm][lq_tmp_x4770:=p#a3Lm][VV#4761:=lq_anf__d40Z][lq_tmp_x4776:=lq_anf__d40Z][lq_tmp_x4801:=lq_anf__d40Z][lq_tmp_x4808:=x#a3Ln][lq_tmp_x4811:=lq_tmp_x4867] &amp;&amp; k_4759[p#a3Lm:=p#a3Lm][lq_tmp_x4770:=p#a3Lm][lq_tmp_x4757:=x#a3Ln][lq_tmp_x4775:=x#a3Ln][lq_tmp_x4800:=x#a3Ln][VV#4758:=VV#4754][lq_tmp_x4808:=x#a3Ln][lq_tmp_x4811:=lq_tmp_x4867]}]&lt;\lq_tmp_x4866 VV -&gt; k_4759[p#a3Lm:=p#a3Lm][lq_tmp_x4770:=p#a3Lm][lq_tmp_x4757:=lq_tmp_x4866][lq_tmp_x4775:=lq_tmp_x4866][lq_tmp_x4800:=lq_tmp_x4866][VV#4758:=VV#4754][lq_tmp_x4808:=x#a3Ln][lq_tmp_x4810:=lq_tmp_x4866]&gt; | len lq_tmp_x4867 &gt;= 0 &amp;&amp; bLens lq_tmp_x4867 &gt;= 0 &amp;&amp; lq_tmp_x4867 == xs#a3Lo}</span><span class='hs-varid'>xs</span></a>
<span class=hs-linenum>509: </span>  <span class='hs-varid'>go</span> <span class='hs-keyword'>_</span> <span class='hs-conid'>[]</span>     <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x4798 : ()^"lq_tmp_x4797" "lq_tmp_x63" | k_4796[VV#4795:=lq_tmp_x4798]}
-&gt; (IO {lq_tmp_x4798 : ()^"lq_tmp_x4797" "lq_tmp_x65" | k_4796[VV#4795:=lq_tmp_x4798]})^"lq_tmp_x4791" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a>  <a class=annot href="#"><span class=annottext>{lq_tmp_x4799 : ()^"lq_tmp_x93" | lq_tmp_x4799 == GHC.Tuple.()#70}</span><span class='hs-conid'>()</span></a>
</pre>
</div>
<p></p>
<p>Extract <em>prefix</em> string of size <code>n</code></p>
<p><br></p>
<div class="fragment">
<p><strong>Specification</strong></p>
<pre><span class=hs-linenum>526: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unsafeTake</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span>
<span class=hs-linenum>527: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-keyword'>{ByteString | n &lt;= bLen b}</span>
<span class=hs-linenum>528: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteStringN</span> <span class='hs-varid'>n</span>            <span class='hs-keyword'>@-}</span>
</pre>
</div>
<p><br></p>
<div class="fragment">
<p><strong>Implementation</strong></p>
<pre><span class=hs-linenum>539: </span><a class=annot href="#"><span class=annottext>lq_tmp_x768:{v : Int | v &gt;= 0}
-&gt; lq_tmp_x769:{b : ByteString | lq_tmp_x768 &lt;= bLen b}
-&gt; {v : ByteString | bLen v == lq_tmp_x768}</span><span class='hs-definition'>unsafeTake</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x807:(ForeignPtr Word8)
-&gt; lq_tmp_x808:{lq_tmp_x801 : Int | lq_tmp_x801 &gt;= 0 &amp;&amp; lq_tmp_x801 &lt;= fplen lq_tmp_x807}
-&gt; lq_tmp_x809:{lq_tmp_x802 : Int | lq_tmp_x802 &gt;= 0 &amp;&amp; lq_tmp_x802 + lq_tmp_x808 &lt;= fplen lq_tmp_x807}
-&gt; {lq_tmp_x803 : ByteString | bLen lq_tmp_x803 == lq_tmp_x809 &amp;&amp; bOff lq_tmp_x803 == lq_tmp_x808 &amp;&amp; bPtr lq_tmp_x803 == lq_tmp_x807}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x811 : (ForeignPtr Word8) | lq_tmp_x811 == x#a3Lr}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x812 : Int | lq_tmp_x812 &gt;= 0 &amp;&amp; lq_tmp_x812 &lt;= fplen x#a3Lr &amp;&amp; lq_tmp_x812 == s#a3Ls}</span><span class='hs-varid'>s</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x813 : Int | lq_tmp_x813 &gt;= 0 &amp;&amp; lq_tmp_x813 == n#a3Lq}</span><span class='hs-varid'>n</span></a>
</pre>
</div>
<p></p>
<p><strong>Specification</strong></p>
<pre><span class=hs-linenum>548: </span><span class='hs-definition'>unpack</span> 
<span class=hs-linenum>549: </span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StringN</span> <span class='hs-layout'>(</span><span class='hs-varid'>bLen</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span>
</pre>
<p><br></p>
<div class="fragment">
<p><strong>Implementation</strong></p>
<pre><span class=hs-linenum>558: </span><span class='hs-definition'>unpack</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>you</span> <span class='hs-varop'>.</span> <span class='hs-varid'>get</span> <span class='hs-varop'>.</span> <span class='hs-varid'>the</span> <span class='hs-varop'>.</span> <span class='hs-varid'>idea</span> <span class='hs-comment'>-- see source </span>
</pre>
</div>
<div class="hidden">
<pre><span class=hs-linenum>564: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>Unpack</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>acc</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-layout'>,</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-varid'>int</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-varid'>len</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-num'>1</span> <span class='hs-varop'>+</span> <span class='hs-varid'>n</span> <span class='hs-varop'>+</span> <span class='hs-varid'>len</span> <span class='hs-varid'>acc</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>565: </span>
<span class=hs-linenum>566: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unpack</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StringN</span> <span class='hs-layout'>(</span><span class='hs-varid'>bLen</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>567: </span><span class='hs-definition'>unpack</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>String</span> 
<span class=hs-linenum>568: </span><a class=annot href="#"><span class=annottext>lq_tmp_x2460:ByteString
-&gt; {VV : [Char] | len VV == bLen lq_tmp_x2460}</span><span class='hs-definition'>unpack</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-keyword'>_</span>  <span class='hs-keyword'>_</span> <span class='hs-num'>0</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall a &lt;p :: a a -&gt; Prop&gt;.
{lq_tmp_x3192 : [a]&lt;\lq_tmp_x3191 VV -&gt; p lq_tmp_x3191&gt; | bLens lq_tmp_x3192 == 0 &amp;&amp; null lq_tmp_x3192 &lt;=&gt; true &amp;&amp; len lq_tmp_x3192 == 0}</span><span class='hs-conid'>[]</span></a>
<span class=hs-linenum>569: </span><span class='hs-definition'>unpack</span> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3182:(IO {lq_tmp_x3175 : [{lq_tmp_x3172 : Char^"lq_tmp_x2915" | k_2914[VV#2913:=lq_tmp_x3172][VV#2920:=lq_tmp_x3175][lq_tmp_x2923:=lq_tmp_x3172][lq_tmp_x2926:=lq_tmp_x3175][lq_tmp_x2910:=lq_tmp_x3176]}]&lt;\lq_tmp_x3173 VV -&gt; k_2918[VV#2917:=lq_tmp_x3174][lq_tmp_x2916:=lq_tmp_x3173][lq_tmp_x2925:=lq_tmp_x3174][lq_tmp_x2924:=lq_tmp_x3173][lq_tmp_x2910:=lq_tmp_x3176]&gt;^"lq_tmp_x2922" "lq_tmp_x246" | k_2921[VV#2920:=lq_tmp_x3175][lq_tmp_x2926:=lq_tmp_x3175][lq_tmp_x2910:=lq_tmp_x3176]})^"lq_tmp_x247"
-&gt; {lq_tmp_x3180 : [{lq_tmp_x3177 : Char^"lq_tmp_x2915" | k_2914[VV#2913:=lq_tmp_x3177][VV#2920:=lq_tmp_x3180][lq_tmp_x2923:=lq_tmp_x3177][lq_tmp_x2926:=lq_tmp_x3180][lq_tmp_x2912:=lq_tmp_x3182]}]&lt;\lq_tmp_x3178 VV -&gt; k_2918[VV#2917:=lq_tmp_x3179][lq_tmp_x2916:=lq_tmp_x3178][lq_tmp_x2925:=lq_tmp_x3179][lq_tmp_x2924:=lq_tmp_x3178][lq_tmp_x2912:=lq_tmp_x3182]&gt;^"lq_tmp_x2922" "lq_tmp_x248" | k_2921[VV#2920:=lq_tmp_x3180][lq_tmp_x2926:=lq_tmp_x3180][lq_tmp_x2912:=lq_tmp_x3182]}</span><span class='hs-varid'>unsafePerformIO</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3138:(lq_tmp_x3137:{lq_tmp_x3157 : (IO {lq_tmp_x3156 : [{lq_tmp_x3153 : Char^"lq_tmp_x3142" | k_3141[VV#3140:=lq_tmp_x3153][VV#3147:=lq_tmp_x3156][VV#3150:=lq_tmp_x3157]}]&lt;\lq_tmp_x3154 VV -&gt; k_3145[VV#3144:=lq_tmp_x3155][lq_tmp_x3143:=lq_tmp_x3154][VV#3150:=lq_tmp_x3157]&gt;^"lq_tmp_x3149" | k_3148[VV#3147:=lq_tmp_x3156][VV#3150:=lq_tmp_x3157]})^"lq_tmp_x3152" | k_3151[VV#3150:=lq_tmp_x3157]}
              -&gt; {lq_tmp_x3171 : [{lq_tmp_x3168 : Char^"lq_tmp_x3160" | k_3159[VV#3158:=lq_tmp_x3168][VV#3165:=lq_tmp_x3171]}]&lt;\lq_tmp_x3169 VV -&gt; k_3163[VV#3162:=lq_tmp_x3170][lq_tmp_x3161:=lq_tmp_x3169]&gt;^"lq_tmp_x3167" | k_3166[VV#3165:=lq_tmp_x3171]})
-&gt; lq_tmp_x3139:{lq_tmp_x3157 : (IO {lq_tmp_x3156 : [{lq_tmp_x3153 : Char^"lq_tmp_x3142" | k_3141[VV#3140:=lq_tmp_x3153][VV#3147:=lq_tmp_x3156][VV#3150:=lq_tmp_x3157]}]&lt;\lq_tmp_x3154 VV -&gt; k_3145[VV#3144:=lq_tmp_x3155][lq_tmp_x3143:=lq_tmp_x3154][VV#3150:=lq_tmp_x3157]&gt;^"lq_tmp_x3149" | k_3148[VV#3147:=lq_tmp_x3156][VV#3150:=lq_tmp_x3157]})^"lq_tmp_x3152" | k_3151[VV#3150:=lq_tmp_x3157]}
-&gt; {lq_tmp_x3171 : [{lq_tmp_x3168 : Char^"lq_tmp_x3160" | k_3159[VV#3158:=lq_tmp_x3168][VV#3165:=lq_tmp_x3171]}]&lt;\lq_tmp_x3169 VV -&gt; k_3163[VV#3162:=lq_tmp_x3170][lq_tmp_x3161:=lq_tmp_x3169]&gt;^"lq_tmp_x3167" | k_3166[VV#3165:=lq_tmp_x3171]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2936:(ForeignPtr {lq_tmp_x2941 : Word8^"lq_tmp_x2940" | k_2939[VV#2938:=lq_tmp_x2941]})
-&gt; lq_tmp_x2937:(lq_tmp_x2935:{lq_tmp_x2929 : (Ptr {lq_tmp_x2941 : Word8^"lq_tmp_x2940" | k_2939[VV#2938:=lq_tmp_x2941]}) | 0 &lt;= plen lq_tmp_x2929 &amp;&amp; plen lq_tmp_x2929 == fplen lq_tmp_x2936}
                 -&gt; (IO {lq_tmp_x2955 : [{lq_tmp_x2952 : Char^"lq_tmp_x2944" | k_2943[VV#2942:=lq_tmp_x2952][VV#2949:=lq_tmp_x2955]}]&lt;\lq_tmp_x2953 VV -&gt; k_2947[VV#2946:=lq_tmp_x2954][lq_tmp_x2945:=lq_tmp_x2953]&gt;^"lq_tmp_x2951" | k_2950[VV#2949:=lq_tmp_x2955]}))
-&gt; (IO {lq_tmp_x2955 : [{lq_tmp_x2952 : Char^"lq_tmp_x2944" | k_2943[VV#2942:=lq_tmp_x2952][VV#2949:=lq_tmp_x2955]}]&lt;\lq_tmp_x2953 VV -&gt; k_2947[VV#2946:=lq_tmp_x2954][lq_tmp_x2945:=lq_tmp_x2953]&gt;^"lq_tmp_x2951" | k_2950[VV#2949:=lq_tmp_x2955]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2957 : (ForeignPtr Word8) | lq_tmp_x2957 == ds_d3Xn}</span><span class='hs-varid'>ps</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3060:(lq_tmp_x3059:(lq_tmp_x3062:{lq_tmp_x3083 : (Ptr {lq_tmp_x3082 : Word8^"lq_tmp_x3065" | k_3064[VV#3063:=lq_tmp_x3082][VV#3066:=lq_tmp_x3083]})^"lq_tmp_x3068" | k_3067[VV#3066:=lq_tmp_x3083]}
                            -&gt; {lq_tmp_x3088 : (IO {lq_tmp_x3087 : [{lq_tmp_x3084 : Char^"lq_tmp_x3071" | k_3070[VV#3069:=lq_tmp_x3084][VV#3076:=lq_tmp_x3087][VV#3079:=lq_tmp_x3088]}]&lt;\lq_tmp_x3085 VV -&gt; k_3074[VV#3073:=lq_tmp_x3086][lq_tmp_x3072:=lq_tmp_x3085][VV#3079:=lq_tmp_x3088]&gt;^"lq_tmp_x3078" | k_3077[VV#3076:=lq_tmp_x3087][VV#3079:=lq_tmp_x3088]})^"lq_tmp_x3081" | k_3080[VV#3079:=lq_tmp_x3088]})
              -&gt; {lq_tmp_x3107 : (IO {lq_tmp_x3106 : [{lq_tmp_x3103 : Char^"lq_tmp_x3092" | k_3091[VV#3090:=lq_tmp_x3103][VV#3097:=lq_tmp_x3106][VV#3100:=lq_tmp_x3107]}]&lt;\lq_tmp_x3104 VV -&gt; k_3095[VV#3094:=lq_tmp_x3105][lq_tmp_x3093:=lq_tmp_x3104][VV#3100:=lq_tmp_x3107]&gt;^"lq_tmp_x3099" | k_3098[VV#3097:=lq_tmp_x3106][VV#3100:=lq_tmp_x3107]})^"lq_tmp_x3102" | k_3101[VV#3100:=lq_tmp_x3107]})
-&gt; lq_tmp_x3061:(lq_tmp_x3062:{lq_tmp_x3083 : (Ptr {lq_tmp_x3082 : Word8^"lq_tmp_x3065" | k_3064[VV#3063:=lq_tmp_x3082][VV#3066:=lq_tmp_x3083]})^"lq_tmp_x3068" | k_3067[VV#3066:=lq_tmp_x3083]}
                 -&gt; {lq_tmp_x3088 : (IO {lq_tmp_x3087 : [{lq_tmp_x3084 : Char^"lq_tmp_x3071" | k_3070[VV#3069:=lq_tmp_x3084][VV#3076:=lq_tmp_x3087][VV#3079:=lq_tmp_x3088]}]&lt;\lq_tmp_x3085 VV -&gt; k_3074[VV#3073:=lq_tmp_x3086][lq_tmp_x3072:=lq_tmp_x3085][VV#3079:=lq_tmp_x3088]&gt;^"lq_tmp_x3078" | k_3077[VV#3076:=lq_tmp_x3087][VV#3079:=lq_tmp_x3088]})^"lq_tmp_x3081" | k_3080[VV#3079:=lq_tmp_x3088]})
-&gt; {lq_tmp_x3107 : (IO {lq_tmp_x3106 : [{lq_tmp_x3103 : Char^"lq_tmp_x3092" | k_3091[VV#3090:=lq_tmp_x3103][VV#3097:=lq_tmp_x3106][VV#3100:=lq_tmp_x3107]}]&lt;\lq_tmp_x3104 VV -&gt; k_3095[VV#3094:=lq_tmp_x3105][lq_tmp_x3093:=lq_tmp_x3104][VV#3100:=lq_tmp_x3107]&gt;^"lq_tmp_x3099" | k_3098[VV#3097:=lq_tmp_x3106][VV#3100:=lq_tmp_x3107]})^"lq_tmp_x3102" | k_3101[VV#3100:=lq_tmp_x3107]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#2962 : (Ptr {VV#2959 : Word8^"lq_tmp_x2961" | k_2960})^"lq_tmp_x2964" | k_2963}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>570: </span>   <a class=annot href="#"><span class=annottext>lq_tmp_x3045:{lq_tmp_x3031 : (Ptr {lq_tmp_x3030 : Word8^"lq_tmp_x2522" | k_2521[VV#2520:=lq_tmp_x3030][VV#2523:=lq_tmp_x3031][lq_tmp_x2891:=lq_tmp_x3030][lq_tmp_x2892:=lq_tmp_x3031]})^"lq_tmp_x2525" | k_2524[VV#2523:=lq_tmp_x3031][lq_tmp_x2892:=lq_tmp_x3031]}
-&gt; lq_tmp_x3046:{lq_tmp_x3032 : Int^"lq_tmp_x2528" | k_2527[p#a3Ly:=lq_tmp_x3045][VV#2526:=lq_tmp_x3032][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2893:=lq_tmp_x3032][lq_tmp_x2906:=lq_tmp_x3045]}
-&gt; lq_tmp_x3047:{lq_tmp_x3036 : [{lq_tmp_x3033 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][VV#2529:=lq_tmp_x3033][VV#2536:=lq_tmp_x3036][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2894:=lq_tmp_x3033][lq_tmp_x2897:=lq_tmp_x3036][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046]}]&lt;\lq_tmp_x3034 VV -&gt; k_2534[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][VV#2533:=lq_tmp_x3035][lq_tmp_x2532:=lq_tmp_x3034][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2896:=lq_tmp_x3035][lq_tmp_x2895:=lq_tmp_x3034][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][VV#2536:=lq_tmp_x3036][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2897:=lq_tmp_x3036][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046]}
-&gt; {lq_tmp_x3041 : (IO {lq_tmp_x3040 : [{lq_tmp_x3037 : Char^"lq_tmp_x2541" | k_2540[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][acc#a3Lz:=lq_tmp_x3047][VV#2539:=lq_tmp_x3037][VV#2546:=lq_tmp_x3040][VV#2549:=lq_tmp_x3041][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2554:=lq_tmp_x3047][lq_tmp_x2898:=lq_tmp_x3037][lq_tmp_x2901:=lq_tmp_x3040][lq_tmp_x2902:=lq_tmp_x3041][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046][lq_tmp_x2908:=lq_tmp_x3047]}]&lt;\lq_tmp_x3038 VV -&gt; k_2544[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][acc#a3Lz:=lq_tmp_x3047][VV#2543:=lq_tmp_x3039][lq_tmp_x2542:=lq_tmp_x3038][VV#2549:=lq_tmp_x3041][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2554:=lq_tmp_x3047][lq_tmp_x2900:=lq_tmp_x3039][lq_tmp_x2899:=lq_tmp_x3038][lq_tmp_x2902:=lq_tmp_x3041][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046][lq_tmp_x2908:=lq_tmp_x3047]&gt;^"lq_tmp_x2548" | k_2547[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][acc#a3Lz:=lq_tmp_x3047][VV#2546:=lq_tmp_x3040][VV#2549:=lq_tmp_x3041][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2554:=lq_tmp_x3047][lq_tmp_x2901:=lq_tmp_x3040][lq_tmp_x2902:=lq_tmp_x3041][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046][lq_tmp_x2908:=lq_tmp_x3047]})^"lq_tmp_x2551" | k_2550[p#a3Ly:=lq_tmp_x3045][ds_d3Xr:=lq_tmp_x3046][acc#a3Lz:=lq_tmp_x3047][VV#2549:=lq_tmp_x3041][lq_tmp_x2552:=lq_tmp_x3045][lq_tmp_x2553:=lq_tmp_x3046][lq_tmp_x2554:=lq_tmp_x3047][lq_tmp_x2902:=lq_tmp_x3041][lq_tmp_x2906:=lq_tmp_x3045][lq_tmp_x2907:=lq_tmp_x3046][lq_tmp_x2908:=lq_tmp_x3047]}</span><span class='hs-varid'>go</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x2995 : (Ptr {lq_tmp_x2994 : Word8^"lq_tmp_x2961" | k_2960[VV#2959:=lq_tmp_x2994][VV#2962:=lq_tmp_x2995]})^"lq_tmp_x2964" | k_2963[VV#2962:=lq_tmp_x2995] &amp;&amp; lq_tmp_x2995 == p#a3LF}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2984:{lq_tmp_x2979 : (Ptr {lq_tmp_x2989 : Word8^"lq_tmp_x2988" | k_2987[VV#2986:=lq_tmp_x2989]}) | 0 &lt;= plen lq_tmp_x2979}
-&gt; lq_tmp_x2985:{lq_tmp_x2980 : Int | lq_tmp_x2980 &lt;= plen lq_tmp_x2984}
-&gt; {lq_tmp_x2981 : (Ptr {lq_tmp_x2993 : Word8^"lq_tmp_x2992" | k_2991[VV#2990:=lq_tmp_x2993]}) | 0 &lt;= plen lq_tmp_x2981 &amp;&amp; pbase lq_tmp_x2981 == pbase lq_tmp_x2984 &amp;&amp; plen lq_tmp_x2981 == plen lq_tmp_x2984 - lq_tmp_x2985}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2996 : Int | lq_tmp_x2996 &gt;= 0 &amp;&amp; lq_tmp_x2996 &lt;= fplen ds_d3Xn &amp;&amp; lq_tmp_x2996 == ds_d3Xo}</span><span class='hs-varid'>s</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3015 : Int | lq_tmp_x3015 &gt;= 0 &amp;&amp; lq_tmp_x3015 + ds_d3Xo &lt;= fplen ds_d3Xn &amp;&amp; lq_tmp_x3015 == ds_d3Xp}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3009:Int^"lq_tmp_x3011"
-&gt; lq_tmp_x3010:Int^"lq_tmp_x3011"
-&gt; {lq_tmp_x3012 : Int^"lq_tmp_x3011" | lq_tmp_x3012 == lq_tmp_x3009 - lq_tmp_x3010}</span><span class='hs-comment'>-</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3016 : Int | lq_tmp_x3016 == (1  :  int) &amp;&amp; lq_tmp_x3016 == lq_anf__d3ZW}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span>  <a class=annot href="#"><span class=annottext>{lq_tmp_x3054 : [{lq_tmp_x3051 : Char^"lq_tmp_x3022" | k_3021[VV#3020:=lq_tmp_x3051][lq_tmp_x3023:=lq_tmp_x3051][lq_tmp_x3019:=lq_tmp_x3054]}]&lt;\lq_tmp_x3052 VV -&gt; k_3025[lq_tmp_x3027:=lq_tmp_x3052][VV#3024:=lq_tmp_x3053][lq_tmp_x3023:=lq_tmp_x3053][lq_tmp_x3018:=lq_tmp_x3052]&gt; | bLens lq_tmp_x3054 == 0 &amp;&amp; null lq_tmp_x3054 &lt;=&gt; true &amp;&amp; len lq_tmp_x3054 == 0 &amp;&amp; len lq_tmp_x3054 &gt;= 0 &amp;&amp; bLens lq_tmp_x3054 &gt;= 0 &amp;&amp; lq_tmp_x3054 == lq_anf__d3ZY}</span><span class='hs-conid'>[]</span></a>
<span class=hs-linenum>571: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>572: </span>   <a class=annot href="#"><span class=annottext>lq_tmp_x2906:{lq_tmp_x2892 : (Ptr {lq_tmp_x2891 : Word8^"lq_tmp_x2522" | k_2521[VV#2520:=lq_tmp_x2891][VV#2523:=lq_tmp_x2892]})^"lq_tmp_x2525" | k_2524[VV#2523:=lq_tmp_x2892]}
-&gt; lq_tmp_x2907:{lq_tmp_x2893 : Int^"lq_tmp_x2528" | k_2527[p#a3Ly:=lq_tmp_x2906][VV#2526:=lq_tmp_x2893][lq_tmp_x2552:=lq_tmp_x2906]}
-&gt; lq_tmp_x2908:{lq_tmp_x2897 : [{lq_tmp_x2894 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][VV#2529:=lq_tmp_x2894][VV#2536:=lq_tmp_x2897][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907]}]&lt;\lq_tmp_x2895 VV -&gt; k_2534[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][VV#2533:=lq_tmp_x2896][lq_tmp_x2532:=lq_tmp_x2895][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][VV#2536:=lq_tmp_x2897][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907]}
-&gt; {lq_tmp_x2902 : (IO {lq_tmp_x2901 : [{lq_tmp_x2898 : Char^"lq_tmp_x2541" | k_2540[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][acc#a3Lz:=lq_tmp_x2908][VV#2539:=lq_tmp_x2898][VV#2546:=lq_tmp_x2901][VV#2549:=lq_tmp_x2902][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907][lq_tmp_x2554:=lq_tmp_x2908]}]&lt;\lq_tmp_x2899 VV -&gt; k_2544[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][acc#a3Lz:=lq_tmp_x2908][VV#2543:=lq_tmp_x2900][lq_tmp_x2542:=lq_tmp_x2899][VV#2549:=lq_tmp_x2902][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907][lq_tmp_x2554:=lq_tmp_x2908]&gt;^"lq_tmp_x2548" | k_2547[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][acc#a3Lz:=lq_tmp_x2908][VV#2546:=lq_tmp_x2901][VV#2549:=lq_tmp_x2902][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907][lq_tmp_x2554:=lq_tmp_x2908]})^"lq_tmp_x2551" | k_2550[p#a3Ly:=lq_tmp_x2906][ds_d3Xr:=lq_tmp_x2907][acc#a3Lz:=lq_tmp_x2908][VV#2549:=lq_tmp_x2902][lq_tmp_x2552:=lq_tmp_x2906][lq_tmp_x2553:=lq_tmp_x2907][lq_tmp_x2554:=lq_tmp_x2908]}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV#2523 : (Ptr {VV#2520 : Word8^"lq_tmp_x2522" | k_2521})^"lq_tmp_x2525" | k_2524}</span><span class='hs-varid'>p</span></a> <span class='hs-num'>0</span> <a class=annot href="#"><span class=annottext>{VV#2536 : [{VV#2529 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr]}]&lt;\lq_tmp_x2532 VV -&gt; k_2534[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr]}</span><span class='hs-varid'>acc</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x2768:{lq_tmp_x2763 : (Ptr Word8^"lq_tmp_x2769") | 0 &lt; plen lq_tmp_x2763}
-&gt; (IO {lq_tmp_x2770 : Word8^"lq_tmp_x2769" | lq_tmp_x2770 == deref lq_tmp_x2768})</span><span class='hs-varid'>peek</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2774 : (Ptr {lq_tmp_x2773 : Word8^"lq_tmp_x2522" | k_2521[VV#2520:=lq_tmp_x2773][VV#2523:=lq_tmp_x2774]})^"lq_tmp_x2525" | k_2524[VV#2523:=lq_tmp_x2774] &amp;&amp; lq_tmp_x2774 == p#a3Ly}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x40:(IO {lq_tmp_x2866 : Word8^"lq_tmp_x2865" "lq_tmp_x42" | k_2864[VV#2863:=lq_tmp_x2866]})^"lq_tmp_x2859" "lq_tmp_x41"
-&gt; lq_tmp_x43:(lq_tmp_x44:{lq_tmp_x2866 : Word8^"lq_tmp_x2865" "lq_tmp_x45" | k_2864[VV#2863:=lq_tmp_x2866]}
               -&gt; (IO {lq_tmp_x2880 : [{lq_tmp_x2877 : Char^"lq_tmp_x2869" | k_2868[VV#2867:=lq_tmp_x2877][VV#2874:=lq_tmp_x2880]}]&lt;\lq_tmp_x2878 VV -&gt; k_2872[VV#2871:=lq_tmp_x2879][lq_tmp_x2870:=lq_tmp_x2878]&gt;^"lq_tmp_x2876" "lq_tmp_x47" | k_2875[VV#2874:=lq_tmp_x2880]})^"lq_tmp_x2859" "lq_tmp_x46")
-&gt; (IO {lq_tmp_x2880 : [{lq_tmp_x2877 : Char^"lq_tmp_x2869" | k_2868[VV#2867:=lq_tmp_x2877][VV#2874:=lq_tmp_x2880]}]&lt;\lq_tmp_x2878 VV -&gt; k_2872[VV#2871:=lq_tmp_x2879][lq_tmp_x2870:=lq_tmp_x2878]&gt;^"lq_tmp_x2876" "lq_tmp_x49" | k_2875[VV#2874:=lq_tmp_x2880]})^"lq_tmp_x2859" "lq_tmp_x48"</span><span class='hs-varop'>&gt;&gt;=</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2890:{lq_tmp_x2883 : Word8^"lq_tmp_x2778" | k_2777[VV#2776:=lq_tmp_x2883]}
-&gt; {lq_tmp_x2888 : (IO {lq_tmp_x2887 : [{lq_tmp_x2884 : Char^"lq_tmp_x2782" | k_2781[VV#2780:=lq_tmp_x2884][VV#2787:=lq_tmp_x2887][VV#2790:=lq_tmp_x2888][e#a3LA:=lq_tmp_x2890]}]&lt;\lq_tmp_x2885 VV -&gt; k_2785[VV#2784:=lq_tmp_x2886][lq_tmp_x2783:=lq_tmp_x2885][VV#2790:=lq_tmp_x2888][e#a3LA:=lq_tmp_x2890]&gt;^"lq_tmp_x2789" | k_2788[VV#2787:=lq_tmp_x2887][VV#2790:=lq_tmp_x2888][e#a3LA:=lq_tmp_x2890]})^"lq_tmp_x2792" | k_2791[VV#2790:=lq_tmp_x2888][e#a3LA:=lq_tmp_x2890]}</span><span class='hs-keyglyph'>\</span></a><a class=annot href="#"><span class=annottext>{VV#2776 : Word8^"lq_tmp_x2778" | k_2777}</span><span class='hs-varid'>e</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x2844 : [{lq_tmp_x2841 : Char^"lq_tmp_x2833" | k_2832[VV#2831:=lq_tmp_x2841][VV#2838:=lq_tmp_x2844]}]&lt;\lq_tmp_x2842 VV -&gt; k_2836[VV#2835:=lq_tmp_x2843][lq_tmp_x2834:=lq_tmp_x2842]&gt;^"lq_tmp_x2840" "lq_tmp_x63" | k_2839[VV#2838:=lq_tmp_x2844]}
-&gt; (IO {lq_tmp_x2844 : [{lq_tmp_x2841 : Char^"lq_tmp_x2833" | k_2832[VV#2831:=lq_tmp_x2841][VV#2838:=lq_tmp_x2844]}]&lt;\lq_tmp_x2842 VV -&gt; k_2836[VV#2835:=lq_tmp_x2843][lq_tmp_x2834:=lq_tmp_x2842]&gt;^"lq_tmp_x2840" "lq_tmp_x65" | k_2839[VV#2838:=lq_tmp_x2844]})^"lq_tmp_x2827" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x2796:Word8^"lq_tmp_x250" -&gt; Char^"lq_tmp_x251"</span><span class='hs-varid'>w2c</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2797 : Word8^"lq_tmp_x2778" | k_2777[VV#2776:=lq_tmp_x2797] &amp;&amp; lq_tmp_x2797 == e#a3LA}</span><span class='hs-varid'>e</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2805:{lq_tmp_x2810 : Char^"lq_tmp_x2809" | k_2808[VV#2807:=lq_tmp_x2810]}
-&gt; lq_tmp_x2806:[{lq_tmp_x2810 : Char^"lq_tmp_x2809" "lq_tmp_x2813" | k_2808[VV#2807:=lq_tmp_x2810] &amp;&amp; k_2812[lq_tmp_x2814:=lq_tmp_x2805][VV#2811:=lq_tmp_x2810]}]&lt;\lq_tmp_x2799 VV -&gt; k_2812[lq_tmp_x2814:=lq_tmp_x2799][VV#2811:=lq_tmp_x2810]&gt;
-&gt; {lq_tmp_x2802 : [{lq_tmp_x2810 : Char^"lq_tmp_x2809" | k_2808[VV#2807:=lq_tmp_x2810]}]&lt;\lq_tmp_x2801 VV -&gt; k_2812[lq_tmp_x2814:=lq_tmp_x2801][VV#2811:=lq_tmp_x2810]&gt; | bLens lq_tmp_x2802 == bLen lq_tmp_x2805 + bLens lq_tmp_x2806 &amp;&amp; null lq_tmp_x2802 &lt;=&gt; false &amp;&amp; len lq_tmp_x2802 == 1 + len lq_tmp_x2806 &amp;&amp; xsListSelector lq_tmp_x2802 == lq_tmp_x2806 &amp;&amp; xListSelector lq_tmp_x2802 == lq_tmp_x2805}</span><span class='hs-conop'>:</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2820 : [{lq_tmp_x2817 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2529:=lq_tmp_x2817][VV#2536:=lq_tmp_x2820]}]&lt;\lq_tmp_x2818 VV -&gt; k_2534[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2533:=lq_tmp_x2819][lq_tmp_x2532:=lq_tmp_x2818]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2536:=lq_tmp_x2820] &amp;&amp; len lq_tmp_x2820 &gt;= 0 &amp;&amp; bLens lq_tmp_x2820 &gt;= 0 &amp;&amp; lq_tmp_x2820 == acc#a3Lz}</span><span class='hs-varid'>acc</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>573: </span>   <span class='hs-varid'>go</span> <span class='hs-varid'>p</span> <span class='hs-varid'>n</span> <span class='hs-varid'>acc</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x2618:{lq_tmp_x2613 : (Ptr Word8^"lq_tmp_x2619") | 0 &lt; plen lq_tmp_x2613}
-&gt; (IO {lq_tmp_x2620 : Word8^"lq_tmp_x2619" | lq_tmp_x2620 == deref lq_tmp_x2618})</span><span class='hs-varid'>peek</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x2609 : (Ptr {lq_tmp_x2608 : Word8^"lq_tmp_x2522" | k_2521[VV#2520:=lq_tmp_x2608][VV#2523:=lq_tmp_x2609]})^"lq_tmp_x2525" | k_2524[VV#2523:=lq_tmp_x2609] &amp;&amp; lq_tmp_x2609 == p#a3Ly}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2598:{lq_tmp_x2593 : (Ptr {lq_tmp_x2603 : Word8^"lq_tmp_x2602" | k_2601[VV#2600:=lq_tmp_x2603]}) | 0 &lt;= plen lq_tmp_x2593}
-&gt; lq_tmp_x2599:{lq_tmp_x2594 : Int | lq_tmp_x2594 &lt;= plen lq_tmp_x2598}
-&gt; {lq_tmp_x2595 : (Ptr {lq_tmp_x2607 : Word8^"lq_tmp_x2606" | k_2605[VV#2604:=lq_tmp_x2607]}) | 0 &lt;= plen lq_tmp_x2595 &amp;&amp; pbase lq_tmp_x2595 == pbase lq_tmp_x2598 &amp;&amp; plen lq_tmp_x2595 == plen lq_tmp_x2598 - lq_tmp_x2599}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2610 : Int^"lq_tmp_x2528" | k_2527[p#a3Ly:=p#a3Ly][lq_tmp_x2552:=p#a3Ly][VV#2526:=lq_tmp_x2610] &amp;&amp; lq_tmp_x2610 == ds_d3Xr}</span><span class='hs-varid'>n</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x40:(IO {lq_tmp_x2734 : Word8^"lq_tmp_x2733" "lq_tmp_x42" | k_2732[VV#2731:=lq_tmp_x2734]})^"lq_tmp_x2727" "lq_tmp_x41"
-&gt; lq_tmp_x43:(lq_tmp_x44:{lq_tmp_x2734 : Word8^"lq_tmp_x2733" "lq_tmp_x45" | k_2732[VV#2731:=lq_tmp_x2734]}
               -&gt; (IO {lq_tmp_x2748 : [{lq_tmp_x2745 : Char^"lq_tmp_x2737" | k_2736[VV#2735:=lq_tmp_x2745][VV#2742:=lq_tmp_x2748]}]&lt;\lq_tmp_x2746 VV -&gt; k_2740[VV#2739:=lq_tmp_x2747][lq_tmp_x2738:=lq_tmp_x2746]&gt;^"lq_tmp_x2744" "lq_tmp_x47" | k_2743[VV#2742:=lq_tmp_x2748]})^"lq_tmp_x2727" "lq_tmp_x46")
-&gt; (IO {lq_tmp_x2748 : [{lq_tmp_x2745 : Char^"lq_tmp_x2737" | k_2736[VV#2735:=lq_tmp_x2745][VV#2742:=lq_tmp_x2748]}]&lt;\lq_tmp_x2746 VV -&gt; k_2740[VV#2739:=lq_tmp_x2747][lq_tmp_x2738:=lq_tmp_x2746]&gt;^"lq_tmp_x2744" "lq_tmp_x49" | k_2743[VV#2742:=lq_tmp_x2748]})^"lq_tmp_x2727" "lq_tmp_x48"</span><span class='hs-varop'>&gt;&gt;=</span></a>   <a class=annot href="#"><span class=annottext>lq_tmp_x2758:{lq_tmp_x2751 : Word8^"lq_tmp_x2628" | k_2627[VV#2626:=lq_tmp_x2751]}
-&gt; {lq_tmp_x2756 : (IO {lq_tmp_x2755 : [{lq_tmp_x2752 : Char^"lq_tmp_x2632" | k_2631[VV#2630:=lq_tmp_x2752][VV#2637:=lq_tmp_x2755][VV#2640:=lq_tmp_x2756][e#a3LE:=lq_tmp_x2758]}]&lt;\lq_tmp_x2753 VV -&gt; k_2635[VV#2634:=lq_tmp_x2754][lq_tmp_x2633:=lq_tmp_x2753][VV#2640:=lq_tmp_x2756][e#a3LE:=lq_tmp_x2758]&gt;^"lq_tmp_x2639" | k_2638[VV#2637:=lq_tmp_x2755][VV#2640:=lq_tmp_x2756][e#a3LE:=lq_tmp_x2758]})^"lq_tmp_x2642" | k_2641[VV#2640:=lq_tmp_x2756][e#a3LE:=lq_tmp_x2758]}</span><span class='hs-keyglyph'>\</span></a><a class=annot href="#"><span class=annottext>{VV#2626 : Word8^"lq_tmp_x2628" | k_2627}</span><span class='hs-varid'>e</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>lq_tmp_x2552:{VV#2523 : (Ptr {VV#2520 : Word8^"lq_tmp_x2522" | k_2521})^"lq_tmp_x2525" | k_2524}
-&gt; lq_tmp_x2553:{VV#2526 : Int^"lq_tmp_x2528" | k_2527[p#a3Ly:=lq_tmp_x2552]}
-&gt; lq_tmp_x2554:{VV#2536 : [{VV#2529 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553]}]&lt;\lq_tmp_x2532 VV -&gt; k_2534[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553]}
-&gt; {VV#2549 : (IO {VV#2546 : [{VV#2539 : Char^"lq_tmp_x2541" | k_2540[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553][acc#a3Lz:=lq_tmp_x2554]}]&lt;\lq_tmp_x2542 VV -&gt; k_2544[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553][acc#a3Lz:=lq_tmp_x2554]&gt;^"lq_tmp_x2548" | k_2547[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553][acc#a3Lz:=lq_tmp_x2554]})^"lq_tmp_x2551" | k_2550[p#a3Ly:=lq_tmp_x2552][ds_d3Xr:=lq_tmp_x2553][acc#a3Lz:=lq_tmp_x2554]}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2711 : (Ptr {lq_tmp_x2710 : Word8^"lq_tmp_x2522" | k_2521[VV#2520:=lq_tmp_x2710][VV#2523:=lq_tmp_x2711]})^"lq_tmp_x2525" | k_2524[VV#2523:=lq_tmp_x2711] &amp;&amp; lq_tmp_x2711 == p#a3Ly}</span><span class='hs-varid'>p</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x2660 : Int^"lq_tmp_x2528" | k_2527[p#a3Ly:=p#a3Ly][lq_tmp_x2552:=p#a3Ly][VV#2526:=lq_tmp_x2660] &amp;&amp; lq_tmp_x2660 == ds_d3Xr}</span><span class='hs-varid'>n</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x2654:Int^"lq_tmp_x2656"
-&gt; lq_tmp_x2655:Int^"lq_tmp_x2656"
-&gt; {lq_tmp_x2657 : Int^"lq_tmp_x2656" | lq_tmp_x2657 == lq_tmp_x2654 - lq_tmp_x2655}</span><span class='hs-comment'>-</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x2661 : Int | lq_tmp_x2661 == (1  :  int) &amp;&amp; lq_tmp_x2661 == lq_anf__d3ZK}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x2666:Word8^"lq_tmp_x250" -&gt; Char^"lq_tmp_x251"</span><span class='hs-varid'>w2c</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2667 : Word8^"lq_tmp_x2628" | k_2627[VV#2626:=lq_tmp_x2667] &amp;&amp; lq_tmp_x2667 == e#a3LE}</span><span class='hs-varid'>e</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x2675:{lq_tmp_x2680 : Char^"lq_tmp_x2679" | k_2678[VV#2677:=lq_tmp_x2680]}
-&gt; lq_tmp_x2676:[{lq_tmp_x2680 : Char^"lq_tmp_x2679" "lq_tmp_x2683" | k_2678[VV#2677:=lq_tmp_x2680] &amp;&amp; k_2682[lq_tmp_x2684:=lq_tmp_x2675][VV#2681:=lq_tmp_x2680]}]&lt;\lq_tmp_x2669 VV -&gt; k_2682[lq_tmp_x2684:=lq_tmp_x2669][VV#2681:=lq_tmp_x2680]&gt;
-&gt; {lq_tmp_x2672 : [{lq_tmp_x2680 : Char^"lq_tmp_x2679" | k_2678[VV#2677:=lq_tmp_x2680]}]&lt;\lq_tmp_x2671 VV -&gt; k_2682[lq_tmp_x2684:=lq_tmp_x2671][VV#2681:=lq_tmp_x2680]&gt; | bLens lq_tmp_x2672 == bLen lq_tmp_x2675 + bLens lq_tmp_x2676 &amp;&amp; null lq_tmp_x2672 &lt;=&gt; false &amp;&amp; len lq_tmp_x2672 == 1 + len lq_tmp_x2676 &amp;&amp; xsListSelector lq_tmp_x2672 == lq_tmp_x2676 &amp;&amp; xListSelector lq_tmp_x2672 == lq_tmp_x2675}</span><span class='hs-conop'>:</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x2690 : [{lq_tmp_x2687 : Char^"lq_tmp_x2531" | k_2530[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2529:=lq_tmp_x2687][VV#2536:=lq_tmp_x2690]}]&lt;\lq_tmp_x2688 VV -&gt; k_2534[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2533:=lq_tmp_x2689][lq_tmp_x2532:=lq_tmp_x2688]&gt;^"lq_tmp_x2538" | k_2537[p#a3Ly:=p#a3Ly][ds_d3Xr:=ds_d3Xr][lq_tmp_x2552:=p#a3Ly][lq_tmp_x2553:=ds_d3Xr][VV#2536:=lq_tmp_x2690] &amp;&amp; len lq_tmp_x2690 &gt;= 0 &amp;&amp; bLens lq_tmp_x2690 &gt;= 0 &amp;&amp; lq_tmp_x2690 == acc#a3Lz}</span><span class='hs-varid'>acc</span></a><span class='hs-layout'>)</span>
</pre>
</div>
<h2 id="application-api">3. Application API</h2>
<p><br></p>
<p>Strategy: Specify and Verify Types for</p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>Low-level <code>Pointer</code> API</li>
<li>Lib-level <code>ByteString</code> API</li>
<li><strong>User-level <code>Application</code> API</strong></li>
</ol>
<p><br></p>
<p>Errors at <em>each</em> level are prevented by types at <em>lower</em> levels</p>
<p></p>
<p>Lets revisit our potentially &quot;bleeding&quot; <code>chop</code></p>
<p><br></p>
<div class="hidden">
<pre><span class=hs-linenum>603: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>StringN</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>String</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>len</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
</pre>
</div>
<div class="fragment">
<pre><span class=hs-linenum>609: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>chop</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>s</span><span class='hs-conop'>:</span><span class='hs-conid'>String</span>
<span class=hs-linenum>610: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-keyword'>{Nat | n &lt;= len s}</span>
<span class=hs-linenum>611: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>StringN</span> <span class='hs-varid'>n</span>
<span class=hs-linenum>612: </span>  <span class='hs-keyword'>@-}</span> 
<span class=hs-linenum>613: </span><a class=annot href="#"><span class=annottext>lq_tmp_x5032:[Char]
-&gt; lq_tmp_x5033:{v : Int | v &gt;= 0 &amp;&amp; v &lt;= len lq_tmp_x5032}
-&gt; {VV : [Char] | len VV == lq_tmp_x5033}</span><span class='hs-definition'>chop</span></a> <a class=annot href="#"><span class=annottext>[Char]</span><span class='hs-varid'>s</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0 &amp;&amp; v &lt;= len s#a3LG}</span><span class='hs-varid'>n</span></a> <span class='hs-keyglyph'>=</span>  <a class=annot href="#"><span class=annottext>{lq_tmp_x5070 : [Char] | len lq_tmp_x5070 == bLen b'#a3LJ &amp;&amp; len lq_tmp_x5070 &gt;= 0 &amp;&amp; bLens lq_tmp_x5070 &gt;= 0 &amp;&amp; lq_tmp_x5070 == s'#a3LK}</span><span class='hs-varid'>s'</span></a>
<span class=hs-linenum>614: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>615: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5040 : ByteString | bLen lq_tmp_x5040 == len s#a3LG}</span><span class='hs-varid'>b</span></a>    <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5042:[Char]
-&gt; {lq_tmp_x5040 : ByteString | bLen lq_tmp_x5040 == len lq_tmp_x5042}</span><span class='hs-varid'>pack</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5046 : [Char] | len lq_tmp_x5046 &gt;= 0 &amp;&amp; bLens lq_tmp_x5046 &gt;= 0 &amp;&amp; lq_tmp_x5046 == s#a3LG}</span><span class='hs-varid'>s</span></a>          <span class='hs-comment'>-- down to low-level</span>
<span class=hs-linenum>616: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5050 : ByteString | bLen lq_tmp_x5050 == n#a3LH}</span><span class='hs-varid'>b'</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5053:{lq_tmp_x5048 : Int | lq_tmp_x5048 &gt;= 0}
-&gt; lq_tmp_x5054:{lq_tmp_x5049 : ByteString | lq_tmp_x5053 &lt;= bLen lq_tmp_x5049}
-&gt; {lq_tmp_x5050 : ByteString | bLen lq_tmp_x5050 == lq_tmp_x5053}</span><span class='hs-varid'>unsafeTake</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5055 : Int | lq_tmp_x5055 &gt;= 0 &amp;&amp; lq_tmp_x5055 &lt;= len s#a3LG &amp;&amp; lq_tmp_x5055 == n#a3LH}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5056 : ByteString | bLen lq_tmp_x5056 == len s#a3LG &amp;&amp; bLen lq_tmp_x5056 &gt;= 0 &amp;&amp; lq_tmp_x5056 == b#a3LI}</span><span class='hs-varid'>b</span></a>  <span class='hs-comment'>-- grab n chars</span>
<span class=hs-linenum>617: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5062 : [Char] | len lq_tmp_x5062 == bLen b'#a3LJ}</span><span class='hs-varid'>s'</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5064:ByteString
-&gt; {lq_tmp_x5062 : [Char] | len lq_tmp_x5062 == bLen lq_tmp_x5064}</span><span class='hs-varid'>unpack</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5065 : ByteString | bLen lq_tmp_x5065 == n#a3LH &amp;&amp; bLen lq_tmp_x5065 &gt;= 0 &amp;&amp; lq_tmp_x5065 == b'#a3LJ}</span><span class='hs-varid'>b'</span></a>       <span class='hs-comment'>-- up to high-level</span>
</pre>
<!-- BEGIN CUT 
<br>

Yikes! How shall we fix it?

     END CUT -->
</div>
<!-- BEGIN CUT

A Well Typed `chop`
-------------------


<pre><span class=hs-linenum>634: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>chop</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>s</span><span class='hs-conop'>:</span><span class='hs-conid'>String</span>
<span class=hs-linenum>635: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-keyword'>{Nat | n &lt;= len s}</span>
<span class=hs-linenum>636: </span>         <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>String</span> <span class='hs-keyword'>| len v = n}</span> <span class='hs-keyword'>@-}</span> 
<span class=hs-linenum>637: </span><span class='hs-definition'>chop</span> <span class='hs-varid'>s</span> <span class='hs-varid'>n</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s'</span>
<span class=hs-linenum>638: </span>  <span class='hs-keyword'>where</span> 
<span class=hs-linenum>639: </span>    <span class='hs-varid'>b</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>pack</span> <span class='hs-varid'>s</span>          <span class='hs-comment'>-- down to low-level</span>
<span class=hs-linenum>640: </span>    <span class='hs-varid'>b'</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unsafeTake</span> <span class='hs-varid'>n</span> <span class='hs-varid'>b</span>  <span class='hs-comment'>-- grab n chars</span>
<span class=hs-linenum>641: </span>    <span class='hs-varid'>s'</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unpack</span> <span class='hs-varid'>b'</span>       <span class='hs-comment'>-- up to high-level</span>
</pre>

END CUT -->
<p></p>
<p><br></p>
<pre><span class=hs-linenum>651: </span><a class=annot href="#"><span class=annottext>[[Char^"lq_tmp_x295"]&lt;\fldList VV -&gt; True&gt;^"lq_tmp_x297"]&lt;\fldList VV -&gt; True&gt;^"lq_tmp_x301"</span><span class='hs-definition'>demo</span></a>     <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x5433 : [{lq_tmp_x5427 : [{lq_tmp_x5424 : Char^"lq_tmp_x5347" | k_5346[VV#5345:=lq_tmp_x5424][VV#5352:=lq_tmp_x5427][lq_tmp_x5343:=ex30#a3LN][lq_tmp_x5344:=lq_anf__d41k][lq_tmp_x5355:=lq_tmp_x5424][lq_tmp_x5358:=lq_tmp_x5427][lq_tmp_x5340:=lq_tmp_x5433]}]&lt;\lq_tmp_x5425 VV -&gt; k_5350[VV#5349:=lq_tmp_x5426][lq_tmp_x5348:=lq_tmp_x5425][lq_tmp_x5343:=ex30#a3LN][lq_tmp_x5344:=lq_anf__d41k][lq_tmp_x5357:=lq_tmp_x5426][lq_tmp_x5356:=lq_tmp_x5425][lq_tmp_x5340:=lq_tmp_x5433]&gt;^"lq_tmp_x5354" | k_5353[VV#5352:=lq_tmp_x5427][lq_tmp_x5343:=ex30#a3LN][lq_tmp_x5344:=lq_anf__d41k][lq_tmp_x5358:=lq_tmp_x5427][lq_tmp_x5340:=lq_tmp_x5433]}]&lt;\lq_tmp_x5428 VV -&gt; k_5367[lq_tmp_x5369:=lq_tmp_x5428][VV#5366:=lq_tmp_x5432][lq_tmp_x5343:=ex30#a3LN][lq_tmp_x5344:=lq_anf__d41k][lq_tmp_x5358:=lq_tmp_x5432][lq_tmp_x5339:=lq_tmp_x5428]&gt; | bLens lq_tmp_x5433 == bLen ex30#a3LN + bLens lq_anf__d41k &amp;&amp; null lq_tmp_x5433 &lt;=&gt; false &amp;&amp; len lq_tmp_x5433 == 1 + len lq_anf__d41k &amp;&amp; xsListSelector lq_tmp_x5433 == lq_anf__d41k &amp;&amp; xListSelector lq_tmp_x5433 == ex30#a3LN &amp;&amp; len lq_tmp_x5433 &gt;= 0 &amp;&amp; bLens lq_tmp_x5433 &gt;= 0 &amp;&amp; lq_tmp_x5433 == lq_anf__d41l}</span><span class='hs-keyglyph'>[</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x5423 : [Char] | len lq_tmp_x5423 == lq_anf__d41i &amp;&amp; len lq_tmp_x5423 &gt;= 0 &amp;&amp; bLens lq_tmp_x5423 &gt;= 0 &amp;&amp; lq_tmp_x5423 == ex6#a3LM}</span><span class='hs-varid'>ex6</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x5374 : [Char] | len lq_tmp_x5374 == lq_anf__d41j &amp;&amp; len lq_tmp_x5374 &gt;= 0 &amp;&amp; bLens lq_tmp_x5374 &gt;= 0 &amp;&amp; lq_tmp_x5374 == ex30#a3LN}</span><span class='hs-varid'>ex30</span></a><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>652: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>653: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5238 : [{lq_tmp_x5246 : Char^"lq_tmp_x5245" | k_5244[VV#5243:=lq_tmp_x5246][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h]}]&lt;\lq_tmp_x5237 VV -&gt; k_5248[lq_tmp_x5250:=lq_tmp_x5237][VV#5247:=lq_tmp_x5246][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h]&gt; | bLens lq_tmp_x5238 == bLen lq_anf__d416 + bLens lq_anf__d41h &amp;&amp; null lq_tmp_x5238 &lt;=&gt; false &amp;&amp; len lq_tmp_x5238 == 1 + len lq_anf__d41h &amp;&amp; xsListSelector lq_tmp_x5238 == lq_anf__d41h &amp;&amp; xListSelector lq_tmp_x5238 == lq_anf__d416}</span><span class='hs-varid'>ex</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x5238 : [{lq_tmp_x5246 : Char^"lq_tmp_x5245" | k_5244[VV#5243:=lq_tmp_x5246][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h]}]&lt;\lq_tmp_x5237 VV -&gt; k_5248[lq_tmp_x5250:=lq_tmp_x5237][VV#5247:=lq_tmp_x5246][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h]&gt; | bLens lq_tmp_x5238 == bLen lq_anf__d416 + bLens lq_anf__d41h &amp;&amp; null lq_tmp_x5238 &lt;=&gt; false &amp;&amp; len lq_tmp_x5238 == 1 + len lq_anf__d41h &amp;&amp; xsListSelector lq_tmp_x5238 == lq_anf__d41h &amp;&amp; xListSelector lq_tmp_x5238 == lq_anf__d416}</span><span class='hs-keyglyph'>[</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x5252 : Char^"lq_tmp_x75" | lq_tmp_x5252 == lq_anf__d416}</span><span class='hs-chr'>'N'</span></a><span class='hs-layout'>,</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5229 : Char^"lq_tmp_x75" | lq_tmp_x5229 == lq_anf__d417}</span><span class='hs-chr'>'o'</span></a><span class='hs-layout'>,</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5206 : Char^"lq_tmp_x75" | lq_tmp_x5206 == lq_anf__d418}</span><span class='hs-chr'>'r'</span></a><span class='hs-layout'>,</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5183 : Char^"lq_tmp_x75" | lq_tmp_x5183 == lq_anf__d419}</span><span class='hs-chr'>'m'</span></a><span class='hs-layout'>,</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5160 : Char^"lq_tmp_x75" | lq_tmp_x5160 == lq_anf__d41a}</span><span class='hs-chr'>'a'</span></a><span class='hs-layout'>,</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5137 : Char^"lq_tmp_x75" | lq_tmp_x5137 == lq_anf__d41b}</span><span class='hs-chr'>'n'</span></a><span class='hs-keyglyph'>]</span>
<span class=hs-linenum>654: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5272 : [Char] | len lq_tmp_x5272 == lq_anf__d41i}</span><span class='hs-varid'>ex6</span></a>  <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5275:[Char]
-&gt; lq_tmp_x5276:{lq_tmp_x5268 : Int | lq_tmp_x5268 &gt;= 0 &amp;&amp; lq_tmp_x5268 &lt;= len lq_tmp_x5275}
-&gt; {lq_tmp_x5272 : [Char] | len lq_tmp_x5272 == lq_tmp_x5276}</span><span class='hs-varid'>chop</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5280 : [{lq_tmp_x5277 : Char^"lq_tmp_x5245" | k_5244[VV#5243:=lq_tmp_x5277][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h][lq_tmp_x5246:=lq_tmp_x5277][lq_tmp_x5238:=lq_tmp_x5280]}]&lt;\lq_tmp_x5278 VV -&gt; k_5248[lq_tmp_x5250:=lq_tmp_x5278][VV#5247:=lq_tmp_x5279][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h][lq_tmp_x5246:=lq_tmp_x5279][lq_tmp_x5237:=lq_tmp_x5278]&gt; | bLens lq_tmp_x5280 == bLen lq_anf__d416 + bLens lq_anf__d41h &amp;&amp; null lq_tmp_x5280 &lt;=&gt; false &amp;&amp; len lq_tmp_x5280 == 1 + len lq_anf__d41h &amp;&amp; xsListSelector lq_tmp_x5280 == lq_anf__d41h &amp;&amp; xListSelector lq_tmp_x5280 == lq_anf__d416 &amp;&amp; len lq_tmp_x5280 &gt;= 0 &amp;&amp; bLens lq_tmp_x5280 &gt;= 0 &amp;&amp; lq_tmp_x5280 == ex#a3LL}</span><span class='hs-varid'>ex</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5281 : Int | lq_tmp_x5281 == (6  :  int) &amp;&amp; lq_tmp_x5281 == lq_anf__d41i}</span><span class='hs-num'>6</span></a>  <span class='hs-comment'>-- ok</span>
<span class=hs-linenum>655: </span>    <a class=annot href="#"><span class=annottext>{lq_tmp_x5297 : [Char] | len lq_tmp_x5297 == lq_anf__d41j}</span><span class='hs-varid'>ex30</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5300:[Char]
-&gt; lq_tmp_x5301:{lq_tmp_x5293 : Int | lq_tmp_x5293 &gt;= 0 &amp;&amp; lq_tmp_x5293 &lt;= len lq_tmp_x5300}
-&gt; {lq_tmp_x5297 : [Char] | len lq_tmp_x5297 == lq_tmp_x5301}</span><span class='hs-varid'>chop</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5305 : [{lq_tmp_x5302 : Char^"lq_tmp_x5245" | k_5244[VV#5243:=lq_tmp_x5302][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h][lq_tmp_x5246:=lq_tmp_x5302][lq_tmp_x5238:=lq_tmp_x5305]}]&lt;\lq_tmp_x5303 VV -&gt; k_5248[lq_tmp_x5250:=lq_tmp_x5303][VV#5247:=lq_tmp_x5304][lq_tmp_x5241:=lq_anf__d416][lq_tmp_x5242:=lq_anf__d41h][lq_tmp_x5246:=lq_tmp_x5304][lq_tmp_x5237:=lq_tmp_x5303]&gt; | bLens lq_tmp_x5305 == bLen lq_anf__d416 + bLens lq_anf__d41h &amp;&amp; null lq_tmp_x5305 &lt;=&gt; false &amp;&amp; len lq_tmp_x5305 == 1 + len lq_anf__d41h &amp;&amp; xsListSelector lq_tmp_x5305 == lq_anf__d41h &amp;&amp; xListSelector lq_tmp_x5305 == lq_anf__d416 &amp;&amp; len lq_tmp_x5305 &gt;= 0 &amp;&amp; bLens lq_tmp_x5305 &gt;= 0 &amp;&amp; lq_tmp_x5305 == ex#a3LL}</span><span class='hs-varid'>ex</span></a> <span class=hs-error><a class=annot href="#"><span class=annottext>{lq_tmp_x5306 : Int | lq_tmp_x5306 == (30  :  int) &amp;&amp; lq_tmp_x5306 == lq_anf__d41j}</span><span class='hs-num'>30</span></a></span>  <span class='hs-comment'>-- out of bounds</span>
</pre>
<p><br></p>
<p>&quot;Bleeding&quot; <code>chop ex 30</code> <em>rejected</em> by compiler</p>
<h2 id="nested-bytestrings">Nested ByteStrings</h2>
<p>For a more in depth example, let's take a look at <code>group</code>, which transforms strings like</p>
<p><code>&quot;foobaaar&quot;</code></p>
<p>into <em>lists</em> of strings like</p>
<p><code>[&quot;f&quot;,&quot;oo&quot;, &quot;b&quot;, &quot;aaa&quot;, &quot;r&quot;]</code>.</p>
<p>The specification is that <code>group</code> should produce a list of <code>ByteStrings</code></p>
<ol style="list-style-type: decimal">
<li>that are all <em>non-empty</em> (safety)</li>
<li>the sum of whose lengths is equal to the length of the input string (precision)</li>
</ol>
<p>We use the type alias</p>
<pre><span class=hs-linenum>682: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ByteStringNE</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>bLen</span> <span class='hs-varid'>v</span> <span class='hs-varop'>&gt;</span> <span class='hs-num'>0</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
</pre>
<p>to specify (safety) and introduce a new measure</p>
<pre><span class=hs-linenum>688: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>measure</span> <span class='hs-varid'>bLens</span>  <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Int</span>
<span class=hs-linenum>689: </span>    <span class='hs-varid'>bLens</span> <span class='hs-layout'>(</span><span class='hs-conid'>[]</span><span class='hs-layout'>)</span>   <span class='hs-keyglyph'>=</span> <span class='hs-num'>0</span>
<span class=hs-linenum>690: </span>    <span class='hs-varid'>bLens</span> <span class='hs-layout'>(</span><span class='hs-varid'>x</span><span class='hs-conop'>:</span><span class='hs-varid'>xs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>bLen</span> <span class='hs-varid'>x</span> <span class='hs-varop'>+</span> <span class='hs-varid'>bLens</span> <span class='hs-varid'>xs</span><span class='hs-layout'>)</span>
<span class=hs-linenum>691: </span>  <span class='hs-keyword'>@-}</span>
</pre>
<p>to specify (precision). The full type-specification looks like this:</p>
<pre><span class=hs-linenum>697: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>group</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ByteStringNE</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>| bLens v = bLen b}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>698: </span><a class=annot href="#"><span class=annottext>lq_tmp_x5860:ByteString
-&gt; {v : [{v : ByteString | bLen v &gt; 0}] | bLens v == bLen lq_tmp_x5860}</span><span class='hs-definition'>group</span></a> <a class=annot href="#"><span class=annottext>ByteString</span><span class='hs-varid'>xs</span></a>
<span class=hs-linenum>699: </span>    <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5866:ByteString
-&gt; {lq_tmp_x5864 : Bool | Prop lq_tmp_x5864 &lt;=&gt; bLen lq_tmp_x5866 == 0}</span><span class='hs-varid'>null</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5867 : ByteString | bLen lq_tmp_x5867 &gt;= 0 &amp;&amp; lq_tmp_x5867 == xs#a3LO}</span><span class='hs-varid'>xs</span></a>   <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall a &lt;p :: a a -&gt; Prop&gt;.
{lq_tmp_x6112 : [a]&lt;\lq_tmp_x6111 VV -&gt; p lq_tmp_x6111&gt; | bLens lq_tmp_x6112 == 0 &amp;&amp; null lq_tmp_x6112 &lt;=&gt; true &amp;&amp; len lq_tmp_x6112 == 0}</span><span class='hs-conid'>[]</span></a>
<span class=hs-linenum>700: </span>    <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>let</span> <a class=annot href="#"><span class=annottext>Word8</span><span class='hs-varid'>y</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x6061:{lq_tmp_x6058 : ByteString | bLen lq_tmp_x6058 &gt; 0}
-&gt; Word8</span><span class='hs-varid'>unsafeHead</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x6062 : ByteString | bLen lq_tmp_x6062 &gt;= 0 &amp;&amp; lq_tmp_x6062 == xs#a3LO}</span><span class='hs-varid'>xs</span></a>
<span class=hs-linenum>701: </span>                      <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{VV#5998 : ByteString^"lq_tmp_x6000" | k_5999}</span><span class='hs-varid'>ys</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{VV#6028 : ByteString^"lq_tmp_x6030" | k_6029}</span><span class='hs-varid'>zs</span></a><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5911:Word8
-&gt; lq_tmp_x5912:ByteString
-&gt; (ByteString, ByteString)&lt;\lq_tmp_x5906 VV -&gt; bLen lq_tmp_x5906 + bLen lq_tmp_x5907 == bLen lq_tmp_x5912&gt;</span><span class='hs-varid'>spanByte</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x5893:{lq_tmp_x5890 : ByteString | bLen lq_tmp_x5890 &gt; 0}
-&gt; Word8</span><span class='hs-varid'>unsafeHead</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5894 : ByteString | bLen lq_tmp_x5894 &gt;= 0 &amp;&amp; lq_tmp_x5894 == xs#a3LO}</span><span class='hs-varid'>xs</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x5899:{lq_tmp_x5896 : ByteString | bLen lq_tmp_x5896 &gt; 0}
-&gt; {lq_tmp_x5897 : ByteString | bLen lq_tmp_x5897 == bLen lq_tmp_x5899 - 1}</span><span class='hs-varid'>unsafeTail</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5900 : ByteString | bLen lq_tmp_x5900 &gt;= 0 &amp;&amp; lq_tmp_x5900 == xs#a3LO}</span><span class='hs-varid'>xs</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>702: </span>                  <span class='hs-keyword'>in</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x6071 : Word8 | lq_tmp_x6071 == y#a3LP}</span><span class='hs-varid'>y</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x6069:Word8
-&gt; lq_tmp_x6070:ByteString
-&gt; {lq_tmp_x6066 : ByteString | bLen lq_tmp_x6066 == 1 + bLen lq_tmp_x6070}</span><span class='hs-varop'>`cons`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x6072 : ByteString^"lq_tmp_x6000" | k_5999[VV#5998:=lq_tmp_x6072] &amp;&amp; bLen lq_tmp_x6072 &gt;= 0 &amp;&amp; lq_tmp_x6072 == ys#a3LQ}</span><span class='hs-varid'>ys</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x6089:{lq_tmp_x6094 : ByteString^"lq_tmp_x6093" | k_6092[VV#6091:=lq_tmp_x6094]}
-&gt; lq_tmp_x6090:[{lq_tmp_x6094 : ByteString^"lq_tmp_x6093" "lq_tmp_x6097" | k_6092[VV#6091:=lq_tmp_x6094] &amp;&amp; k_6096[lq_tmp_x6098:=lq_tmp_x6089][VV#6095:=lq_tmp_x6094]}]&lt;\lq_tmp_x6083 VV -&gt; k_6096[lq_tmp_x6098:=lq_tmp_x6083][VV#6095:=lq_tmp_x6094]&gt;
-&gt; {lq_tmp_x6086 : [{lq_tmp_x6094 : ByteString^"lq_tmp_x6093" | k_6092[VV#6091:=lq_tmp_x6094]}]&lt;\lq_tmp_x6085 VV -&gt; k_6096[lq_tmp_x6098:=lq_tmp_x6085][VV#6095:=lq_tmp_x6094]&gt; | bLens lq_tmp_x6086 == bLen lq_tmp_x6089 + bLens lq_tmp_x6090 &amp;&amp; null lq_tmp_x6086 &lt;=&gt; false &amp;&amp; len lq_tmp_x6086 == 1 + len lq_tmp_x6090 &amp;&amp; xsListSelector lq_tmp_x6086 == lq_tmp_x6090 &amp;&amp; xListSelector lq_tmp_x6086 == lq_tmp_x6089}</span><span class='hs-conop'>:</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5860:ByteString
-&gt; {v : [{v : ByteString | bLen v &gt; 0}] | bLens v == bLen lq_tmp_x5860}</span><span class='hs-varid'>group</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x6081 : ByteString^"lq_tmp_x6030" | k_6029[VV#6028:=lq_tmp_x6081] &amp;&amp; bLen lq_tmp_x6081 &gt;= 0 &amp;&amp; lq_tmp_x6081 == zs#a3LR}</span><span class='hs-varid'>zs</span></a>
</pre>
<p>As you can probably tell, <code>spanByte</code> appears to be doing a lot of the work here, so let's take a closer look at it to see why the post-condition holds.</p>
<pre><span class=hs-linenum>709: </span><span class='hs-definition'>spanByte</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<span class=hs-linenum>710: </span><a class=annot href="#"><span class=annottext>lq_tmp_x3818:Word8
-&gt; lq_tmp_x3819:ByteString
-&gt; (ByteString, ByteString)&lt;\x14 VV -&gt; bLen x14 + bLen VV == bLen lq_tmp_x3819&gt;</span><span class='hs-definition'>spanByte</span></a> <a class=annot href="#"><span class=annottext>Word8</span><span class='hs-varid'>c</span></a> <a class=annot href="#"><span class=annottext>ByteString</span><span class='hs-varid'>ps</span></a><span class='hs-keyglyph'>@</span><span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4526:(IO {lq_tmp_x4518 : ({lq_tmp_x4514 : ByteString^"lq_tmp_x4250" | k_4249[VV#4248:=lq_tmp_x4514][VV#4258:=lq_tmp_x4518][lq_tmp_x4261:=lq_tmp_x4514][lq_tmp_x4265:=lq_tmp_x4518][lq_tmp_x4245:=lq_tmp_x4519]}, {lq_tmp_x4515 : ByteString^"lq_tmp_x4253" | k_4252[VV#4251:=lq_tmp_x4515][VV#4258:=lq_tmp_x4518][lq_tmp_x4262:=lq_tmp_x4515][lq_tmp_x4265:=lq_tmp_x4518][lq_tmp_x4245:=lq_tmp_x4519]})&lt;\lq_tmp_x4516 VV -&gt; k_4256[VV#4255:=lq_tmp_x4517][lq_tmp_x4254:=lq_tmp_x4516][lq_tmp_x4264:=lq_tmp_x4517][lq_tmp_x4263:=lq_tmp_x4516][lq_tmp_x4245:=lq_tmp_x4519]&gt;^"lq_tmp_x4260" "lq_tmp_x246" | k_4259[VV#4258:=lq_tmp_x4518][lq_tmp_x4265:=lq_tmp_x4518][lq_tmp_x4245:=lq_tmp_x4519]})^"lq_tmp_x247"
-&gt; {lq_tmp_x4524 : ({lq_tmp_x4520 : ByteString^"lq_tmp_x4250" | k_4249[VV#4248:=lq_tmp_x4520][VV#4258:=lq_tmp_x4524][lq_tmp_x4261:=lq_tmp_x4520][lq_tmp_x4265:=lq_tmp_x4524][lq_tmp_x4247:=lq_tmp_x4526]}, {lq_tmp_x4521 : ByteString^"lq_tmp_x4253" | k_4252[VV#4251:=lq_tmp_x4521][VV#4258:=lq_tmp_x4524][lq_tmp_x4262:=lq_tmp_x4521][lq_tmp_x4265:=lq_tmp_x4524][lq_tmp_x4247:=lq_tmp_x4526]})&lt;\lq_tmp_x4522 VV -&gt; k_4256[VV#4255:=lq_tmp_x4523][lq_tmp_x4254:=lq_tmp_x4522][lq_tmp_x4264:=lq_tmp_x4523][lq_tmp_x4263:=lq_tmp_x4522][lq_tmp_x4247:=lq_tmp_x4526]&gt;^"lq_tmp_x4260" "lq_tmp_x248" | k_4259[VV#4258:=lq_tmp_x4524][lq_tmp_x4265:=lq_tmp_x4524][lq_tmp_x4247:=lq_tmp_x4526]}</span><span class='hs-varid'>unsafePerformIO</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4472:(lq_tmp_x4471:{lq_tmp_x4495 : (IO {lq_tmp_x4494 : ({lq_tmp_x4490 : ByteString^"lq_tmp_x4476" | k_4475[VV#4474:=lq_tmp_x4490][VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]}, {lq_tmp_x4491 : ByteString^"lq_tmp_x4479" | k_4478[VV#4477:=lq_tmp_x4491][VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]})&lt;\lq_tmp_x4492 VV -&gt; k_4482[VV#4481:=lq_tmp_x4493][lq_tmp_x4480:=lq_tmp_x4492][VV#4487:=lq_tmp_x4495]&gt;^"lq_tmp_x4486" | k_4485[VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]})^"lq_tmp_x4489" | k_4488[VV#4487:=lq_tmp_x4495]}
              -&gt; {lq_tmp_x4513 : ({lq_tmp_x4509 : ByteString^"lq_tmp_x4498" | k_4497[VV#4496:=lq_tmp_x4509][VV#4506:=lq_tmp_x4513]}, {lq_tmp_x4510 : ByteString^"lq_tmp_x4501" | k_4500[VV#4499:=lq_tmp_x4510][VV#4506:=lq_tmp_x4513]})&lt;\lq_tmp_x4511 VV -&gt; k_4504[VV#4503:=lq_tmp_x4512][lq_tmp_x4502:=lq_tmp_x4511]&gt;^"lq_tmp_x4508" | k_4507[VV#4506:=lq_tmp_x4513]})
-&gt; lq_tmp_x4473:{lq_tmp_x4495 : (IO {lq_tmp_x4494 : ({lq_tmp_x4490 : ByteString^"lq_tmp_x4476" | k_4475[VV#4474:=lq_tmp_x4490][VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]}, {lq_tmp_x4491 : ByteString^"lq_tmp_x4479" | k_4478[VV#4477:=lq_tmp_x4491][VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]})&lt;\lq_tmp_x4492 VV -&gt; k_4482[VV#4481:=lq_tmp_x4493][lq_tmp_x4480:=lq_tmp_x4492][VV#4487:=lq_tmp_x4495]&gt;^"lq_tmp_x4486" | k_4485[VV#4484:=lq_tmp_x4494][VV#4487:=lq_tmp_x4495]})^"lq_tmp_x4489" | k_4488[VV#4487:=lq_tmp_x4495]}
-&gt; {lq_tmp_x4513 : ({lq_tmp_x4509 : ByteString^"lq_tmp_x4498" | k_4497[VV#4496:=lq_tmp_x4509][VV#4506:=lq_tmp_x4513]}, {lq_tmp_x4510 : ByteString^"lq_tmp_x4501" | k_4500[VV#4499:=lq_tmp_x4510][VV#4506:=lq_tmp_x4513]})&lt;\lq_tmp_x4511 VV -&gt; k_4504[VV#4503:=lq_tmp_x4512][lq_tmp_x4502:=lq_tmp_x4511]&gt;^"lq_tmp_x4508" | k_4507[VV#4506:=lq_tmp_x4513]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4275:(ForeignPtr {lq_tmp_x4280 : Word8^"lq_tmp_x4279" | k_4278[VV#4277:=lq_tmp_x4280]})
-&gt; lq_tmp_x4276:(lq_tmp_x4274:{lq_tmp_x4268 : (Ptr {lq_tmp_x4280 : Word8^"lq_tmp_x4279" | k_4278[VV#4277:=lq_tmp_x4280]}) | 0 &lt;= plen lq_tmp_x4268 &amp;&amp; plen lq_tmp_x4268 == fplen lq_tmp_x4275}
                 -&gt; (IO {lq_tmp_x4298 : ({lq_tmp_x4294 : ByteString^"lq_tmp_x4283" | k_4282[VV#4281:=lq_tmp_x4294][VV#4291:=lq_tmp_x4298]}, {lq_tmp_x4295 : ByteString^"lq_tmp_x4286" | k_4285[VV#4284:=lq_tmp_x4295][VV#4291:=lq_tmp_x4298]})&lt;\lq_tmp_x4296 VV -&gt; k_4289[VV#4288:=lq_tmp_x4297][lq_tmp_x4287:=lq_tmp_x4296]&gt;^"lq_tmp_x4293" | k_4292[VV#4291:=lq_tmp_x4298]}))
-&gt; (IO {lq_tmp_x4298 : ({lq_tmp_x4294 : ByteString^"lq_tmp_x4283" | k_4282[VV#4281:=lq_tmp_x4294][VV#4291:=lq_tmp_x4298]}, {lq_tmp_x4295 : ByteString^"lq_tmp_x4286" | k_4285[VV#4284:=lq_tmp_x4295][VV#4291:=lq_tmp_x4298]})&lt;\lq_tmp_x4296 VV -&gt; k_4289[VV#4288:=lq_tmp_x4297][lq_tmp_x4287:=lq_tmp_x4296]&gt;^"lq_tmp_x4293" | k_4292[VV#4291:=lq_tmp_x4298]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4300 : (ForeignPtr Word8) | lq_tmp_x4300 == x#a3LU}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4383:(lq_tmp_x4382:(lq_tmp_x4385:{lq_tmp_x4409 : (Ptr {lq_tmp_x4408 : Word8^"lq_tmp_x4388" | k_4387[VV#4386:=lq_tmp_x4408][VV#4389:=lq_tmp_x4409]})^"lq_tmp_x4391" | k_4390[VV#4389:=lq_tmp_x4409]}
                            -&gt; {lq_tmp_x4415 : (IO {lq_tmp_x4414 : ({lq_tmp_x4410 : ByteString^"lq_tmp_x4394" | k_4393[VV#4392:=lq_tmp_x4410][VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]}, {lq_tmp_x4411 : ByteString^"lq_tmp_x4397" | k_4396[VV#4395:=lq_tmp_x4411][VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]})&lt;\lq_tmp_x4412 VV -&gt; k_4400[VV#4399:=lq_tmp_x4413][lq_tmp_x4398:=lq_tmp_x4412][VV#4405:=lq_tmp_x4415]&gt;^"lq_tmp_x4404" | k_4403[VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]})^"lq_tmp_x4407" | k_4406[VV#4405:=lq_tmp_x4415]})
              -&gt; {lq_tmp_x4438 : (IO {lq_tmp_x4437 : ({lq_tmp_x4433 : ByteString^"lq_tmp_x4419" | k_4418[VV#4417:=lq_tmp_x4433][VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]}, {lq_tmp_x4434 : ByteString^"lq_tmp_x4422" | k_4421[VV#4420:=lq_tmp_x4434][VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]})&lt;\lq_tmp_x4435 VV -&gt; k_4425[VV#4424:=lq_tmp_x4436][lq_tmp_x4423:=lq_tmp_x4435][VV#4430:=lq_tmp_x4438]&gt;^"lq_tmp_x4429" | k_4428[VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]})^"lq_tmp_x4432" | k_4431[VV#4430:=lq_tmp_x4438]})
-&gt; lq_tmp_x4384:(lq_tmp_x4385:{lq_tmp_x4409 : (Ptr {lq_tmp_x4408 : Word8^"lq_tmp_x4388" | k_4387[VV#4386:=lq_tmp_x4408][VV#4389:=lq_tmp_x4409]})^"lq_tmp_x4391" | k_4390[VV#4389:=lq_tmp_x4409]}
                 -&gt; {lq_tmp_x4415 : (IO {lq_tmp_x4414 : ({lq_tmp_x4410 : ByteString^"lq_tmp_x4394" | k_4393[VV#4392:=lq_tmp_x4410][VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]}, {lq_tmp_x4411 : ByteString^"lq_tmp_x4397" | k_4396[VV#4395:=lq_tmp_x4411][VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]})&lt;\lq_tmp_x4412 VV -&gt; k_4400[VV#4399:=lq_tmp_x4413][lq_tmp_x4398:=lq_tmp_x4412][VV#4405:=lq_tmp_x4415]&gt;^"lq_tmp_x4404" | k_4403[VV#4402:=lq_tmp_x4414][VV#4405:=lq_tmp_x4415]})^"lq_tmp_x4407" | k_4406[VV#4405:=lq_tmp_x4415]})
-&gt; {lq_tmp_x4438 : (IO {lq_tmp_x4437 : ({lq_tmp_x4433 : ByteString^"lq_tmp_x4419" | k_4418[VV#4417:=lq_tmp_x4433][VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]}, {lq_tmp_x4434 : ByteString^"lq_tmp_x4422" | k_4421[VV#4420:=lq_tmp_x4434][VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]})&lt;\lq_tmp_x4435 VV -&gt; k_4425[VV#4424:=lq_tmp_x4436][lq_tmp_x4423:=lq_tmp_x4435][VV#4430:=lq_tmp_x4438]&gt;^"lq_tmp_x4429" | k_4428[VV#4427:=lq_tmp_x4437][VV#4430:=lq_tmp_x4438]})^"lq_tmp_x4432" | k_4431[VV#4430:=lq_tmp_x4438]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#4305 : (Ptr {VV#4302 : Word8^"lq_tmp_x4304" | k_4303})^"lq_tmp_x4307" | k_4306}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>711: </span>    <a class=annot href="#"><span class=annottext>lq_tmp_x4364:{lq_tmp_x4354 : (Ptr {lq_tmp_x4373 : (Any {lq_tmp_x4372 : *^"lq_tmp_x4368" | k_4367[VV#4366:=lq_tmp_x4372][VV#4369:=lq_tmp_x4373]})^"lq_tmp_x4371" "lq_tmp_x3852" | k_4370[VV#4369:=lq_tmp_x4373] &amp;&amp; k_3851[VV#3853:=lq_tmp_x4354][VV#3850:=lq_tmp_x4373]})^"lq_tmp_x3855" | k_3854[VV#3853:=lq_tmp_x4354]}
-&gt; lq_tmp_x4365:{lq_tmp_x4355 : Int^"lq_tmp_x3859" | k_3858[VV#3857:=lq_tmp_x4355][lq_tmp_x3849:=lq_tmp_x4364]}
-&gt; {lq_tmp_x4361 : (IO {lq_tmp_x4360 : ({lq_tmp_x4356 : ByteString^"lq_tmp_x3862" | k_3861[VV#3860:=lq_tmp_x4356][VV#3870:=lq_tmp_x4360][VV#3873:=lq_tmp_x4361][lq_tmp_x3849:=lq_tmp_x4364][lq_tmp_x3856:=lq_tmp_x4365]}, {lq_tmp_x4357 : ByteString^"lq_tmp_x3865" | k_3864[VV#3863:=lq_tmp_x4357][VV#3870:=lq_tmp_x4360][VV#3873:=lq_tmp_x4361][lq_tmp_x3849:=lq_tmp_x4364][lq_tmp_x3856:=lq_tmp_x4365]})&lt;\lq_tmp_x4358 VV -&gt; k_3868[VV#3867:=lq_tmp_x4359][lq_tmp_x3866:=lq_tmp_x4358][VV#3873:=lq_tmp_x4361][lq_tmp_x3849:=lq_tmp_x4364][lq_tmp_x3856:=lq_tmp_x4365]&gt;^"lq_tmp_x3872" | k_3871[VV#3870:=lq_tmp_x4360][VV#3873:=lq_tmp_x4361][lq_tmp_x3849:=lq_tmp_x4364][lq_tmp_x3856:=lq_tmp_x4365]})^"lq_tmp_x3875" | k_3874[VV#3873:=lq_tmp_x4361][lq_tmp_x3849:=lq_tmp_x4364][lq_tmp_x3856:=lq_tmp_x4365]}</span><span class='hs-varid'>go</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x4345 : (Ptr {lq_tmp_x4344 : Word8^"lq_tmp_x4304" | k_4303[VV#4302:=lq_tmp_x4344][VV#4305:=lq_tmp_x4345]})^"lq_tmp_x4307" | k_4306[VV#4305:=lq_tmp_x4345] &amp;&amp; lq_tmp_x4345 == p#a3M1}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x4330:{lq_tmp_x4325 : (Ptr {lq_tmp_x4335 : Word8^"lq_tmp_x4334" | k_4333[VV#4332:=lq_tmp_x4335]}) | 0 &lt;= plen lq_tmp_x4325}
-&gt; lq_tmp_x4331:{lq_tmp_x4326 : Int | lq_tmp_x4326 &lt;= plen lq_tmp_x4330}
-&gt; {lq_tmp_x4327 : (Ptr {lq_tmp_x4343 : (Any {lq_tmp_x4342 : *^"lq_tmp_x4338" | k_4337[VV#4336:=lq_tmp_x4342][VV#4339:=lq_tmp_x4343]})^"lq_tmp_x4341" | k_4340[VV#4339:=lq_tmp_x4343]}) | 0 &lt;= plen lq_tmp_x4327 &amp;&amp; pbase lq_tmp_x4327 == pbase lq_tmp_x4330 &amp;&amp; plen lq_tmp_x4327 == plen lq_tmp_x4330 - lq_tmp_x4331}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4346 : Int | lq_tmp_x4346 &gt;= 0 &amp;&amp; lq_tmp_x4346 &lt;= fplen x#a3LU &amp;&amp; lq_tmp_x4346 == s#a3LV}</span><span class='hs-varid'>s</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x4377 : Int | lq_tmp_x4377 == (0  :  int) &amp;&amp; lq_tmp_x4377 == lq_anf__d40O}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>712: </span>  <span class='hs-keyword'>where</span>
<span class=hs-linenum>713: </span>    <a class=annot href="#"><span class=annottext>forall b.
lq_tmp_x3849:{VV#3853 : (Ptr {VV#3850 : b^"lq_tmp_x3852" | k_3851})^"lq_tmp_x3855" | k_3854}
-&gt; lq_tmp_x3856:{VV#3857 : Int^"lq_tmp_x3859" | k_3858}
-&gt; {VV#3873 : (IO {VV#3870 : ({VV#3860 : ByteString^"lq_tmp_x3862" | k_3861}, {VV#3863 : ByteString^"lq_tmp_x3865" | k_3864})&lt;\lq_tmp_x3866 VV -&gt; k_3868&gt;^"lq_tmp_x3872" | k_3871})^"lq_tmp_x3875" | k_3874}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{VV#3879 : (Ptr {VV#3876 : b^"lq_tmp_x3878" | k_3877})^"lq_tmp_x3881" | k_3880}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{VV#3882 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY]}</span><span class='hs-varid'>i</span></a> <span class='hs-keyglyph'>|</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x3920 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY][VV#3882:=lq_tmp_x3920] &amp;&amp; lq_tmp_x3920 == i#a3LZ}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3912:{lq_tmp_x3917 : Int^"lq_tmp_x3916" | k_3915[VV#3914:=lq_tmp_x3917][lq_tmp_x3911:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3913:{lq_tmp_x3917 : Int^"lq_tmp_x3916" | k_3915[VV#3914:=lq_tmp_x3917][lq_tmp_x3911:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3907 : Bool | Prop lq_tmp_x3907 &lt;=&gt; lq_tmp_x3912 &gt;= lq_tmp_x3913}</span><span class='hs-varop'>&gt;=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3921 : Int | lq_tmp_x3921 &gt;= 0 &amp;&amp; lq_tmp_x3921 + s#a3LV &lt;= fplen x#a3LU &amp;&amp; lq_tmp_x3921 == l#a3LW}</span><span class='hs-varid'>l</span></a>    <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x4226 : ({lq_tmp_x4222 : ByteString^"lq_tmp_x4211" | k_4210[VV#4209:=lq_tmp_x4222][VV#4219:=lq_tmp_x4226]}, {lq_tmp_x4223 : ByteString^"lq_tmp_x4214" | k_4213[VV#4212:=lq_tmp_x4223][VV#4219:=lq_tmp_x4226]})&lt;\lq_tmp_x4224 VV -&gt; k_4217[VV#4216:=lq_tmp_x4225][lq_tmp_x4215:=lq_tmp_x4224]&gt;^"lq_tmp_x4221" "lq_tmp_x63" | k_4220[VV#4219:=lq_tmp_x4226]}
-&gt; (IO {lq_tmp_x4226 : ({lq_tmp_x4222 : ByteString^"lq_tmp_x4211" | k_4210[VV#4209:=lq_tmp_x4222][VV#4219:=lq_tmp_x4226]}, {lq_tmp_x4223 : ByteString^"lq_tmp_x4214" | k_4213[VV#4212:=lq_tmp_x4223][VV#4219:=lq_tmp_x4226]})&lt;\lq_tmp_x4224 VV -&gt; k_4217[VV#4216:=lq_tmp_x4225][lq_tmp_x4215:=lq_tmp_x4224]&gt;^"lq_tmp_x4221" "lq_tmp_x65" | k_4220[VV#4219:=lq_tmp_x4226]})^"lq_tmp_x4205" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4231 : ({lq_tmp_x4227 : ByteString^"lq_tmp_x4186" | k_4185[VV#4184:=lq_tmp_x4227][lq_tmp_x4182:=lq_anf__d40y][lq_tmp_x4183:=Memory.empty#r2Qz][lq_tmp_x4187:=lq_tmp_x4227][lq_tmp_x4179:=lq_tmp_x4231]}, {lq_tmp_x4228 : ByteString^"lq_tmp_x4190" | k_4189[VV#4188:=lq_tmp_x4228][lq_tmp_x4182:=lq_anf__d40y][lq_tmp_x4183:=Memory.empty#r2Qz][lq_tmp_x4191:=lq_tmp_x4228][lq_tmp_x4179:=lq_tmp_x4231]})&lt;\lq_tmp_x4229 VV -&gt; k_4193[lq_tmp_x4195:=lq_tmp_x4229][VV#4192:=lq_tmp_x4230][lq_tmp_x4182:=lq_anf__d40y][lq_tmp_x4183:=Memory.empty#r2Qz][lq_tmp_x4191:=lq_tmp_x4230][lq_tmp_x4178:=lq_tmp_x4229]&gt; | snd lq_tmp_x4231 == Memory.empty#r2Qz &amp;&amp; fst lq_tmp_x4231 == lq_anf__d40y &amp;&amp; x_Tuple22 lq_tmp_x4231 == Memory.empty#r2Qz &amp;&amp; x_Tuple21 lq_tmp_x4231 == lq_anf__d40y &amp;&amp; lq_tmp_x4231 == lq_anf__d40K}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x4197 : ByteString | bLen lq_tmp_x4197 &gt;= 0 &amp;&amp; lq_tmp_x4197 == ps#a3LT &amp;&amp; bLen lq_tmp_x4197 &gt;= 0 &amp;&amp; lq_tmp_x4197 == Memory.PS#r2Qa x#a3LU s#a3LV l#a3LW &amp;&amp; bLen lq_tmp_x4197 == l#a3LW &amp;&amp; bOff lq_tmp_x4197 == s#a3LV &amp;&amp; bPtr lq_tmp_x4197 == x#a3LU &amp;&amp; bLen lq_tmp_x4197 &gt;= 0 &amp;&amp; lq_tmp_x4197 == lq_anf__d40y}</span><span class='hs-varid'>ps</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x4198 : ByteString | bLen lq_tmp_x4198 == 0 &amp;&amp; bLen lq_tmp_x4198 &gt;= 0 &amp;&amp; lq_tmp_x4198 == Memory.empty#r2Qz}</span><span class='hs-varid'>empty</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>714: </span>           <span class='hs-keyglyph'>|</span> <span class='hs-varid'>otherwise</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span> <a class=annot href="#"><span class=annottext>{VV#3968 : Word8^"lq_tmp_x3970" | k_3969}</span><span class='hs-varid'>c'</span></a> <span class='hs-keyglyph'>&lt;-</span> <a class=annot href="#"><span class=annottext>p:(Ptr {VV#3962 : b^"lq_tmp_x3964" | k_3963})
-&gt; lq_tmp_db5:{lq_tmp_x3952 : Int | 0 &lt;= lq_tmp_x3952 &amp;&amp; lq_tmp_x3952 &lt; plen p}
-&gt; (IO Word8^"lq_tmp_x3958")</span><span class='hs-varid'>peekByteOff</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3965 : (Ptr {VV#3876 : b^"lq_tmp_x3878" | k_3877[VV#3879:=lq_tmp_x3965]})^"lq_tmp_x3881" | k_3880[VV#3879:=lq_tmp_x3965] &amp;&amp; lq_tmp_x3965 == p#a3LY}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3966 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY][VV#3882:=lq_tmp_x3966] &amp;&amp; lq_tmp_x3966 == i#a3LZ}</span><span class='hs-varid'>i</span></a>
<span class=hs-linenum>715: </span>                            <span class='hs-keyword'>if</span> <a class=annot href="#"><span class=annottext>{lq_tmp_x4002 : Word8 | lq_tmp_x4002 == c#a3LS}</span><span class='hs-varid'>c</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3994:{lq_tmp_x3999 : Word8^"lq_tmp_x3998" | k_3997[VV#3996:=lq_tmp_x3999][lq_tmp_x3993:=fix#GHC.Word.#36#fEqWord8#35#r2Vn]}
-&gt; lq_tmp_x3995:{lq_tmp_x3999 : Word8^"lq_tmp_x3998" | k_3997[VV#3996:=lq_tmp_x3999][lq_tmp_x3993:=fix#GHC.Word.#36#fEqWord8#35#r2Vn]}
-&gt; {lq_tmp_x3989 : Bool | Prop lq_tmp_x3989 &lt;=&gt; lq_tmp_x3994 /= lq_tmp_x3995}</span><span class='hs-varop'>/=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4003 : Word8^"lq_tmp_x3970" | k_3969[VV#3968:=lq_tmp_x4003] &amp;&amp; lq_tmp_x4003 == c'#a3M0}</span><span class='hs-varid'>c'</span></a>
<span class=hs-linenum>716: </span>                                <span class='hs-keyword'>then</span> <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x4119 : ({lq_tmp_x4115 : ByteString^"lq_tmp_x4104" | k_4103[VV#4102:=lq_tmp_x4115][VV#4112:=lq_tmp_x4119]}, {lq_tmp_x4116 : ByteString^"lq_tmp_x4107" | k_4106[VV#4105:=lq_tmp_x4116][VV#4112:=lq_tmp_x4119]})&lt;\lq_tmp_x4117 VV -&gt; k_4110[VV#4109:=lq_tmp_x4118][lq_tmp_x4108:=lq_tmp_x4117]&gt;^"lq_tmp_x4114" "lq_tmp_x63" | k_4113[VV#4112:=lq_tmp_x4119]}
-&gt; (IO {lq_tmp_x4119 : ({lq_tmp_x4115 : ByteString^"lq_tmp_x4104" | k_4103[VV#4102:=lq_tmp_x4115][VV#4112:=lq_tmp_x4119]}, {lq_tmp_x4116 : ByteString^"lq_tmp_x4107" | k_4106[VV#4105:=lq_tmp_x4116][VV#4112:=lq_tmp_x4119]})&lt;\lq_tmp_x4117 VV -&gt; k_4110[VV#4109:=lq_tmp_x4118][lq_tmp_x4108:=lq_tmp_x4117]&gt;^"lq_tmp_x4114" "lq_tmp_x65" | k_4113[VV#4112:=lq_tmp_x4119]})^"lq_tmp_x4098" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4124 : ({lq_tmp_x4120 : ByteString^"lq_tmp_x4079" | k_4078[VV#4077:=lq_tmp_x4120][lq_tmp_x4075:=lq_anf__d40G][lq_tmp_x4076:=lq_anf__d40H][lq_tmp_x4080:=lq_tmp_x4120][lq_tmp_x4072:=lq_tmp_x4124]}, {lq_tmp_x4121 : ByteString^"lq_tmp_x4083" | k_4082[VV#4081:=lq_tmp_x4121][lq_tmp_x4075:=lq_anf__d40G][lq_tmp_x4076:=lq_anf__d40H][lq_tmp_x4084:=lq_tmp_x4121][lq_tmp_x4072:=lq_tmp_x4124]})&lt;\lq_tmp_x4122 VV -&gt; k_4086[lq_tmp_x4088:=lq_tmp_x4122][VV#4085:=lq_tmp_x4123][lq_tmp_x4075:=lq_anf__d40G][lq_tmp_x4076:=lq_anf__d40H][lq_tmp_x4084:=lq_tmp_x4123][lq_tmp_x4071:=lq_tmp_x4122]&gt; | snd lq_tmp_x4124 == lq_anf__d40H &amp;&amp; fst lq_tmp_x4124 == lq_anf__d40G &amp;&amp; x_Tuple22 lq_tmp_x4124 == lq_anf__d40H &amp;&amp; x_Tuple21 lq_tmp_x4124 == lq_anf__d40G &amp;&amp; lq_tmp_x4124 == lq_anf__d40I}</span><span class='hs-layout'>(</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x4056:{lq_tmp_x4051 : Int | lq_tmp_x4051 &gt;= 0}
-&gt; lq_tmp_x4057:{lq_tmp_x4052 : ByteString | lq_tmp_x4056 &lt;= bLen lq_tmp_x4052}
-&gt; {lq_tmp_x4053 : ByteString | bLen lq_tmp_x4053 == lq_tmp_x4056}</span><span class='hs-varid'>unsafeTake</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4058 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY][VV#3882:=lq_tmp_x4058] &amp;&amp; lq_tmp_x4058 == i#a3LZ}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4059 : ByteString | bLen lq_tmp_x4059 &gt;= 0 &amp;&amp; lq_tmp_x4059 == ps#a3LT &amp;&amp; bLen lq_tmp_x4059 &gt;= 0 &amp;&amp; lq_tmp_x4059 == Memory.PS#r2Qa x#a3LU s#a3LV l#a3LW &amp;&amp; bLen lq_tmp_x4059 == l#a3LW &amp;&amp; bOff lq_tmp_x4059 == s#a3LV &amp;&amp; bPtr lq_tmp_x4059 == x#a3LU &amp;&amp; bLen lq_tmp_x4059 &gt;= 0 &amp;&amp; lq_tmp_x4059 == lq_anf__d40y}</span><span class='hs-varid'>ps</span></a><span class='hs-layout'>,</span> <a class=annot href="#"><span class=annottext>lq_tmp_x4066:{lq_tmp_x4061 : Int | lq_tmp_x4061 &gt;= 0}
-&gt; lq_tmp_x4067:{lq_tmp_x4062 : ByteString | lq_tmp_x4066 &lt;= bLen lq_tmp_x4062}
-&gt; {lq_tmp_x4063 : ByteString | bLen lq_tmp_x4063 == bLen lq_tmp_x4067 - lq_tmp_x4066}</span><span class='hs-varid'>unsafeDrop</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4068 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY][VV#3882:=lq_tmp_x4068] &amp;&amp; lq_tmp_x4068 == i#a3LZ}</span><span class='hs-varid'>i</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4069 : ByteString | bLen lq_tmp_x4069 &gt;= 0 &amp;&amp; lq_tmp_x4069 == ps#a3LT &amp;&amp; bLen lq_tmp_x4069 &gt;= 0 &amp;&amp; lq_tmp_x4069 == Memory.PS#r2Qa x#a3LU s#a3LV l#a3LW &amp;&amp; bLen lq_tmp_x4069 == l#a3LW &amp;&amp; bOff lq_tmp_x4069 == s#a3LV &amp;&amp; bPtr lq_tmp_x4069 == x#a3LU &amp;&amp; bLen lq_tmp_x4069 &gt;= 0 &amp;&amp; lq_tmp_x4069 == lq_anf__d40y}</span><span class='hs-varid'>ps</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>717: </span>                                <span class='hs-keyword'>else</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3901:{VV#3879 : (Ptr {VV#3876 : b^"lq_tmp_x3878" | k_3877})^"lq_tmp_x3881" | k_3880}
-&gt; lq_tmp_x3902:{VV#3882 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=lq_tmp_x3901]}
-&gt; {VV#3898 : (IO {VV#3895 : ({VV#3885 : ByteString^"lq_tmp_x3887" | k_3886[p#a3LY:=lq_tmp_x3901][i#a3LZ:=lq_tmp_x3902]}, {VV#3888 : ByteString^"lq_tmp_x3890" | k_3889[p#a3LY:=lq_tmp_x3901][i#a3LZ:=lq_tmp_x3902]})&lt;\lq_tmp_x3891 VV -&gt; k_3893[p#a3LY:=lq_tmp_x3901][i#a3LZ:=lq_tmp_x3902]&gt;^"lq_tmp_x3897" | k_3896[p#a3LY:=lq_tmp_x3901][i#a3LZ:=lq_tmp_x3902]})^"lq_tmp_x3900" | k_3899[p#a3LY:=lq_tmp_x3901][i#a3LZ:=lq_tmp_x3902]}</span><span class='hs-varid'>go</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x4044 : (Ptr {VV#3876 : b^"lq_tmp_x3878" | k_3877[VV#3879:=lq_tmp_x4044]})^"lq_tmp_x3881" | k_3880[VV#3879:=lq_tmp_x4044] &amp;&amp; lq_tmp_x4044 == p#a3LY}</span><span class='hs-varid'>p</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x4029 : Int^"lq_tmp_x3884" | k_3883[p#a3LY:=p#a3LY][lq_tmp_x3901:=p#a3LY][VV#3882:=lq_tmp_x4029] &amp;&amp; lq_tmp_x4029 == i#a3LZ}</span><span class='hs-varid'>i</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x4023:Int^"lq_tmp_x4025"
-&gt; lq_tmp_x4024:Int^"lq_tmp_x4025"
-&gt; {lq_tmp_x4026 : Int^"lq_tmp_x4025" | lq_tmp_x4026 == lq_tmp_x4023 + lq_tmp_x4024}</span><span class='hs-varop'>+</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x4030 : Int | lq_tmp_x4030 == (1  :  int) &amp;&amp; lq_tmp_x4030 == lq_anf__d40E}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span>
</pre>
<p>LiquidHaskell infers that <code>0 &lt;= i &lt;= l</code> and therefore that all of the memory accesses are safe. Furthermore, due to the precise specifications given to <code>unsafeTake</code> and <code>unsafeDrop</code>, it is able to prove that <code>spanByte</code> has the type</p>
<pre><span class=hs-linenum>725: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>spanByte</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteStringPair</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
</pre>
<p>where <code>ByteStringPair b</code> describes a pair of <code>ByteString</code>s whose lengths sum to the length of <code>b</code>.</p>
<pre><span class=hs-linenum>732: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ByteStringPair</span> <span class='hs-conid'>B</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>,</span> <span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span><span class='hs-varop'>&lt;</span><span class='hs-layout'>{</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>x1</span> <span class='hs-varid'>x2</span> <span class='hs-keyglyph'>-&gt;</span>
<span class=hs-linenum>733: </span>       <span class='hs-varid'>bLen</span> <span class='hs-varid'>x1</span> <span class='hs-varop'>+</span> <span class='hs-varid'>bLen</span> <span class='hs-varid'>x2</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bLen</span> <span class='hs-conid'>B</span><span class='hs-layout'>}</span><span class='hs-varop'>&gt;</span> <span class='hs-keyword'>@-}</span>
</pre>
<h2 id="recap-types-against-overflows">Recap: Types Against Overflows</h2>
<p><br></p>
<p><strong>Strategy: Specify and Verify Types for</strong></p>
<p><br></p>
<ol style="list-style-type: decimal">
<li>Low-level <code>Pointer</code> API</li>
<li>Lib-level <code>ByteString</code> API</li>
<li>User-level <code>Application</code> API</li>
</ol>
<p><br></p>
<p><strong>Errors at <em>each</em> level are prevented by types at <em>lower</em> levels</strong></p>
<p>\begin{comment}</p>
<pre><span class=hs-linenum>761: </span><span class='hs-comment'>-----------------------------------------------------------------------</span>
<span class=hs-linenum>762: </span><span class='hs-comment'>-- Helper Code</span>
<span class=hs-linenum>763: </span><span class='hs-comment'>-----------------------------------------------------------------------</span>
<span class=hs-linenum>764: </span>
<span class=hs-linenum>765: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unsafeCreate</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>l</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-conid'>PtrN</span> <span class='hs-conid'>Word8</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteStringN</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>766: </span><a class=annot href="#"><span class=annottext>lq_tmp_x5436:{v : Int | v &gt;= 0}
-&gt; lq_tmp_x5437:(lq_tmp_x5435:{VV : (Ptr Word8) | 0 &lt;= plen VV &amp;&amp; plen VV == lq_tmp_x5436}
                 -&gt; (IO ()))
-&gt; {v : ByteString | bLen v == lq_tmp_x5436}</span><span class='hs-definition'>unsafeCreate</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5435:{VV : (Ptr Word8) | 0 &lt;= plen VV &amp;&amp; plen VV == n#a3M2}
-&gt; (IO ())</span><span class='hs-varid'>f</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5450:{lq_tmp_x5440 : Int | lq_tmp_x5440 &gt;= 0}
-&gt; lq_tmp_x5451:(lq_tmp_x5449:{lq_tmp_x5442 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5442 &amp;&amp; plen lq_tmp_x5442 == lq_tmp_x5450}
                 -&gt; (IO ()))
-&gt; {lq_tmp_x5446 : ByteString | bLen lq_tmp_x5446 == lq_tmp_x5450}</span><span class='hs-varid'>create</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5452 : Int | lq_tmp_x5452 &gt;= 0 &amp;&amp; lq_tmp_x5452 == n#a3M2}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5458:{lq_tmp_x5454 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5454 &amp;&amp; plen lq_tmp_x5454 == n#a3M2}
-&gt; (IO ())</span><span class='hs-varid'>f</span></a> <span class='hs-comment'>-- unsafePerformIO $ create n f</span>
<span class=hs-linenum>767: </span>
<span class=hs-linenum>768: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>invariant</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span>   <span class='hs-keyword'>| bLen  v &gt;= 0}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>769: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>invariant</span> <span class='hs-keyword'>{v:</span><span class='hs-keyglyph'>[</span><span class='hs-conid'>ByteString</span><span class='hs-keyglyph'>]</span> <span class='hs-keyword'>| bLens v &gt;= 0}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>770: </span>
<span class=hs-linenum>771: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>PLLen</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>p</span><span class='hs-conop'>:</span><span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-conop'>:</span> <span class='hs-layout'>(</span><span class='hs-varid'>len</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-varop'>&lt;=</span> <span class='hs-layout'>(</span><span class='hs-varid'>plen</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>772: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>ForeignPtrN</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-varid'>int</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span> <span class='hs-varid'>fplen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>n</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>773: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>FPLenPLen</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>fp</span><span class='hs-conop'>:</span><span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span> <span class='hs-varid'>fplen</span> <span class='hs-varid'>fp</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>plen</span> <span class='hs-varid'>v</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>774: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>PtrLen</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>xs</span><span class='hs-conop'>:</span><span class='hs-conid'>List</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span> <span class='hs-varid'>plen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>len</span> <span class='hs-varid'>xs</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>775: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>qualif</span> <span class='hs-conid'>PlenEq</span><span class='hs-layout'>(</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span> <span class='hs-conid'>Ptr</span> <span class='hs-varid'>a</span><span class='hs-layout'>,</span> <span class='hs-varid'>x</span><span class='hs-conop'>:</span> <span class='hs-varid'>int</span><span class='hs-layout'>)</span><span class='hs-conop'>:</span> <span class='hs-varid'>x</span> <span class='hs-varop'>&lt;=</span> <span class='hs-layout'>(</span><span class='hs-varid'>plen</span> <span class='hs-varid'>v</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>776: </span>
<span class=hs-linenum>777: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unsafeHead</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) &gt; 0}</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>778: </span>
<span class=hs-linenum>779: </span><span class='hs-definition'>unsafeHead</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>780: </span><a class=annot href="#"><span class=annottext>lq_tmp_x3448:{v : ByteString | bLen v &gt; 0} -&gt; Word8</span><span class='hs-definition'>unsafeHead</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3503:{lq_tmp_x3500 : Bool | Prop lq_tmp_x3500}
-&gt; lq_tmp_x3504:{lq_tmp_x3508 : Word8^"lq_tmp_x3507" | k_3506[VV#3505:=lq_tmp_x3508]}
-&gt; {lq_tmp_x3508 : Word8^"lq_tmp_x3507" | k_3506[VV#3505:=lq_tmp_x3508]}</span><span class='hs-varid'>liquidAssert</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3497 : Int | lq_tmp_x3497 &gt;= 0 &amp;&amp; lq_tmp_x3497 + s#a3M5 &lt;= fplen x#a3M4 &amp;&amp; lq_tmp_x3497 == l#a3M6}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3489:{lq_tmp_x3494 : Int^"lq_tmp_x3493" | k_3492[VV#3491:=lq_tmp_x3494][lq_tmp_x3488:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3490:{lq_tmp_x3494 : Int^"lq_tmp_x3493" | k_3492[VV#3491:=lq_tmp_x3494][lq_tmp_x3488:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3484 : Bool | Prop lq_tmp_x3484 &lt;=&gt; lq_tmp_x3489 &gt; lq_tmp_x3490}</span><span class='hs-varop'>&gt;</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3498 : Int | lq_tmp_x3498 == (0  :  int) &amp;&amp; lq_tmp_x3498 == lq_anf__d40h}</span><span class='hs-num'>0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3646:(lq_tmp_x3645:{lq_tmp_x3651 : Word8^"lq_tmp_x3650" | k_3649[VV#3648:=lq_tmp_x3651]}
              -&gt; {lq_tmp_x3655 : Word8^"lq_tmp_x3654" | k_3653[VV#3652:=lq_tmp_x3655]})
-&gt; lq_tmp_x3647:{lq_tmp_x3651 : Word8^"lq_tmp_x3650" | k_3649[VV#3648:=lq_tmp_x3651]}
-&gt; {lq_tmp_x3655 : Word8^"lq_tmp_x3654" | k_3653[VV#3652:=lq_tmp_x3655]}</span><span class='hs-varop'>$</span></a>
<span class=hs-linenum>781: </span>  <a class=annot href="#"><span class=annottext>lq_tmp_x3638:(IO {lq_tmp_x3634 : Word8^"lq_tmp_x3516" "lq_tmp_x246" | k_3515[VV#3514:=lq_tmp_x3634][lq_tmp_x3517:=lq_tmp_x3634][lq_tmp_x3511:=lq_tmp_x3635]})^"lq_tmp_x247"
-&gt; {lq_tmp_x3636 : Word8^"lq_tmp_x3516" "lq_tmp_x248" | k_3515[VV#3514:=lq_tmp_x3636][lq_tmp_x3517:=lq_tmp_x3636][lq_tmp_x3513:=lq_tmp_x3638]}</span><span class='hs-varid'>unsafePerformIO</span></a>  <a class=annot href="#"><span class=annottext>lq_tmp_x3620:(lq_tmp_x3619:{lq_tmp_x3629 : (IO {lq_tmp_x3628 : Word8^"lq_tmp_x3624" | k_3623[VV#3622:=lq_tmp_x3628][VV#3625:=lq_tmp_x3629]})^"lq_tmp_x3627" | k_3626[VV#3625:=lq_tmp_x3629]}
              -&gt; {lq_tmp_x3633 : Word8^"lq_tmp_x3632" | k_3631[VV#3630:=lq_tmp_x3633]})
-&gt; lq_tmp_x3621:{lq_tmp_x3629 : (IO {lq_tmp_x3628 : Word8^"lq_tmp_x3624" | k_3623[VV#3622:=lq_tmp_x3628][VV#3625:=lq_tmp_x3629]})^"lq_tmp_x3627" | k_3626[VV#3625:=lq_tmp_x3629]}
-&gt; {lq_tmp_x3633 : Word8^"lq_tmp_x3632" | k_3631[VV#3630:=lq_tmp_x3633]}</span><span class='hs-varop'>$</span></a>  <a class=annot href="#"><span class=annottext>lq_tmp_x3527:(ForeignPtr {lq_tmp_x3532 : Word8^"lq_tmp_x3531" | k_3530[VV#3529:=lq_tmp_x3532]})
-&gt; lq_tmp_x3528:(lq_tmp_x3526:{lq_tmp_x3520 : (Ptr {lq_tmp_x3532 : Word8^"lq_tmp_x3531" | k_3530[VV#3529:=lq_tmp_x3532]}) | 0 &lt;= plen lq_tmp_x3520 &amp;&amp; plen lq_tmp_x3520 == fplen lq_tmp_x3527}
                 -&gt; (IO {lq_tmp_x3536 : Word8^"lq_tmp_x3535" | k_3534[VV#3533:=lq_tmp_x3536]}))
-&gt; (IO {lq_tmp_x3536 : Word8^"lq_tmp_x3535" | k_3534[VV#3533:=lq_tmp_x3536]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3538 : (ForeignPtr Word8) | lq_tmp_x3538 == x#a3M4}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3571:(lq_tmp_x3570:(lq_tmp_x3573:{lq_tmp_x3587 : (Ptr {lq_tmp_x3586 : Word8^"lq_tmp_x3576" | k_3575[VV#3574:=lq_tmp_x3586][VV#3577:=lq_tmp_x3587]})^"lq_tmp_x3579" | k_3578[VV#3577:=lq_tmp_x3587]}
                            -&gt; {lq_tmp_x3589 : (IO {lq_tmp_x3588 : Word8^"lq_tmp_x3582" | k_3581[VV#3580:=lq_tmp_x3588][VV#3583:=lq_tmp_x3589]})^"lq_tmp_x3585" | k_3584[VV#3583:=lq_tmp_x3589]})
              -&gt; {lq_tmp_x3598 : (IO {lq_tmp_x3597 : Word8^"lq_tmp_x3593" | k_3592[VV#3591:=lq_tmp_x3597][VV#3594:=lq_tmp_x3598]})^"lq_tmp_x3596" | k_3595[VV#3594:=lq_tmp_x3598]})
-&gt; lq_tmp_x3572:(lq_tmp_x3573:{lq_tmp_x3587 : (Ptr {lq_tmp_x3586 : Word8^"lq_tmp_x3576" | k_3575[VV#3574:=lq_tmp_x3586][VV#3577:=lq_tmp_x3587]})^"lq_tmp_x3579" | k_3578[VV#3577:=lq_tmp_x3587]}
                 -&gt; {lq_tmp_x3589 : (IO {lq_tmp_x3588 : Word8^"lq_tmp_x3582" | k_3581[VV#3580:=lq_tmp_x3588][VV#3583:=lq_tmp_x3589]})^"lq_tmp_x3585" | k_3584[VV#3583:=lq_tmp_x3589]})
-&gt; {lq_tmp_x3598 : (IO {lq_tmp_x3597 : Word8^"lq_tmp_x3593" | k_3592[VV#3591:=lq_tmp_x3597][VV#3594:=lq_tmp_x3598]})^"lq_tmp_x3596" | k_3595[VV#3594:=lq_tmp_x3598]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3614:{lq_tmp_x3610 : (Ptr {lq_tmp_x3609 : Word8^"lq_tmp_x3542" | k_3541[VV#3540:=lq_tmp_x3609][VV#3543:=lq_tmp_x3610]})^"lq_tmp_x3545" | k_3544[VV#3543:=lq_tmp_x3610]}
-&gt; (IO Word8^"lq_tmp_x3555")</span><span class='hs-keyglyph'>\</span></a><a class=annot href="#"><span class=annottext>{VV#3543 : (Ptr {VV#3540 : Word8^"lq_tmp_x3542" | k_3541})^"lq_tmp_x3545" | k_3544}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>p:(Ptr {lq_tmp_x3562 : Word8^"lq_tmp_x3561" | k_3560[VV#3559:=lq_tmp_x3562]})
-&gt; lq_tmp_db5:{lq_tmp_x3549 : Int | 0 &lt;= lq_tmp_x3549 &amp;&amp; lq_tmp_x3549 &lt; plen p}
-&gt; (IO Word8^"lq_tmp_x3555")</span><span class='hs-varid'>peekByteOff</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3564 : (Ptr {lq_tmp_x3563 : Word8^"lq_tmp_x3542" | k_3541[VV#3540:=lq_tmp_x3563][VV#3543:=lq_tmp_x3564]})^"lq_tmp_x3545" | k_3544[VV#3543:=lq_tmp_x3564] &amp;&amp; lq_tmp_x3564 == p#a3M7}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3565 : Int | lq_tmp_x3565 &gt;= 0 &amp;&amp; lq_tmp_x3565 &lt;= fplen x#a3M4 &amp;&amp; lq_tmp_x3565 == s#a3M5}</span><span class='hs-varid'>s</span></a>
<span class=hs-linenum>782: </span>
<span class=hs-linenum>783: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unsafeTail</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) &gt; 0}</span>
<span class=hs-linenum>784: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) = (bLen b) - 1}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>785: </span><span class='hs-definition'>unsafeTail</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<span class=hs-linenum>786: </span><a class=annot href="#"><span class=annottext>lq_tmp_x3309:{v : ByteString | bLen v &gt; 0}
-&gt; {v : ByteString | bLen v == bLen lq_tmp_x3309 - 1}</span><span class='hs-definition'>unsafeTail</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>ps</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3364:{lq_tmp_x3361 : Bool | Prop lq_tmp_x3361}
-&gt; lq_tmp_x3365:{lq_tmp_x3369 : ByteString^"lq_tmp_x3368" | k_3367[VV#3366:=lq_tmp_x3369]}
-&gt; {lq_tmp_x3369 : ByteString^"lq_tmp_x3368" | k_3367[VV#3366:=lq_tmp_x3369]}</span><span class='hs-varid'>liquidAssert</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3358 : Int | lq_tmp_x3358 &gt;= 0 &amp;&amp; lq_tmp_x3358 + s#a3M9 &lt;= fplen ps#a3M8 &amp;&amp; lq_tmp_x3358 == l#a3Ma}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3350:{lq_tmp_x3355 : Int^"lq_tmp_x3354" | k_3353[VV#3352:=lq_tmp_x3355][lq_tmp_x3349:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3351:{lq_tmp_x3355 : Int^"lq_tmp_x3354" | k_3353[VV#3352:=lq_tmp_x3355][lq_tmp_x3349:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3345 : Bool | Prop lq_tmp_x3345 &lt;=&gt; lq_tmp_x3350 &gt; lq_tmp_x3351}</span><span class='hs-varop'>&gt;</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3359 : Int | lq_tmp_x3359 == (0  :  int) &amp;&amp; lq_tmp_x3359 == lq_anf__d408}</span><span class='hs-num'>0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3432:(lq_tmp_x3431:{lq_tmp_x3437 : ByteString^"lq_tmp_x3436" | k_3435[VV#3434:=lq_tmp_x3437]}
              -&gt; {lq_tmp_x3441 : ByteString^"lq_tmp_x3440" | k_3439[VV#3438:=lq_tmp_x3441]})
-&gt; lq_tmp_x3433:{lq_tmp_x3437 : ByteString^"lq_tmp_x3436" | k_3435[VV#3434:=lq_tmp_x3437]}
-&gt; {lq_tmp_x3441 : ByteString^"lq_tmp_x3440" | k_3439[VV#3438:=lq_tmp_x3441]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3420:(ForeignPtr Word8)
-&gt; lq_tmp_x3421:{lq_tmp_x3414 : Int | lq_tmp_x3414 &gt;= 0 &amp;&amp; lq_tmp_x3414 &lt;= fplen lq_tmp_x3420}
-&gt; lq_tmp_x3422:{lq_tmp_x3415 : Int | lq_tmp_x3415 &gt;= 0 &amp;&amp; lq_tmp_x3415 + lq_tmp_x3421 &lt;= fplen lq_tmp_x3420}
-&gt; {lq_tmp_x3416 : ByteString | bLen lq_tmp_x3416 == lq_tmp_x3422 &amp;&amp; bOff lq_tmp_x3416 == lq_tmp_x3421 &amp;&amp; bPtr lq_tmp_x3416 == lq_tmp_x3420}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3424 : (ForeignPtr Word8) | lq_tmp_x3424 == ps#a3M8}</span><span class='hs-varid'>ps</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3389 : Int | lq_tmp_x3389 &gt;= 0 &amp;&amp; lq_tmp_x3389 &lt;= fplen ps#a3M8 &amp;&amp; lq_tmp_x3389 == s#a3M9}</span><span class='hs-varid'>s</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x3383:Int^"lq_tmp_x3385"
-&gt; lq_tmp_x3384:Int^"lq_tmp_x3385"
-&gt; {lq_tmp_x3386 : Int^"lq_tmp_x3385" | lq_tmp_x3386 == lq_tmp_x3383 + lq_tmp_x3384}</span><span class='hs-varop'>+</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x3390 : Int | lq_tmp_x3390 == (1  :  int) &amp;&amp; lq_tmp_x3390 == lq_anf__d40b}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3409 : Int | lq_tmp_x3409 &gt;= 0 &amp;&amp; lq_tmp_x3409 + s#a3M9 &lt;= fplen ps#a3M8 &amp;&amp; lq_tmp_x3409 == l#a3Ma}</span><span class='hs-varid'>l</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x3403:Int^"lq_tmp_x3405"
-&gt; lq_tmp_x3404:Int^"lq_tmp_x3405"
-&gt; {lq_tmp_x3406 : Int^"lq_tmp_x3405" | lq_tmp_x3406 == lq_tmp_x3403 - lq_tmp_x3404}</span><span class='hs-comment'>-</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x3410 : Int | lq_tmp_x3410 == (1  :  int) &amp;&amp; lq_tmp_x3410 == lq_anf__d40d}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>787: </span>
<span class=hs-linenum>788: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>null</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>Bool</span> <span class='hs-keyword'>| ((Prop v) &lt;=&gt; ((bLen b) = 0))}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>789: </span><span class='hs-definition'>null</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Bool</span>
<span class=hs-linenum>790: </span><a class=annot href="#"><span class=annottext>lq_tmp_x3203:ByteString
-&gt; {v : Bool | Prop v &lt;=&gt; bLen lq_tmp_x3203 == 0}</span><span class='hs-definition'>null</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3258:{lq_tmp_x3255 : Bool | Prop lq_tmp_x3255}
-&gt; lq_tmp_x3259:{lq_tmp_x3263 : Bool^"lq_tmp_x3262" | k_3261[VV#3260:=lq_tmp_x3263]}
-&gt; {lq_tmp_x3263 : Bool^"lq_tmp_x3262" | k_3261[VV#3260:=lq_tmp_x3263]}</span><span class='hs-varid'>liquidAssert</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3252 : Int | lq_tmp_x3252 &gt;= 0 &amp;&amp; lq_tmp_x3252 + ds_d3Xg &lt;= fplen ds_d3Xf &amp;&amp; lq_tmp_x3252 == l#a3Mb}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3244:{lq_tmp_x3249 : Int^"lq_tmp_x3248" | k_3247[VV#3246:=lq_tmp_x3249][lq_tmp_x3243:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3245:{lq_tmp_x3249 : Int^"lq_tmp_x3248" | k_3247[VV#3246:=lq_tmp_x3249][lq_tmp_x3243:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3239 : Bool | Prop lq_tmp_x3239 &lt;=&gt; lq_tmp_x3244 &gt;= lq_tmp_x3245}</span><span class='hs-varop'>&gt;=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3253 : Int | lq_tmp_x3253 == (0  :  int) &amp;&amp; lq_tmp_x3253 == lq_anf__d402}</span><span class='hs-num'>0</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3293:(lq_tmp_x3292:{lq_tmp_x3298 : Bool^"lq_tmp_x3297" | k_3296[VV#3295:=lq_tmp_x3298]}
              -&gt; {lq_tmp_x3302 : Bool^"lq_tmp_x3301" | k_3300[VV#3299:=lq_tmp_x3302]})
-&gt; lq_tmp_x3294:{lq_tmp_x3298 : Bool^"lq_tmp_x3297" | k_3296[VV#3295:=lq_tmp_x3298]}
-&gt; {lq_tmp_x3302 : Bool^"lq_tmp_x3301" | k_3300[VV#3299:=lq_tmp_x3302]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3286 : Int | lq_tmp_x3286 &gt;= 0 &amp;&amp; lq_tmp_x3286 + ds_d3Xg &lt;= fplen ds_d3Xf &amp;&amp; lq_tmp_x3286 == l#a3Mb}</span><span class='hs-varid'>l</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3278:{lq_tmp_x3283 : Int^"lq_tmp_x3282" | k_3281[VV#3280:=lq_tmp_x3283][lq_tmp_x3277:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3279:{lq_tmp_x3283 : Int^"lq_tmp_x3282" | k_3281[VV#3280:=lq_tmp_x3283][lq_tmp_x3277:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3273 : Bool | Prop lq_tmp_x3273 &lt;=&gt; lq_tmp_x3278 &lt;= lq_tmp_x3279}</span><span class='hs-varop'>&lt;=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3287 : Int | lq_tmp_x3287 == (0  :  int) &amp;&amp; lq_tmp_x3287 == lq_anf__d405}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>791: </span>
<span class=hs-linenum>792: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>unsafeDrop</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span>
<span class=hs-linenum>793: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-keyword'>{v:</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| n &lt;= (bLen v)}</span> 
<span class=hs-linenum>794: </span>               <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) = (bLen b) - n}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>795: </span><span class='hs-definition'>unsafeDrop</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<span class=hs-linenum>796: </span><a class=annot href="#"><span class=annottext>lq_tmp_x3662:{v : Int | v &gt;= 0}
-&gt; lq_tmp_x3663:{v : ByteString | lq_tmp_x3662 &lt;= bLen v}
-&gt; {v : ByteString | bLen v == bLen lq_tmp_x3663 - lq_tmp_x3662}</span><span class='hs-definition'>unsafeDrop</span></a> <a class=annot href="#"><span class=annottext>{v : Int | v &gt;= 0}</span><span class='hs-varid'>n</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3746:{lq_tmp_x3743 : Bool | Prop lq_tmp_x3743}
-&gt; lq_tmp_x3747:{lq_tmp_x3751 : ByteString^"lq_tmp_x3750" | k_3749[VV#3748:=lq_tmp_x3751]}
-&gt; {lq_tmp_x3751 : ByteString^"lq_tmp_x3750" | k_3749[VV#3748:=lq_tmp_x3751]}</span><span class='hs-varid'>liquidAssert</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3713 : Int | lq_tmp_x3713 == (0  :  int) &amp;&amp; lq_tmp_x3713 == lq_anf__d40q}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3705:{lq_tmp_x3710 : Int^"lq_tmp_x3709" | k_3708[VV#3707:=lq_tmp_x3710][lq_tmp_x3704:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3706:{lq_tmp_x3710 : Int^"lq_tmp_x3709" | k_3708[VV#3707:=lq_tmp_x3710][lq_tmp_x3704:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3700 : Bool | Prop lq_tmp_x3700 &lt;=&gt; lq_tmp_x3705 &lt;= lq_tmp_x3706}</span><span class='hs-varop'>&lt;=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3714 : Int | lq_tmp_x3714 &gt;= 0 &amp;&amp; lq_tmp_x3714 == n#a3Mc}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3738:Bool
-&gt; lq_tmp_x3739:Bool
-&gt; {lq_tmp_x3735 : Bool | Prop lq_tmp_x3735 &lt;=&gt; Prop lq_tmp_x3738 &amp;&amp; Prop lq_tmp_x3739}</span><span class='hs-varop'>&amp;&amp;</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3730 : Int | lq_tmp_x3730 &gt;= 0 &amp;&amp; lq_tmp_x3730 == n#a3Mc}</span><span class='hs-varid'>n</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3722:{lq_tmp_x3727 : Int^"lq_tmp_x3726" | k_3725[VV#3724:=lq_tmp_x3727][lq_tmp_x3721:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; lq_tmp_x3723:{lq_tmp_x3727 : Int^"lq_tmp_x3726" | k_3725[VV#3724:=lq_tmp_x3727][lq_tmp_x3721:=fix#GHC.Classes.#36#fOrdInt#35#rhx]}
-&gt; {lq_tmp_x3717 : Bool | Prop lq_tmp_x3717 &lt;=&gt; lq_tmp_x3722 &lt;= lq_tmp_x3723}</span><span class='hs-varop'>&lt;=</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3731 : Int | lq_tmp_x3731 &gt;= 0 &amp;&amp; lq_tmp_x3731 + s#a3Me &lt;= fplen x#a3Md &amp;&amp; lq_tmp_x3731 == l#a3Mf}</span><span class='hs-varid'>l</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x3802:(lq_tmp_x3801:{lq_tmp_x3807 : ByteString^"lq_tmp_x3806" | k_3805[VV#3804:=lq_tmp_x3807]}
              -&gt; {lq_tmp_x3811 : ByteString^"lq_tmp_x3810" | k_3809[VV#3808:=lq_tmp_x3811]})
-&gt; lq_tmp_x3803:{lq_tmp_x3807 : ByteString^"lq_tmp_x3806" | k_3805[VV#3804:=lq_tmp_x3807]}
-&gt; {lq_tmp_x3811 : ByteString^"lq_tmp_x3810" | k_3809[VV#3808:=lq_tmp_x3811]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x3790:(ForeignPtr Word8)
-&gt; lq_tmp_x3791:{lq_tmp_x3784 : Int | lq_tmp_x3784 &gt;= 0 &amp;&amp; lq_tmp_x3784 &lt;= fplen lq_tmp_x3790}
-&gt; lq_tmp_x3792:{lq_tmp_x3785 : Int | lq_tmp_x3785 &gt;= 0 &amp;&amp; lq_tmp_x3785 + lq_tmp_x3791 &lt;= fplen lq_tmp_x3790}
-&gt; {lq_tmp_x3786 : ByteString | bLen lq_tmp_x3786 == lq_tmp_x3792 &amp;&amp; bOff lq_tmp_x3786 == lq_tmp_x3791 &amp;&amp; bPtr lq_tmp_x3786 == lq_tmp_x3790}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x3794 : (ForeignPtr Word8) | lq_tmp_x3794 == x#a3Md}</span><span class='hs-varid'>x</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3765 : Int | lq_tmp_x3765 &gt;= 0 &amp;&amp; lq_tmp_x3765 &lt;= fplen x#a3Md &amp;&amp; lq_tmp_x3765 == s#a3Me}</span><span class='hs-varid'>s</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x3759:Int^"lq_tmp_x3761"
-&gt; lq_tmp_x3760:Int^"lq_tmp_x3761"
-&gt; {lq_tmp_x3762 : Int^"lq_tmp_x3761" | lq_tmp_x3762 == lq_tmp_x3759 + lq_tmp_x3760}</span><span class='hs-varop'>+</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x3766 : Int | lq_tmp_x3766 &gt;= 0 &amp;&amp; lq_tmp_x3766 == n#a3Mc}</span><span class='hs-varid'>n</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x3779 : Int | lq_tmp_x3779 &gt;= 0 &amp;&amp; lq_tmp_x3779 + s#a3Me &lt;= fplen x#a3Md &amp;&amp; lq_tmp_x3779 == l#a3Mf}</span><span class='hs-varid'>l</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x3773:Int^"lq_tmp_x3775"
-&gt; lq_tmp_x3774:Int^"lq_tmp_x3775"
-&gt; {lq_tmp_x3776 : Int^"lq_tmp_x3775" | lq_tmp_x3776 == lq_tmp_x3773 - lq_tmp_x3774}</span><span class='hs-comment'>-</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x3780 : Int | lq_tmp_x3780 &gt;= 0 &amp;&amp; lq_tmp_x3780 == n#a3Mc}</span><span class='hs-varid'>n</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>797: </span>
<span class=hs-linenum>798: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>cons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>b</span><span class='hs-conop'>:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) = 1 + (bLen b)}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>799: </span><span class='hs-definition'>cons</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<span class=hs-linenum>800: </span><a class=annot href="#"><span class=annottext>lq_tmp_x5531:Word8
-&gt; lq_tmp_x5532:ByteString
-&gt; {v : ByteString | bLen v == 1 + bLen lq_tmp_x5532}</span><span class='hs-definition'>cons</span></a> <a class=annot href="#"><span class=annottext>Word8</span><span class='hs-varid'>c</span></a> <span class='hs-layout'>(</span><span class='hs-conid'>PS</span> <span class='hs-varid'>x</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5592:{lq_tmp_x5582 : Int | lq_tmp_x5582 &gt;= 0}
-&gt; lq_tmp_x5593:(lq_tmp_x5591:{lq_tmp_x5584 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5584 &amp;&amp; plen lq_tmp_x5584 == lq_tmp_x5592}
                 -&gt; (IO ()))
-&gt; {lq_tmp_x5588 : ByteString | bLen lq_tmp_x5588 == lq_tmp_x5592}</span><span class='hs-varid'>unsafeCreate</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5579 : Int | lq_tmp_x5579 &gt;= 0 &amp;&amp; lq_tmp_x5579 + s#a3Mi &lt;= fplen x#a3Mh &amp;&amp; lq_tmp_x5579 == l#a3Mj}</span><span class='hs-varid'>l</span></a><a class=annot href="#"><span class=annottext>lq_tmp_x5573:Int^"lq_tmp_x5575"
-&gt; lq_tmp_x5574:Int^"lq_tmp_x5575"
-&gt; {lq_tmp_x5576 : Int^"lq_tmp_x5575" | lq_tmp_x5576 == lq_tmp_x5573 + lq_tmp_x5574}</span><span class='hs-varop'>+</span></a><a class=annot href="#"><span class=annottext>{lq_tmp_x5580 : Int | lq_tmp_x5580 == (1  :  int) &amp;&amp; lq_tmp_x5580 == lq_anf__d41p}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5820:(lq_tmp_x5819:(lq_tmp_x5822:{lq_tmp_x5836 : (Ptr {lq_tmp_x5835 : Word8^"lq_tmp_x5825" | k_5824[VV#5823:=lq_tmp_x5835][VV#5826:=lq_tmp_x5836]})^"lq_tmp_x5828" | k_5827[VV#5826:=lq_tmp_x5836]}
                            -&gt; {lq_tmp_x5838 : (IO {lq_tmp_x5837 : ()^"lq_tmp_x5831" | k_5830[VV#5829:=lq_tmp_x5837][VV#5832:=lq_tmp_x5838]})^"lq_tmp_x5834" | k_5833[VV#5832:=lq_tmp_x5838]})
              -&gt; {lq_tmp_x5843 : ByteString^"lq_tmp_x5842" | k_5841[VV#5840:=lq_tmp_x5843]})
-&gt; lq_tmp_x5821:(lq_tmp_x5822:{lq_tmp_x5836 : (Ptr {lq_tmp_x5835 : Word8^"lq_tmp_x5825" | k_5824[VV#5823:=lq_tmp_x5835][VV#5826:=lq_tmp_x5836]})^"lq_tmp_x5828" | k_5827[VV#5826:=lq_tmp_x5836]}
                 -&gt; {lq_tmp_x5838 : (IO {lq_tmp_x5837 : ()^"lq_tmp_x5831" | k_5830[VV#5829:=lq_tmp_x5837][VV#5832:=lq_tmp_x5838]})^"lq_tmp_x5834" | k_5833[VV#5832:=lq_tmp_x5838]})
-&gt; {lq_tmp_x5843 : ByteString^"lq_tmp_x5842" | k_5841[VV#5840:=lq_tmp_x5843]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#5599 : (Ptr {VV#5596 : Word8^"lq_tmp_x5598" | k_5597})^"lq_tmp_x5601" | k_5600}</span><span class='hs-varid'>p</span></a> <span class='hs-keyglyph'>-&gt;</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5617:(ForeignPtr {lq_tmp_x5622 : Word8^"lq_tmp_x5621" | k_5620[VV#5619:=lq_tmp_x5622]})
-&gt; lq_tmp_x5618:(lq_tmp_x5616:{lq_tmp_x5610 : (Ptr {lq_tmp_x5622 : Word8^"lq_tmp_x5621" | k_5620[VV#5619:=lq_tmp_x5622]}) | 0 &lt;= plen lq_tmp_x5610 &amp;&amp; plen lq_tmp_x5610 == fplen lq_tmp_x5617}
                 -&gt; (IO {lq_tmp_x5626 : ()^"lq_tmp_x5625" | k_5624[VV#5623:=lq_tmp_x5626]}))
-&gt; (IO {lq_tmp_x5626 : ()^"lq_tmp_x5625" | k_5624[VV#5623:=lq_tmp_x5626]})</span><span class='hs-varid'>withForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5628 : (ForeignPtr Word8) | lq_tmp_x5628 == x#a3Mh}</span><span class='hs-varid'>x</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5771:(lq_tmp_x5770:(lq_tmp_x5773:{lq_tmp_x5787 : (Ptr {lq_tmp_x5786 : Word8^"lq_tmp_x5776" | k_5775[VV#5774:=lq_tmp_x5786][VV#5777:=lq_tmp_x5787]})^"lq_tmp_x5779" | k_5778[VV#5777:=lq_tmp_x5787]}
                            -&gt; {lq_tmp_x5789 : (IO {lq_tmp_x5788 : ()^"lq_tmp_x5782" | k_5781[VV#5780:=lq_tmp_x5788][VV#5783:=lq_tmp_x5789]})^"lq_tmp_x5785" | k_5784[VV#5783:=lq_tmp_x5789]})
              -&gt; {lq_tmp_x5798 : (IO {lq_tmp_x5797 : ()^"lq_tmp_x5793" | k_5792[VV#5791:=lq_tmp_x5797][VV#5794:=lq_tmp_x5798]})^"lq_tmp_x5796" | k_5795[VV#5794:=lq_tmp_x5798]})
-&gt; lq_tmp_x5772:(lq_tmp_x5773:{lq_tmp_x5787 : (Ptr {lq_tmp_x5786 : Word8^"lq_tmp_x5776" | k_5775[VV#5774:=lq_tmp_x5786][VV#5777:=lq_tmp_x5787]})^"lq_tmp_x5779" | k_5778[VV#5777:=lq_tmp_x5787]}
                 -&gt; {lq_tmp_x5789 : (IO {lq_tmp_x5788 : ()^"lq_tmp_x5782" | k_5781[VV#5780:=lq_tmp_x5788][VV#5783:=lq_tmp_x5789]})^"lq_tmp_x5785" | k_5784[VV#5783:=lq_tmp_x5789]})
-&gt; {lq_tmp_x5798 : (IO {lq_tmp_x5797 : ()^"lq_tmp_x5793" | k_5792[VV#5791:=lq_tmp_x5797][VV#5794:=lq_tmp_x5798]})^"lq_tmp_x5796" | k_5795[VV#5794:=lq_tmp_x5798]}</span><span class='hs-varop'>$</span></a> <span class='hs-keyglyph'>\</span><a class=annot href="#"><span class=annottext>{VV#5633 : (Ptr {VV#5630 : Word8^"lq_tmp_x5632" | k_5631})^"lq_tmp_x5635" | k_5634}</span><span class='hs-varid'>f</span></a> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<span class=hs-linenum>801: </span>        <a class=annot href="#"><span class=annottext>lq_tmp_x5651:{lq_tmp_x5644 : (Ptr Word8^"lq_tmp_x5653") | 0 &lt; plen lq_tmp_x5644}
-&gt; lq_tmp_x5652:Word8^"lq_tmp_x5653" -&gt; (IO ())</span><span class='hs-varid'>poke</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5658 : (Ptr {lq_tmp_x5657 : Word8^"lq_tmp_x5598" | k_5597[VV#5596:=lq_tmp_x5657][VV#5599:=lq_tmp_x5658]})^"lq_tmp_x5601" | k_5600[VV#5599:=lq_tmp_x5658] &amp;&amp; lq_tmp_x5658 == p#a3Mk}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5659 : Word8 | lq_tmp_x5659 == c#a3Mg}</span><span class='hs-varid'>c</span></a>
<span class=hs-linenum>802: </span>        <a class=annot href="#"><span class=annottext>lq_tmp_x5733:{lq_tmp_x5724 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5724}
-&gt; lq_tmp_x5734:{lq_tmp_x5726 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5726}
-&gt; lq_tmp_x5735:{lq_tmp_x5727 : CSize | lq_tmp_x5727 &lt;= plen lq_tmp_x5734 &amp;&amp; lq_tmp_x5727 &lt;= plen lq_tmp_x5733}
-&gt; (IO ())</span><span class='hs-varid'>memcpy</span></a> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5683 : (Ptr {lq_tmp_x5682 : Word8^"lq_tmp_x5598" | k_5597[VV#5596:=lq_tmp_x5682][VV#5599:=lq_tmp_x5683]})^"lq_tmp_x5601" | k_5600[VV#5599:=lq_tmp_x5683] &amp;&amp; lq_tmp_x5683 == p#a3Mk}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5672:{lq_tmp_x5667 : (Ptr {lq_tmp_x5677 : Word8^"lq_tmp_x5676" | k_5675[VV#5674:=lq_tmp_x5677]}) | 0 &lt;= plen lq_tmp_x5667}
-&gt; lq_tmp_x5673:{lq_tmp_x5668 : Int | lq_tmp_x5668 &lt;= plen lq_tmp_x5672}
-&gt; {lq_tmp_x5669 : (Ptr {lq_tmp_x5681 : Word8^"lq_tmp_x5680" | k_5679[VV#5678:=lq_tmp_x5681]}) | 0 &lt;= plen lq_tmp_x5669 &amp;&amp; pbase lq_tmp_x5669 == pbase lq_tmp_x5672 &amp;&amp; plen lq_tmp_x5669 == plen lq_tmp_x5672 - lq_tmp_x5673}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5684 : Int | lq_tmp_x5684 == (1  :  int) &amp;&amp; lq_tmp_x5684 == lq_anf__d41u}</span><span class='hs-num'>1</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>{lq_tmp_x5702 : (Ptr {lq_tmp_x5701 : Word8^"lq_tmp_x5632" | k_5631[VV#5630:=lq_tmp_x5701][VV#5633:=lq_tmp_x5702]})^"lq_tmp_x5635" | k_5634[VV#5633:=lq_tmp_x5702] &amp;&amp; lq_tmp_x5702 == f#a3Ml}</span><span class='hs-varid'>f</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x5691:{lq_tmp_x5686 : (Ptr {lq_tmp_x5696 : Word8^"lq_tmp_x5695" | k_5694[VV#5693:=lq_tmp_x5696]}) | 0 &lt;= plen lq_tmp_x5686}
-&gt; lq_tmp_x5692:{lq_tmp_x5687 : Int | lq_tmp_x5687 &lt;= plen lq_tmp_x5691}
-&gt; {lq_tmp_x5688 : (Ptr {lq_tmp_x5700 : Word8^"lq_tmp_x5699" | k_5698[VV#5697:=lq_tmp_x5700]}) | 0 &lt;= plen lq_tmp_x5688 &amp;&amp; pbase lq_tmp_x5688 == pbase lq_tmp_x5691 &amp;&amp; plen lq_tmp_x5688 == plen lq_tmp_x5691 - lq_tmp_x5692}</span><span class='hs-varop'>`plusPtr`</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5703 : Int | lq_tmp_x5703 &gt;= 0 &amp;&amp; lq_tmp_x5703 &lt;= fplen x#a3Mh &amp;&amp; lq_tmp_x5703 == s#a3Mi}</span><span class='hs-varid'>s</span></a><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><a class=annot href="#"><span class=annottext>lq_tmp_x5712:Int^"lq_tmp_x5713"
-&gt; {lq_tmp_x5716 : CSize^"lq_tmp_x5715" | lq_tmp_x5716 == lq_tmp_x5712}</span><span class='hs-varid'>fromIntegral</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5721 : Int | lq_tmp_x5721 &gt;= 0 &amp;&amp; lq_tmp_x5721 + s#a3Mi &lt;= fplen x#a3Mh &amp;&amp; lq_tmp_x5721 == l#a3Mj}</span><span class='hs-varid'>l</span></a><span class='hs-layout'>)</span>
<span class=hs-linenum>803: </span>
<span class=hs-linenum>804: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>empty</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>ByteString</span> <span class='hs-keyword'>| (bLen v) = 0}</span> <span class='hs-keyword'>@-}</span> 
<span class=hs-linenum>805: </span><span class='hs-definition'>empty</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span>
<span class=hs-linenum>806: </span><a class=annot href="#"><span class=annottext>{v : ByteString | bLen v == 0}</span><span class='hs-definition'>empty</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x760:(ForeignPtr Word8)
-&gt; lq_tmp_x761:{lq_tmp_x754 : Int | lq_tmp_x754 &gt;= 0 &amp;&amp; lq_tmp_x754 &lt;= fplen lq_tmp_x760}
-&gt; lq_tmp_x762:{lq_tmp_x755 : Int | lq_tmp_x755 &gt;= 0 &amp;&amp; lq_tmp_x755 + lq_tmp_x761 &lt;= fplen lq_tmp_x760}
-&gt; {lq_tmp_x756 : ByteString | bLen lq_tmp_x756 == lq_tmp_x762 &amp;&amp; bOff lq_tmp_x756 == lq_tmp_x761 &amp;&amp; bPtr lq_tmp_x756 == lq_tmp_x760}</span><span class='hs-conid'>PS</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x764 : (ForeignPtr Word8) | fplen lq_tmp_x764 == 0 &amp;&amp; lq_tmp_x764 == Memory.nullForeignPtr#r2QC}</span><span class='hs-varid'>nullForeignPtr</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x765 : Int | lq_tmp_x765 == (0  :  int) &amp;&amp; lq_tmp_x765 == lq_anf__d3Yj}</span><span class='hs-num'>0</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x766 : Int | lq_tmp_x766 == (0  :  int) &amp;&amp; lq_tmp_x766 == lq_anf__d3Yk}</span><span class='hs-num'>0</span></a>
<span class=hs-linenum>807: </span>
<span class=hs-linenum>808: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span> <span class='hs-varid'>mallocForeignPtrBytes</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignPtrN</span> <span class='hs-varid'>a</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>809: </span><span class='hs-keyword'>{-@</span> <span class='hs-keyword'>type</span> <span class='hs-conid'>ForeignPtrN</span> <span class='hs-varid'>a</span> <span class='hs-conid'>N</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>{</span><span class='hs-varid'>v</span><span class='hs-conop'>:</span><span class='hs-conid'>ForeignPtr</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>|</span> <span class='hs-varid'>fplen</span> <span class='hs-varid'>v</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>N</span><span class='hs-layout'>}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>810: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>malloc</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>n</span><span class='hs-conop'>:</span><span class='hs-conid'>Nat</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>ForeignPtrN</span> <span class='hs-varid'>a</span> <span class='hs-varid'>n</span><span class='hs-layout'>)</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>811: </span><a class=annot href="#"><span class=annottext>forall a.
lq_tmp_x730:{v : Int | v &gt;= 0}
-&gt; (IO {VV : (ForeignPtr a) | 0 &lt;= fplen VV &amp;&amp; fplen VV == lq_tmp_x730})</span><span class='hs-definition'>malloc</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>forall a.
lq_tmp_x735:{lq_tmp_x731 : Int | lq_tmp_x731 &gt;= 0}
-&gt; (IO {lq_tmp_x732 : (ForeignPtr a) | 0 &lt;= fplen lq_tmp_x732 &amp;&amp; fplen lq_tmp_x732 == lq_tmp_x735})</span><span class='hs-varid'>mallocForeignPtrBytes</span></a> 
<span class=hs-linenum>812: </span>
<span class=hs-linenum>813: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span>
<span class=hs-linenum>814: </span>    <span class='hs-varid'>c_memcpy</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>dst</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-conid'>PtrV</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum>815: </span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>src</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-conid'>PtrV</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>816: </span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>size</span><span class='hs-conop'>:</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>CSize</span> <span class='hs-keyword'>| (v &lt;= (plen src) &amp;&amp; v &lt;= (plen dst))}</span> 
<span class=hs-linenum>817: </span>             <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum>818: </span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>819: </span><span class='hs-keyword'>foreign</span> <span class='hs-keyword'>import</span> <span class='hs-keyword'>ccall</span> <span class='hs-keyword'>unsafe</span> <span class='hs-str'>"string.h memcpy"</span> <span class='hs-varid'>c_memcpy</span>
<span class=hs-linenum>820: </span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CSize</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum>821: </span>
<span class=hs-linenum>822: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>memcpy</span> <span class='hs-keyglyph'>::</span> <span class='hs-varid'>dst</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-conid'>PtrV</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span>
<span class=hs-linenum>823: </span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>src</span><span class='hs-conop'>:</span><span class='hs-layout'>(</span><span class='hs-conid'>PtrV</span> <span class='hs-conid'>Word8</span><span class='hs-layout'>)</span> 
<span class=hs-linenum>824: </span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>size</span><span class='hs-conop'>:</span> <span class='hs-keyword'>{v:</span><span class='hs-conid'>CSize</span> <span class='hs-keyword'>| (v &lt;= (plen src) &amp;&amp; v &lt;= (plen dst))}</span> 
<span class=hs-linenum>825: </span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span> 
<span class=hs-linenum>826: </span>  <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>827: </span><span class='hs-definition'>memcpy</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Ptr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>CSize</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-conid'>()</span>
<span class=hs-linenum>828: </span><a class=annot href="#"><span class=annottext>lq_tmp_x5460:{VV : (Ptr Word8) | 0 &lt;= plen VV}
-&gt; lq_tmp_x5461:{VV : (Ptr Word8) | 0 &lt;= plen VV}
-&gt; lq_tmp_x5462:{v : CSize | v &lt;= plen lq_tmp_x5461 &amp;&amp; v &lt;= plen lq_tmp_x5460}
-&gt; (IO ())</span><span class='hs-definition'>memcpy</span></a> <a class=annot href="#"><span class=annottext>{VV : (Ptr Word8) | 0 &lt;= plen VV}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{VV : (Ptr Word8) | 0 &lt;= plen VV}</span><span class='hs-varid'>q</span></a> <a class=annot href="#"><span class=annottext>{v : CSize | v &lt;= plen q#a3Mn &amp;&amp; v &lt;= plen p#a3Mm}</span><span class='hs-varid'>s</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x5477:{lq_tmp_x5467 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5467}
-&gt; lq_tmp_x5478:{lq_tmp_x5469 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5469}
-&gt; lq_tmp_x5479:{lq_tmp_x5470 : CSize | lq_tmp_x5470 &lt;= plen lq_tmp_x5478 &amp;&amp; lq_tmp_x5470 &lt;= plen lq_tmp_x5477}
-&gt; (IO (Ptr Word8))</span><span class='hs-varid'>c_memcpy</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5481 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5481 &amp;&amp; lq_tmp_x5481 == p#a3Mm}</span><span class='hs-varid'>p</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5483 : (Ptr Word8) | 0 &lt;= plen lq_tmp_x5483 &amp;&amp; lq_tmp_x5483 == q#a3Mn}</span><span class='hs-varid'>q</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5484 : CSize | lq_tmp_x5484 &lt;= plen q#a3Mn &amp;&amp; lq_tmp_x5484 &lt;= plen p#a3Mm &amp;&amp; lq_tmp_x5484 == s#a3Mo}</span><span class='hs-varid'>s</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x52:(IO {lq_tmp_x5520 : (Ptr {lq_tmp_x5519 : Word8^"lq_tmp_x5515" | k_5514[VV#5513:=lq_tmp_x5519][VV#5516:=lq_tmp_x5520]})^"lq_tmp_x5518" "lq_tmp_x54" | k_5517[VV#5516:=lq_tmp_x5520]})^"lq_tmp_x5509" "lq_tmp_x53"
-&gt; lq_tmp_x55:(IO {lq_tmp_x5524 : ()^"lq_tmp_x5523" "lq_tmp_x57" | k_5522[VV#5521:=lq_tmp_x5524]})^"lq_tmp_x5509" "lq_tmp_x56"
-&gt; (IO {lq_tmp_x5524 : ()^"lq_tmp_x5523" "lq_tmp_x59" | k_5522[VV#5521:=lq_tmp_x5524]})^"lq_tmp_x5509" "lq_tmp_x58"</span><span class='hs-varop'>&gt;&gt;</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x62:{lq_tmp_x5498 : ()^"lq_tmp_x5497" "lq_tmp_x63" | k_5496[VV#5495:=lq_tmp_x5498]}
-&gt; (IO {lq_tmp_x5498 : ()^"lq_tmp_x5497" "lq_tmp_x65" | k_5496[VV#5495:=lq_tmp_x5498]})^"lq_tmp_x5491" "lq_tmp_x64"</span><span class='hs-varid'>return</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x5499 : ()^"lq_tmp_x93" | lq_tmp_x5499 == GHC.Tuple.()#70}</span><span class='hs-conid'>()</span></a>
<span class=hs-linenum>829: </span>
<span class=hs-linenum>830: </span><span class='hs-keyword'>{-@</span> <span class='hs-varid'>assume</span> <span class='hs-varid'>nullForeignPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-keyword'>{v:</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-conid'>Word8</span> <span class='hs-keyword'>| (fplen v) = 0}</span> <span class='hs-keyword'>@-}</span>
<span class=hs-linenum>831: </span><span class='hs-definition'>nullForeignPtr</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ForeignPtr</span> <span class='hs-conid'>Word8</span>
<span class=hs-linenum>832: </span><a class=annot href="#"><span class=annottext>{v : (ForeignPtr Word8) | fplen v == 0}</span><span class='hs-definition'>nullForeignPtr</span></a> <span class='hs-keyglyph'>=</span> <a class=annot href="#"><span class=annottext>lq_tmp_x725:(IO {lq_tmp_x720 : (ForeignPtr {lq_tmp_x719 : Word8^"lq_tmp_x668" | k_667[VV#666:=lq_tmp_x719][VV#669:=lq_tmp_x720][lq_tmp_x672:=lq_tmp_x719][lq_tmp_x673:=lq_tmp_x720][lq_tmp_x663:=lq_tmp_x721]})^"lq_tmp_x671" "lq_tmp_x246" | k_670[VV#669:=lq_tmp_x720][lq_tmp_x673:=lq_tmp_x720][lq_tmp_x663:=lq_tmp_x721]})^"lq_tmp_x247"
-&gt; {lq_tmp_x723 : (ForeignPtr {lq_tmp_x722 : Word8^"lq_tmp_x668" | k_667[VV#666:=lq_tmp_x722][VV#669:=lq_tmp_x723][lq_tmp_x672:=lq_tmp_x722][lq_tmp_x673:=lq_tmp_x723][lq_tmp_x665:=lq_tmp_x725]})^"lq_tmp_x671" "lq_tmp_x248" | k_670[VV#669:=lq_tmp_x723][lq_tmp_x673:=lq_tmp_x723][lq_tmp_x665:=lq_tmp_x725]}</span><span class='hs-varid'>unsafePerformIO</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x697:(lq_tmp_x696:{lq_tmp_x710 : (IO {lq_tmp_x709 : (ForeignPtr {lq_tmp_x708 : Word8^"lq_tmp_x701" | k_700[VV#699:=lq_tmp_x708][VV#702:=lq_tmp_x709][VV#705:=lq_tmp_x710]})^"lq_tmp_x704" | k_703[VV#702:=lq_tmp_x709][VV#705:=lq_tmp_x710]})^"lq_tmp_x707" | k_706[VV#705:=lq_tmp_x710]}
             -&gt; {lq_tmp_x718 : (ForeignPtr {lq_tmp_x717 : Word8^"lq_tmp_x713" | k_712[VV#711:=lq_tmp_x717][VV#714:=lq_tmp_x718]})^"lq_tmp_x716" | k_715[VV#714:=lq_tmp_x718]})
-&gt; lq_tmp_x698:{lq_tmp_x710 : (IO {lq_tmp_x709 : (ForeignPtr {lq_tmp_x708 : Word8^"lq_tmp_x701" | k_700[VV#699:=lq_tmp_x708][VV#702:=lq_tmp_x709][VV#705:=lq_tmp_x710]})^"lq_tmp_x704" | k_703[VV#702:=lq_tmp_x709][VV#705:=lq_tmp_x710]})^"lq_tmp_x707" | k_706[VV#705:=lq_tmp_x710]}
-&gt; {lq_tmp_x718 : (ForeignPtr {lq_tmp_x717 : Word8^"lq_tmp_x713" | k_712[VV#711:=lq_tmp_x717][VV#714:=lq_tmp_x718]})^"lq_tmp_x716" | k_715[VV#714:=lq_tmp_x718]}</span><span class='hs-varop'>$</span></a> <a class=annot href="#"><span class=annottext>lq_tmp_x685:(Ptr {lq_tmp_x689 : Word8^"lq_tmp_x688" | k_687[VV#686:=lq_tmp_x689]})
-&gt; (IO {lq_tmp_x682 : (ForeignPtr {lq_tmp_x689 : Word8^"lq_tmp_x688" | k_687[VV#686:=lq_tmp_x689]}) | 0 &lt;= fplen lq_tmp_x682 &amp;&amp; fplen lq_tmp_x682 == plen lq_tmp_x685})</span><span class='hs-varid'>newForeignPtr_</span></a> <a class=annot href="#"><span class=annottext>{lq_tmp_x691 : (Ptr {lq_tmp_x690 : Word8^"lq_tmp_x678" "lq_tmp_x214" | k_677[VV#676:=lq_tmp_x690][lq_tmp_x679:=lq_tmp_x690][lq_tmp_x675:=lq_tmp_x691]})^"lq_tmp_x215" | lq_tmp_x691 == lq_anf__d3Yh}</span><span class='hs-varid'>nullPtr</span></a>
<span class=hs-linenum>833: </span><span class='hs-comment'>{-# NOINLINE nullForeignPtr #-}</span>
</pre>
<p>\end{comment}</p>
<head>
<link type='text/css' rel='stylesheet' href='liquid.css' />
</head>
